<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vibe Coding — AI-Powered EdTech</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&family=Poppins:wght@400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* ─── COLORS — Orange/White EdTech Theme ─── */
            --bg: #F7F8FC;
            --surface: #FFFFFF;
            --surface2: #F0F2F8;
            --border: #E4E8F0;
            --accent: #F97316;
            --accent2: #3B82F6;
            --accent3: #EF4444;
            --accent4: #F59E0B;
            --accent-light: #FFF4ED;
            --accent-mid: #FDBA74;
            --text: #1E2A3B;
            --text2: #64748B;
            --text3: #94A3B8;
            --shadow-sm: 0 1px 4px rgba(0, 0, 0, .06);
            --shadow: 0 4px 16px rgba(0, 0, 0, .08);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, .12);
            --glow: 0 4px 20px rgba(249, 115, 22, 0.35);
            --glow2: 0 4px 20px rgba(59, 130, 246, 0.25);

            /* ─── TYPOGRAPHY ─────────────────────────────── */
            --font-primary: 'Nunito', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            --font-secondary: 'Poppins', sans-serif;
            --font-size-xs: 11px;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-size-3xl: 22px;
            --font-weight-regular: 400;
            --font-weight-medium: 600;
            --font-weight-bold: 700;
            --font-weight-black: 800;

            /* ─── SPACING (more generous) ─────────────────── */
            --spacing-xs: 5px;
            --spacing-sm: 10px;
            --spacing-md: 14px;
            --spacing-lg: 20px;
            --spacing-xl: 24px;
            --spacing-2xl: 32px;
            --spacing-3xl: 40px;
            --spacing-4xl: 48px;
            --spacing-5xl: 60px;

            /* ─── BORDER RADIUS (rounder/friendlier) ──────── */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 22px;
            --radius-round: 50%;

            /* ─── TRANSITIONS ─────────────────────────────── */
            --transition-fast: 0.18s;
            --transition-normal: 0.3s;
            --transition-slow: 0.5s;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: var(--font-primary);
            overflow-x: hidden;
            font-size: var(--font-size-base);
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--surface2);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }

        /* ─── THEME TOGGLE ─────────────────────────────── */
        .theme-toggle {
            position: fixed;
            top: var(--spacing-sm);
            right: 45vw;
            z-index: 999;
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
        }

        /* Tablets */
        @media (max-width: 1024px) {
            .theme-toggle {
                top: var(--spacing-5xl);
                right: 3vw;
                gap: var(--spacing-sm);
            }
        }

        /* Mobile */
        @media (max-width: 768px) {
            .theme-toggle {
                top: auto;
                bottom: var(--spacing-md);
                right: var(--spacing-md);
                left: var(--spacing-md);
                justify-content: center;
                gap: var(--spacing-sm);
            }
        }

        /* Small Mobile */
        @media (max-width: 480px) {
            .theme-toggle {
                flex-direction: column;
                gap: var(--spacing-xs);
            }
        }

        .toggle-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            background: var(--surface);
            border: 1.5px solid var(--border);
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--radius-lg);
            cursor: pointer;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--text2);
            transition: all var(--transition-fast);
            font-family: var(--font-primary);
            box-shadow: var(--shadow-sm);
        }

        .toggle-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .toggle-btn.active {
            background: var(--accent-light);
            border-color: var(--accent);
            color: var(--accent);
        }

        /* ─── THEME: PROFESSIONAL ─────────────────────────────── */
        body.theme-professional {
            --font-primary: 'Poppins', sans-serif;
            --font-secondary: 'Poppins', sans-serif;
        }

        body.theme-professional .btn,
        body.theme-professional label,
        body.theme-professional .section-title {
            letter-spacing: -0.3px;
        }

        /* ─── THEME: MINIMAL ─────────────────────────────── */
        body.theme-minimal {
            --font-primary: 'Nunito', sans-serif;
            --spacing-md: 12px;
            --spacing-lg: 18px;
        }

        body.theme-minimal .btn {
            border-radius: var(--radius-sm);
            padding: 8px 16px;
        }

        body.theme-minimal .card {
            border-radius: var(--radius-md);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: .5;
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes glow {

            0%,
            100% {
                box-shadow: 0 0 8px rgba(249, 115, 22, .25);
            }

            50% {
                box-shadow: 0 0 24px rgba(249, 115, 22, .55);
            }
        }

        @keyframes scanline {
            0% {
                transform: translateY(-100%);
            }

            100% {
                transform: translateY(100vh);
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        @keyframes typing {

            0%,
            60%,
            100% {
                opacity: 1;
            }

            30% {
                opacity: 0;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(16px);
            }

            to {
                opacity: 1;
                transform: none;
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            20%,
            60% {
                transform: translateX(-6px);
            }

            40%,
            80% {
                transform: translateX(6px);
            }
        }

        .fade-in {
            animation: fadeIn .4s ease forwards;
        }

        .slide-in {
            animation: slideIn .3s ease forwards;
        }

        .code-area {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            background: #1E2A3B;
            border: 1.5px solid #334155;
            border-radius: 12px;
            padding: 20px;
            color: #E2E8F0;
            resize: none;
            width: 100%;
            min-height: 300px;
            outline: none;
        }

        .code-area:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(249, 115, 22, .12);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: 10px var(--spacing-lg);
            border-radius: var(--radius-md);
            border: none;
            cursor: pointer;
            font-family: var(--font-primary);
            font-weight: var(--font-weight-bold);
            font-size: var(--font-size-sm);
            transition: all var(--transition-fast);
        }

        .btn-primary {
            background: var(--accent);
            color: #fff;
            box-shadow: 0 4px 14px rgba(249, 115, 22, .3);
        }

        .btn-primary:hover {
            background: #EA6A0A;
            box-shadow: var(--glow);
            transform: translateY(-1px);
        }

        .btn-primary:disabled {
            background: #CBD5E1;
            color: #94A3B8;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: transparent;
            color: var(--accent);
            border: 2px solid var(--accent);
        }

        .btn-secondary:hover {
            background: var(--accent-light);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text2);
            border: 1.5px solid var(--border);
        }

        .btn-ghost:hover {
            border-color: var(--text2);
            color: var(--text);
            background: var(--surface2);
        }

        .btn-danger {
            background: rgba(239, 68, 68, .08);
            color: var(--accent3);
            border: 1.5px solid rgba(239, 68, 68, .25);
        }

        .btn-danger:hover {
            background: rgba(239, 68, 68, .15);
        }

        .btn-blue {
            background: rgba(59, 130, 246, .08);
            color: var(--accent2);
            border: 1.5px solid rgba(59, 130, 246, .25);
        }

        .btn-blue:hover {
            background: rgba(59, 130, 246, .15);
        }

        .btn-sm {
            padding: 6px 14px;
            font-size: var(--font-size-xs);
        }

        .btn-lg {
            padding: 14px var(--spacing-2xl);
            font-size: var(--font-size-lg);
        }

        .btn:disabled {
            opacity: .5;
            cursor: not-allowed;
            transform: none !important;
        }

        .card {
            background: var(--surface);
            border: 1.5px solid var(--border);
            border-radius: var(--radius-lg);
            transition: all var(--transition-fast);
            box-shadow: var(--shadow-sm);
        }

        .card:hover {
            border-color: rgba(249, 115, 22, .25);
            box-shadow: var(--shadow);
        }

        .card-glow {
            box-shadow: 0 0 24px rgba(249, 115, 22, .08);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-black);
            font-family: var(--font-secondary);
        }

        .badge-green {
            background: #DCFCE7;
            color: #16A34A;
            border: 1px solid #BBF7D0;
        }

        .badge-blue {
            background: #DBEAFE;
            color: #2563EB;
            border: 1px solid #BFDBFE;
        }

        .badge-red {
            background: #FEE2E2;
            color: #DC2626;
            border: 1px solid #FECACA;
        }

        .badge-yellow {
            background: #FEF9C3;
            color: #CA8A04;
            border: 1px solid #FDE047;
        }

        .badge-gray {
            background: var(--surface2);
            color: var(--text2);
            border: 1.5px solid var(--border);
        }

        .badge-purple {
            background: #F3E8FF;
            color: #9333EA;
            border: 1px solid #E9D5FF;
        }

        .badge-orange {
            background: var(--accent-light);
            color: var(--accent);
            border: 1px solid #FDBA74;
        }

        .progress-bar {
            height: 8px;
            background: var(--surface2);
            border-radius: 99px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 99px;
            background: linear-gradient(90deg, var(--accent), #FB923C);
            transition: width .5s ease;
        }

        input,
        select,
        textarea {
            background: var(--surface);
            border: 1.5px solid var(--border);
            border-radius: var(--radius-md);
            padding: 13px var(--spacing-lg);
            color: var(--text);
            font-family: var(--font-primary);
            font-size: var(--font-size-base);
            outline: none;
            width: 100%;
            transition: border-color var(--transition-fast);
            box-shadow: var(--shadow-sm);
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(249, 115, 22, .12);
        }

        input::placeholder,
        textarea::placeholder {
            color: var(--text3);
        }

        input.err {
            border-color: var(--accent3) !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, .12) !important;
        }

        label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-sm);
            color: var(--text2);
            font-weight: var(--font-weight-bold);
        }

        .field-err {
            color: var(--accent3);
            font-size: var(--font-size-xs);
            margin-top: var(--spacing-sm);
        }

        .sidebar {
            width: 260px;
            min-height: 100vh;
            background: var(--surface);
            border-right: 1.5px solid var(--border);
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 100;
            transition: transform var(--transition-normal);
            box-shadow: var(--shadow);
        }

        .sidebar-logo {
            padding: var(--spacing-xl);
            border-bottom: 1.5px solid var(--border);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .logo-mark {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--accent), #FB923C);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-weight-black);
            color: #fff;
            font-size: var(--font-size-xl);
            box-shadow: 0 4px 14px rgba(249, 115, 22, .35);
            flex-shrink: 0;
        }

        .sidebar-nav {
            flex: 1;
            padding: var(--spacing-xl) var(--spacing-md);
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: var(--spacing-xl);
        }

        .nav-section-label {
            font-size: 10px;
            font-weight: var(--font-weight-black);
            color: var(--text3);
            letter-spacing: 2px;
            text-transform: uppercase;
            padding: 0 var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: 12px var(--spacing-md);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            color: var(--text2);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-bold);
            margin-bottom: 4px;
            border: 1.5px solid transparent;
        }

        .nav-item:hover {
            background: var(--surface2);
            color: var(--text);
            border-color: var(--border);
        }

        .nav-item.active {
            background: var(--accent-light);
            color: var(--accent);
            border-color: rgba(249, 115, 22, .25);
        }

        .nav-item .icon {
            font-size: var(--font-size-lg);
            width: 22px;
            text-align: center;
        }

        .nav-item .badge-count {
            margin-left: auto;
            background: var(--accent);
            color: #fff;
            border-radius: 10px;
            padding: 2px 8px;
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-black);
        }

        .main {
            margin-left: 260px;
            min-height: 100vh;
            background: var(--bg);
        }

        .topbar {
            background: var(--surface);
            border-bottom: 1.5px solid var(--border);
            padding: 0 var(--spacing-2xl);
            height: 68px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 90;
            box-shadow: var(--shadow-sm);
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .page-content {
            padding: var(--spacing-2xl);
            max-width: 1400px;
        }

        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
            background: #fff;
        }

        .hero::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(ellipse 80% 60% at 50% -10%, rgba(249, 115, 22, .1) 0%, transparent 70%);
        }

        .hero-grid {
            position: absolute;
            inset: 0;
            background-image: linear-gradient(rgba(249, 115, 22, .05) 1px, transparent 1px), linear-gradient(90deg, rgba(249, 115, 22, .05) 1px, transparent 1px);
            background-size: 48px 48px;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 900px;
            padding: 60px 40px;
        }

        .hero-tag {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--accent-light);
            border: 1.5px solid rgba(249, 115, 22, .3);
            border-radius: 99px;
            padding: 8px 20px;
            font-size: 12px;
            font-weight: 800;
            color: var(--accent);
            letter-spacing: 1px;
            margin-bottom: 28px;
        }

        .hero h1 {
            font-size: 72px;
            font-weight: 900;
            line-height: 1.05;
            margin-bottom: 24px;
            background: linear-gradient(135deg, #1E2A3B 0%, var(--accent) 60%, #FB923C 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 18px;
            color: var(--text2);
            max-width: 600px;
            margin: 0 auto 40px;
            line-height: 1.8;
        }

        .hero-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .hero-stats {
            display: flex;
            gap: 48px;
            justify-content: center;
            margin-top: 64px;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
        }

        .stat-num {
            font-size: 36px;
            font-weight: 900;
            color: var(--accent);
            font-family: var(--font-secondary);
        }

        .stat-label {
            font-size: 13px;
            color: var(--text3);
            margin-top: 4px;
        }

        .score-ring {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .score-ring svg {
            transform: rotate(-90deg);
        }

        .score-ring-inner {
            position: absolute;
            text-align: center;
        }

        .score-ring-num {
            font-size: 28px;
            font-weight: 800;
            font-family: var(--font-secondary);
            color: var(--accent);
        }

        .score-ring-label {
            font-size: 10px;
            color: var(--text3);
            font-weight: 700;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            gap: 10px;
            height: 120px;
        }

        .bar {
            flex: 1;
            border-radius: 6px 6px 0 0;
            background: linear-gradient(180deg, var(--accent), rgba(249, 115, 22, .15));
            transition: height .5s ease;
            position: relative;
            cursor: pointer;
        }

        .bar:hover {
            background: linear-gradient(180deg, #EA6A0A, var(--accent));
        }

        .problem-row {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 18px;
            border-radius: 12px;
            cursor: pointer;
            transition: all .2s;
            border: 1.5px solid transparent;
        }

        .problem-row:hover {
            background: var(--surface2);
            border-color: var(--border);
        }

        .editor-layout {
            display: grid;
            grid-template-columns: 420px 1fr 340px;
            height: calc(100vh - 68px);
            overflow: hidden;
        }

        .editor-panel {
            overflow-y: auto;
            padding: 20px;
        }

        .editor-panel:not(:last-child) {
            border-right: 1.5px solid var(--border);
        }

        .notif {
            position: fixed;
            top: 88px;
            right: 28px;
            z-index: 1000;
            max-width: 360px;
        }

        .notif-item {
            background: var(--surface);
            border: 1.5px solid var(--border);
            border-radius: 16px;
            padding: 16px 18px;
            margin-bottom: 10px;
            animation: slideUp .3s ease;
            display: flex;
            gap: 14px;
            align-items: flex-start;
            box-shadow: var(--shadow-lg);
        }

        .notif-item.success {
            border-left: 4px solid #22C55E;
        }

        .notif-item.error {
            border-left: 4px solid var(--accent3);
        }

        .notif-item.info {
            border-left: 4px solid var(--accent2);
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, .5);
            backdrop-filter: blur(6px);
            z-index: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .modal {
            background: var(--surface);
            border: 1.5px solid var(--border);
            border-radius: 24px;
            padding: 36px;
            max-width: 540px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: fadeIn .2s ease;
            box-shadow: var(--shadow-lg);
        }

        .tabs {
            display: flex;
            gap: 4px;
            background: var(--surface2);
            border-radius: 14px;
            padding: 5px;
            margin-bottom: 24px;
        }

        .tab {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            font-size: 13px;
            font-weight: 700;
            color: var(--text2);
            transition: all .2s;
        }

        .tab.active {
            background: var(--surface);
            color: var(--accent);
            box-shadow: var(--shadow-sm);
        }

        .roadmap-card {
            padding: 24px;
            cursor: pointer;
        }

        .roadmap-card-icon {
            font-size: 36px;
            margin-bottom: 14px;
        }

        .roadmap-card-title {
            font-size: 16px;
            font-weight: 800;
            margin-bottom: 6px;
        }

        .roadmap-card-desc {
            font-size: 12px;
            color: var(--text2);
            margin-bottom: 14px;
        }

        .course-card {
            overflow: hidden;
        }

        .course-thumb {
            height: 150px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 52px;
            margin-bottom: 16px;
            background: var(--surface2);
        }

        .interview-slot {
            padding: 20px;
            cursor: pointer;
            display: flex;
            gap: 18px;
            align-items: center;
        }

        .job-card {
            padding: 22px;
        }

        .company-logo {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 800;
        }

        .tooltip-wrap {
            position: relative;
            display: inline-block;
        }

        .tooltip {
            position: absolute;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text);
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 11px;
            white-space: nowrap;
            color: #fff;
            pointer-events: none;
            opacity: 0;
            transition: opacity .2s;
            z-index: 200;
        }

        .tooltip-wrap:hover .tooltip {
            opacity: 1;
        }

        .ai-message {
            padding: 14px 18px;
            border-radius: 16px;
            margin-bottom: 10px;
            max-width: 85%;
            font-size: 13px;
            line-height: 1.75;
        }

        .ai-message.bot {
            background: var(--surface2);
            border: 1.5px solid var(--border);
            margin-right: auto;
            border-radius: 4px 16px 16px 16px;
            color: var(--text);
        }

        .ai-message.user {
            background: var(--accent-light);
            border: 1.5px solid rgba(249, 115, 22, .25);
            margin-left: auto;
            border-radius: 16px 4px 16px 16px;
            color: var(--text);
        }

        .typing-dot {
            display: inline-block;
            width: 7px;
            height: 7px;
            background: var(--accent);
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.2s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: .2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: .4s;
        }

        .hscroll {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .hscroll::-webkit-scrollbar {
            height: 4px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        @media(max-width:900px) {

            .grid-4,
            .grid-3 {
                grid-template-columns: 1fr 1fr;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }

            .editor-layout {
                grid-template-columns: 1fr;
            }

            .sidebar {
                transform: translateX(-100%);
            }

            .main {
                margin-left: 0;
            }
        }

        .feature-card {
            padding: 36px;
            border-radius: 20px;
            background: var(--surface);
            border: 1.5px solid var(--border);
            transition: all .3s;
            box-shadow: var(--shadow-sm);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: rgba(249, 115, 22, .3);
            box-shadow: 0 16px 48px rgba(249, 115, 22, .12);
        }

        .feature-icon {
            font-size: 40px;
            margin-bottom: 18px;
        }

        .feature-title {
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--text);
        }

        .feature-desc {
            font-size: 14px;
            color: var(--text2);
            line-height: 1.7;
        }

        .price-card {
            padding: 36px;
            border-radius: 20px;
            background: var(--surface);
            border: 1.5px solid var(--border);
            text-align: center;
            box-shadow: var(--shadow-sm);
        }

        .price-card.featured {
            border-color: var(--accent);
            box-shadow: 0 0 40px rgba(249, 115, 22, .15);
        }

        .price-amount {
            font-size: 52px;
            font-weight: 900;
            font-family: var(--font-secondary);
            color: var(--accent);
        }

        .lb-row {
            display: flex;
            align-items: center;
            gap: 18px;
            padding: 14px 18px;
            border-radius: 12px;
            transition: all .2s;
        }

        .lb-row:hover {
            background: var(--surface2);
        }

        .lb-rank {
            font-family: var(--font-secondary);
            font-size: 18px;
            font-weight: 800;
            width: 34px;
            text-align: center;
        }

        .resume-preview {
            background: #fff;
            color: #111;
            border-radius: 12px;
            padding: 36px;
            font-family: Georgia, serif;
            box-shadow: var(--shadow);
        }

        .resume-name {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .resume-title {
            font-size: 16px;
            color: #555;
            margin-bottom: 18px;
        }

        .resume-section {
            margin-bottom: 18px;
        }

        .resume-section h3 {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid #F97316;
            padding-bottom: 5px;
            margin-bottom: 10px;
            color: #F97316;
        }

        .streak-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 4px;
        }

        .streak-day {
            width: 14px;
            height: 14px;
            border-radius: 3px;
            background: var(--border);
        }

        .streak-day.active {
            background: var(--accent);
        }

        .streak-day.medium {
            background: rgba(249, 115, 22, .5);
        }

        .streak-day.low {
            background: rgba(249, 115, 22, .2);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 800;
            color: var(--text);
        }

        .divider {
            height: 1.5px;
            background: var(--border);
            margin: 28px 0;
        }

        .skill-bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 13px;
        }

        .skill-bar {
            height: 10px;
            background: var(--surface2);
            border-radius: 99px;
            overflow: hidden;
            margin-bottom: 14px;
        }

        .skill-fill {
            height: 100%;
            border-radius: 99px;
            transition: width .8s ease;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2.5px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin .7s linear infinite;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            background: var(--surface2);
            border: 1.5px solid var(--border);
            border-radius: 99px;
            font-size: 11px;
            color: var(--text2);
            margin: 3px;
            font-weight: 600;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all .2s;
            flex-shrink: 0;
        }

        .checkbox.checked {
            background: var(--accent);
            border-color: var(--accent);
        }

        .avatar {
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            flex-shrink: 0;
        }

        .notif-dot {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 9px;
            height: 9px;
            background: var(--accent3);
            border-radius: 50%;
            border: 2px solid var(--surface);
        }

        .ai-streaming::after {
            content: '▋';
            animation: blink .7s infinite;
            color: var(--accent);
            margin-left: 2px;
        }

        .api-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: var(--accent-light);
            border: 1.5px solid rgba(249, 115, 22, .3);
            border-radius: 99px;
            padding: 4px 12px;
            font-size: 10px;
            font-weight: 800;
            color: var(--accent);
            letter-spacing: 0.5px;
        }

        /* ─── AUTH SPECIFIC ─────────────────────────────── */
        .pw-wrap {
            position: relative;
        }

        .pw-eye {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--text3);
            font-size: 16px;
            user-select: none;
            transition: color .2s;
        }

        .pw-eye:hover {
            color: var(--accent);
        }

        .role-card {
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all .2s;
            text-align: center;
            background: var(--surface2);
        }

        .role-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .role-card.selected {
            border-color: var(--accent);
            background: var(--accent-light);
            box-shadow: 0 0 20px rgba(249, 115, 22, .15);
        }

        .auth-modal-bg {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, .6);
            backdrop-filter: blur(8px);
            z-index: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
            animation: fadeIn .2s ease;
        }

        /* ── MOCK INTERVIEW ─────────────────────────────── */
        @keyframes callPulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(249, 115, 22, .5);
            }

            70% {
                box-shadow: 0 0 0 14px rgba(249, 115, 22, 0);
            }
        }

        @keyframes voicePulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, .6);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
        }

        @keyframes outSlide {
            from {
                opacity: 0;
                transform: translateY(6px);
            }

            to {
                opacity: 1;
                transform: none;
            }
        }

        .mock-wrap {
            border: 1.5px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            display: grid;
            grid-template-columns: 1fr 360px;
            height: calc(100vh - 240px);
            min-height: 600px;
            box-shadow: var(--shadow);
        }

        .mock-left {
            display: flex;
            flex-direction: column;
            border-right: 1.5px solid var(--border);
            overflow: hidden;
            background: #1E2A3B;
        }

        .vstrip {
            display: flex;
            height: 175px;
            flex-shrink: 0;
            border-bottom: 1.5px solid #334155;
            position: relative;
            background: #0F172A;
        }

        .vtile {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .vtile+.vtile {
            border-left: 1px solid #334155;
        }

        .vtile video,
        .vtile canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .vtile-ph {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            background: linear-gradient(135deg, #1E2A3B, #0F172A);
        }

        .vtile-lbl {
            position: absolute;
            bottom: 6px;
            left: 9px;
            background: rgba(0, 0, 0, .65);
            padding: 2px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 700;
            color: #fff;
            pointer-events: none;
        }

        .call-overlay {
            position: absolute;
            inset: 0;
            background: rgba(15, 23, 42, .92);
            backdrop-filter: blur(6px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            z-index: 20;
        }

        .call-btn {
            width: 64px;
            height: 64px;
            background: var(--accent);
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: callPulse 1.8s infinite;
            transition: transform .15s;
        }

        .call-btn:hover {
            transform: scale(1.08);
        }

        .vrec {
            position: absolute;
            top: 8px;
            left: 9px;
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(0, 0, 0, .65);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 700;
            z-index: 10;
        }

        .rdot {
            width: 7px;
            height: 7px;
            background: #EF4444;
            border-radius: 50%;
            animation: pulse 1.2s infinite;
        }

        .vtmr {
            position: absolute;
            top: 8px;
            right: 9px;
            background: rgba(0, 0, 0, .65);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: #F59E0B;
            z-index: 10;
        }

        .vctrls {
            position: absolute;
            bottom: 7px;
            right: 8px;
            display: flex;
            gap: 5px;
            z-index: 10;
        }

        .vpill {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-size: 11px;
            font-weight: 700;
            transition: all .15s;
        }

        .vpill-b {
            background: rgba(59, 130, 246, .25);
            color: #93C5FD;
            border: 1px solid rgba(59, 130, 246, .4);
        }

        .vpill-b:hover {
            background: rgba(59, 130, 246, .35);
        }

        .vpill-r {
            background: rgba(239, 68, 68, .25);
            color: #FCA5A5;
            border: 1px solid rgba(239, 68, 68, .4);
        }

        .vpill-r:hover {
            background: rgba(239, 68, 68, .35);
        }

        .sbar {
            background: rgba(0, 0, 0, .3);
            border-bottom: 1px solid #334155;
            padding: 5px 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: #94A3B8;
            flex-shrink: 0;
        }

        .edsec {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .edtop {
            background: #1E2A3B;
            border-bottom: 1px solid #334155;
            padding: 0 12px;
            height: 44px;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .etab {
            padding: 0 14px;
            height: 100%;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            color: var(--accent);
            border-bottom: 2px solid var(--accent);
            background: rgba(249, 115, 22, .06);
        }

        .ldot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: #F59E0B;
            flex-shrink: 0;
        }

        .runbtn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 16px;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 800;
            font-size: 12px;
            transition: all .15s;
            margin-left: auto;
        }

        .runbtn:hover {
            background: #EA6A0A;
            box-shadow: 0 4px 14px rgba(249, 115, 22, .4);
        }

        .runbtn:disabled {
            background: #CBD5E1;
            color: #94A3B8;
            cursor: not-allowed;
            box-shadow: none;
        }

        .edbody {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .lnums {
            background: #0F172A;
            border-right: 1px solid #334155;
            padding: 14px 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            line-height: 1.6;
            color: #475569;
            user-select: none;
            min-width: 44px;
            text-align: right;
            overflow: hidden;
            flex-shrink: 0;
            white-space: pre;
        }

        .codeta {
            flex: 1;
            background: #0F172A;
            border: none;
            outline: none;
            padding: 14px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            line-height: 1.6;
            color: #E2E8F0;
            resize: none;
            tab-size: 2;
            white-space: pre;
            overflow-wrap: normal;
            overflow-x: auto;
        }

        .outpanel {
            background: #0F172A;
            border-top: 1px solid #334155;
            flex-shrink: 0;
        }

        .outhdr {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 14px;
            height: 34px;
            border-bottom: 1px solid #334155;
            cursor: pointer;
        }

        .outbody {
            max-height: 140px;
            overflow-y: auto;
            padding: 10px 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            line-height: 1.6;
        }

        .oline {
            animation: outSlide .2s ease;
        }

        .ogreen {
            color: #4ADE80;
        }

        .ored {
            color: #F87171;
        }

        .oyellow {
            color: #FCD34D;
        }

        .ogray {
            color: #64748B;
        }

        .mock-right {
            display: flex;
            flex-direction: column;
            background: var(--surface);
            overflow: hidden;
        }

        .mrh {
            padding: 14px 16px;
            border-bottom: 1.5px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .mchat {
            flex: 1;
            overflow-y: auto;
            padding: 14px;
            display: flex;
            flex-direction: column;
        }

        .mprob {
            padding: 12px 16px;
            background: var(--surface2);
            border-bottom: 1.5px solid var(--border);
            flex-shrink: 0;
        }

        .minput {
            padding: 12px;
            border-top: 1.5px solid var(--border);
            flex-shrink: 0;
        }

        .airing {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent), #FB923C);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
            box-shadow: 0 4px 14px rgba(249, 115, 22, .3);
        }

        .vbtn {
            background: rgba(239, 68, 68, .08);
            color: var(--accent3);
            border: 2px solid rgba(239, 68, 68, .3);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
            cursor: pointer;
            transition: all .2s;
        }

        .vbtn.von {
            background: rgba(239, 68, 68, .2);
            border-color: var(--accent3);
            animation: voicePulse 1.2s infinite;
        }

        .tbar {
            background: var(--accent-light);
            border: 1.5px solid rgba(249, 115, 22, .2);
            border-radius: 10px;
            padding: 6px 12px;
            font-size: 11px;
            color: var(--text2);
            font-style: italic;
            margin-top: 6px;
            line-height: 1.5;
        }
    </style>
</head>

<body>
    <!-- THEME TOGGLE -->
    <div class="theme-toggle">
        <button class="toggle-btn active" data-theme="default" onclick="switchTheme('default')">Default</button>
        <button class="toggle-btn" data-theme="professional" onclick="switchTheme('professional')">Professional</button>
        <button class="toggle-btn" data-theme="minimal" onclick="switchTheme('minimal')">Minimal</button>
    </div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, createContext, useContext } = React;

        // ═══════════════════════════════════════════════════════════
        // THEME SWITCHER
        // ═══════════════════════════════════════════════════════════
        const switchTheme = (theme) => {
            document.body.className = theme === 'default' ? '' : `theme-${theme}`;
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
            localStorage.setItem('vibe-theme', theme);
        };

        // Load saved theme on page load
        window.addEventListener('load', () => {
            const savedTheme = localStorage.getItem('vibe-theme') || 'default';
            switchTheme(savedTheme);
        });

        // ═══════════════════════════════════════════════════════════
        // AUTH ENGINE — Logic-based, localStorage, no backend
        // ═══════════════════════════════════════════════════════════

        const hashPassword = (pw) => {
            let h = 0x811c9dc5;
            for (let i = 0; i < pw.length; i++) { h ^= pw.charCodeAt(i); h = (h * 0x01000193) >>> 0; }
            return h.toString(16).padStart(8, '0') + btoa(pw.split('').reverse().join('')).slice(0, 16);
        };

        const makeToken = (uid, email, role) => {
            const header = btoa(JSON.stringify({ alg: 'HS256', typ: 'JWT' }));
            const payload = btoa(JSON.stringify({ uid, email, role, iat: Date.now(), exp: Date.now() + 86400000 * 7 }));
            const sig = btoa(uid + email + role + 'vibe_secret').slice(0, 16);
            return `${header}.${payload}.${sig}`;
        };

        const parseToken = (token) => {
            try { const [, p] = token.split('.'); const d = JSON.parse(atob(p)); if (d.exp < Date.now()) return null; return d; } catch { return null; }
        };

        const isValidEmail = (e) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);
        const pwStrength = (pw) => { let s = 0; if (pw.length >= 8) s++; if (/[A-Z]/.test(pw)) s++; if (/[0-9]/.test(pw)) s++; if (/[^A-Za-z0-9]/.test(pw)) s++; return s; };
        const PW_LEVELS = [
            { label: 'Too weak', color: 'var(--accent3)' }, { label: 'Weak', color: '#FF8C42' },
            { label: 'Fair', color: 'var(--accent4)' }, { label: 'Strong', color: 'var(--accent)' }, { label: 'Very strong', color: 'var(--accent2)' }
        ];

        const DB = {
            getUsers: () => { try { return JSON.parse(localStorage.getItem('vc_users') || '{}') } catch { return {} } },
            setUsers: (u) => { try { localStorage.setItem('vc_users', JSON.stringify(u)) } catch { } },
            getUser: (uid) => DB.getUsers()[uid] || null,
            saveUser: (uid, data) => { const users = DB.getUsers(); users[uid] = { ...users[uid], ...data }; DB.setUsers(users); return users[uid]; },
            findByEmail: (email) => { const users = DB.getUsers(); return Object.values(users).find(u => u.email && u.email.toLowerCase() === email.toLowerCase()) || null; },
            getToken: () => { try { return localStorage.getItem('vc_token') } catch { return null } },
            setToken: (t) => { try { localStorage.setItem('vc_token', t) } catch { } },
            clearToken: () => { try { localStorage.removeItem('vc_token') } catch { } },
            getSession: () => { const token = DB.getToken(); if (!token) return null; const p = parseToken(token); if (!p) { DB.clearToken(); return null; } return DB.getUser(p.uid); },
        };

        // Seed demo accounts
        (() => {
            try {
                if (!DB.findByEmail('student@vibe.com')) {
                    DB.saveUser('demo_student', {
                        uid: 'demo_student', name: 'Arjun Sharma', email: 'student@vibe.com',
                        passwordHash: hashPassword('Demo@123'), role: 'student', createdAt: new Date().toISOString(),
                        streak: 12, coins: 840, skills: ['C', 'Python', 'JavaScript', 'DSA'], avatar: 'AS',
                        careerScore: { overall: 67, coding: 72, dsa: 58, consistency: 85, resume: 54, interview: 44, projects: 71 },
                        progress: { basics: 72, dsa: 45, development: 61, resume: 80, interview: 30, jobs: 20 },
                        solvedProblems: [1, 2, 3, 5, 7, 8, 12, 15, 18, 20, 22, 24, 25],
                        notifications: [
                            { id: 1, type: 'success', msg: 'You solved "Two Sum"! +50 XP', read: false, time: '2m ago' },
                            { id: 2, type: 'info', msg: 'Weekly report is ready 📊', read: false, time: '1h ago' },
                            { id: 3, type: 'warning', msg: 'Keep your streak! Day 12 🔥', read: true, time: '3h ago' },
                        ]
                    });
                }
                if (!DB.findByEmail('creator@vibe.com')) {
                    DB.saveUser('demo_creator', {
                        uid: 'demo_creator', name: 'Priya Mehta', email: 'creator@vibe.com',
                        passwordHash: hashPassword('Demo@123'), role: 'creator', createdAt: new Date().toISOString(),
                        streak: 28, coins: 3200, skills: ['Teaching', 'React', 'DSA', 'Content'], avatar: 'PM',
                        careerScore: { overall: 0, coding: 0, dsa: 0, consistency: 0, resume: 0, interview: 0, projects: 0 },
                        progress: { basics: 0, dsa: 0, development: 0, resume: 0, interview: 0, jobs: 0 },
                        solvedProblems: [], notifications: [], courses_created: 3, total_students: 4200
                    });
                }
            } catch (e) { console.warn('DB seed error:', e); }
        })();

        // ─── ANTHROPIC API HELPER ─────────────────────────────────────────────────────
        async function callClaude(messages, systemPrompt = '', maxTokens = 1000) {
            const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "x-api-key": "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",
                    "anthropic-version": "2023-06-01",
                    "anthropic-dangerous-direct-browser-access": "true"
                },
                body: JSON.stringify({
                    model: "claude-sonnet-4-20250514",
                    max_tokens: maxTokens,
                    system: systemPrompt,
                    messages: messages,
                })
            });
            if (!response.ok) {
                const err = await response.json().catch(() => ({}));
                throw new Error(err.error?.message || `API error ${response.status}`);
            }
            const data = await response.json();
            return data.content.map(b => b.text || '').join('');
        }

        async function callClaudeStream(messages, ystemPrompt = '', maxTokens = 1000, onChunk) {
            const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "x-api-key": "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",
                    "anthropic-version": "2023-06-01",
                    "anthropic-dangerous-direct-browser-access": "true"
                },
                body: JSON.stringify({
                    model: "claude-sonnet-4-20250514",
                    max_tokens: maxTokens,
                    system: systemPrompt,
                    messages: messages,
                    stream: true,
                })
            });
            if (!response.ok) {
                const err = await response.json().catch(() => ({}));
                throw new Error(err.error?.message || `API error ${response.status}`);
            }
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let full = '';
            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                const chunk = decoder.decode(value);
                const lines = chunk.split('\n');
                for (const line of lines) {
                    if (line.startsWith('data: ')) {
                        try {
                            const json = JSON.parse(line.slice(6));
                            if (json.type === 'content_block_delta' && json.delta?.text) {
                                full += json.delta.text;
                                onChunk(full);
                            }
                        } catch { }
                    }
                }
            }
            return full;
        }

        // ─── GLOBAL DATA ──────────────────────────────────────────
        const PROBLEMS = [
            { id: 1, title: 'Two Sum', difficulty: 'Easy', category: 'Arrays', tags: ['array', 'hash-map'], acceptance: 89, solved: true, xp: 50, description: 'Given an array of integers nums and an integer target, return indices of the two numbers such that they add up to target.\n\nYou may assume that each input would have exactly one solution, and you may not use the same element twice.', examples: [{ in: 'nums = [2,7,11,15], target = 9', out: '[0,1]' }, { in: 'nums = [3,2,4], target = 6', out: '[1,2]' }], starter: 'function twoSum(nums, target) {\n  // Write your solution here\n  \n}' },
            { id: 2, title: 'Reverse String', difficulty: 'Easy', category: 'Strings', tags: ['string', 'two-pointer'], acceptance: 94, solved: true, xp: 40, description: 'Write a function that reverses a string. The input string is given as an array of characters s.\nYou must do this by modifying the input array in-place with O(1) extra memory.', examples: [{ in: 's = ["h","e","l","l","o"]', out: '["o","l","l","e","h"]' }], starter: 'function reverseString(s) {\n  // Reverse in-place\n  \n}' },
            { id: 3, title: 'Valid Parentheses', difficulty: 'Easy', category: 'Stack', tags: ['stack', 'string'], acceptance: 78, solved: true, xp: 60, description: "Given a string s containing just the characters '(', ')', '{', '}', '[' and ']', determine if the input string is valid.", examples: [{ in: 's = "()"', out: 'true' }, { in: 's = "()[]{}"', out: 'true' }, { in: 's = "(]"', out: 'false' }], starter: 'function isValid(s) {\n  \n}' },
            { id: 4, title: 'Merge Sorted Array', difficulty: 'Easy', category: 'Arrays', tags: ['array', 'sorting'], acceptance: 71, solved: false, xp: 55, description: 'You are given two integer arrays nums1 and nums2, sorted in non-decreasing order, and two integers m and n, representing the number of elements in nums1 and nums2 respectively.', examples: [{ in: 'nums1=[1,2,3,0,0,0], m=3, nums2=[2,5,6], n=3', out: '[1,2,2,3,5,6]' }], starter: 'function merge(nums1, m, nums2, n) {\n  \n}' },
            { id: 5, title: 'Maximum Subarray', difficulty: 'Medium', category: 'DP', tags: ['dynamic-programming', 'array'], acceptance: 62, solved: true, xp: 100, description: "Given an integer array nums, find the subarray with the largest sum, and return its sum. This is the classic Kadane's Algorithm problem.", examples: [{ in: 'nums = [-2,1,-3,4,-1,2,1,-5,4]', out: '6' }, { in: 'nums = [1]', out: '1' }], starter: 'function maxSubArray(nums) {\n  \n}' },
            { id: 6, title: 'Binary Tree Level Order', difficulty: 'Medium', category: 'Trees', tags: ['tree', 'bfs', 'queue'], acceptance: 58, solved: false, xp: 120, description: "Given the root of a binary tree, return the level order traversal of its nodes' values.", examples: [{ in: 'root = [3,9,20,null,null,15,7]', out: '[[3],[9,20],[15,7]]' }], starter: 'function levelOrder(root) {\n  \n}' },
            { id: 7, title: 'Climbing Stairs', difficulty: 'Easy', category: 'DP', tags: ['math', 'dp', 'memoization'], acceptance: 86, solved: true, xp: 60, description: 'You are climbing a staircase. It takes n steps to reach the top. Each time you can either climb 1 or 2 steps. In how many distinct ways can you climb to the top?', examples: [{ in: 'n = 2', out: '2' }, { in: 'n = 3', out: '3' }], starter: 'function climbStairs(n) {\n  \n}' },
            { id: 8, title: 'Linked List Cycle', difficulty: 'Easy', category: 'Linked List', tags: ['linked-list', 'two-pointer', 'floyd'], acceptance: 74, solved: true, xp: 70, description: 'Given head, the head of a linked list, determine if the linked list has a cycle in it.', examples: [{ in: 'head = [3,2,0,-4], pos = 1', out: 'true' }], starter: 'function hasCycle(head) {\n  \n}' },
            { id: 9, title: 'Word Search', difficulty: 'Medium', category: 'Backtracking', tags: ['backtracking', 'dfs', 'matrix'], acceptance: 42, solved: false, xp: 150, description: 'Given an m x n grid of characters board and a string word, return true if word exists in the grid.', examples: [{ in: 'board=[["A","B","C","E"],...], word="ABCCED"', out: 'true' }], starter: 'function exist(board, word) {\n  \n}' },
            { id: 10, title: 'LRU Cache', difficulty: 'Hard', category: 'Design', tags: ['hash-map', 'doubly-linked-list', 'design'], acceptance: 35, solved: false, xp: 250, description: 'Design a data structure that follows the constraints of a Least Recently Used (LRU) cache.', examples: [{ in: 'capacity=2, ops=[put(1,1),put(2,2),get(1),put(3,3),get(2)]', out: '[null,null,1,null,-1]' }], starter: 'class LRUCache {\n  constructor(capacity) {\n    \n  }\n  get(key) {\n    \n  }\n  put(key, value) {\n    \n  }\n}' },
            { id: 11, title: 'Trapping Rain Water', difficulty: 'Hard', category: 'Arrays', tags: ['two-pointer', 'stack', 'dp'], acceptance: 28, solved: false, xp: 300, description: 'Given n non-negative integers representing an elevation map where the width of each bar is 1, compute how much water it can trap after raining.', examples: [{ in: 'height = [0,1,0,2,1,0,1,3,2,1,2,1]', out: '6' }], starter: 'function trap(height) {\n  \n}' },
            { id: 12, title: 'Fibonacci Number', difficulty: 'Easy', category: 'Math', tags: ['math', 'recursion', 'dp'], acceptance: 92, solved: true, xp: 30, description: 'The Fibonacci numbers form a sequence where each number is the sum of the two preceding ones, starting from 0 and 1.', examples: [{ in: 'n = 4', out: '3' }, { in: 'n = 10', out: '55' }], starter: 'function fib(n) {\n  \n}' },
        ];

        const COURSES = [
            { id: 1, title: 'C Programming Masterclass', creator: 'Dr. Rajesh Kumar', emoji: '🔤', category: 'basics', price: 0, rating: 4.8, students: 12400, duration: '24h', lessons: 48, tags: ['C', 'Programming', 'Basics'], enrolled: true, progress: 72, color: '#1a2744' },
            { id: 2, title: 'DSA with JavaScript', creator: 'Priya Mehta', emoji: '📊', category: 'dsa', price: 999, rating: 4.9, students: 8200, duration: '36h', lessons: 72, tags: ['DSA', 'JavaScript', 'Algorithms'], enrolled: true, progress: 45, color: '#1a2744' },
            { id: 3, title: 'Full Stack Web Dev', creator: 'Amit Singh', emoji: '🌐', category: 'development', price: 1499, rating: 4.7, students: 15000, duration: '60h', lessons: 120, tags: ['React', 'Node', 'MongoDB'], enrolled: false, progress: 0, color: '#1a2744' },
            { id: 4, title: 'System Design Interviews', creator: 'Neha Patel', emoji: '🏗️', category: 'interview', price: 799, rating: 4.9, students: 5100, duration: '20h', lessons: 40, tags: ['System Design', 'Architecture'], enrolled: false, progress: 0, color: '#1a2744' },
            { id: 5, title: 'Python for AI/ML', creator: 'Dr. Vijay Rao', emoji: '🤖', category: 'ai', price: 1299, rating: 4.8, students: 9800, duration: '42h', lessons: 84, tags: ['Python', 'ML', 'AI'], enrolled: false, progress: 0, color: '#1a2744' },
            { id: 6, title: 'React Advanced Patterns', creator: 'Shreya Gupta', emoji: '⚛️', category: 'development', price: 699, rating: 4.6, students: 3400, duration: '18h', lessons: 36, tags: ['React', 'Hooks', 'Performance'], enrolled: true, progress: 61, color: '#1a2744' },
        ];

        const INTERVIEWS = [
            { id: 1, mentor: 'Vikram Shah', role: 'Sr. SDE @ Google', emoji: '👨‍💻', date: 'Feb 25, 2026', time: '10:00 AM', type: 'Technical', price: 499, rating: 4.9, slots: 3, expertise: ['DSA', 'System Design', 'Coding'], available: true },
            { id: 2, mentor: 'Ananya Krishnan', role: 'Tech Lead @ Microsoft', emoji: '👩‍💻', date: 'Feb 26, 2026', time: '3:00 PM', type: 'Behavioral', price: 299, rating: 4.8, slots: 2, expertise: ['Leadership', 'Communication', 'STAR Method'], available: true },
            { id: 3, mentor: 'Rahul Desai', role: 'Staff Eng @ Amazon', emoji: '🧑‍💻', date: 'Feb 27, 2026', time: '11:00 AM', type: 'System Design', price: 699, rating: 5.0, slots: 1, expertise: ['Distributed Systems', 'HLD', 'LLD'], available: true },
            { id: 4, mentor: 'Pooja Nair', role: 'SDE-II @ Flipkart', emoji: '👩‍🔬', date: 'Mar 1, 2026', time: '4:00 PM', type: 'Mock Full Interview', price: 899, rating: 4.7, slots: 2, expertise: ['Full Stack', 'DSA', 'HR'], available: true },
        ];

        const JOBS = [
            { id: 1, company: 'Google', emoji: '🟡', title: 'SDE-I', location: 'Bangalore', type: 'Full-time', salary: '₹30-45 LPA', minScore: 80, skills: ['DSA', 'System Design', 'Python'], posted: '2d ago', applicants: 234, match: 82 },
            { id: 2, company: 'Zepto', emoji: '🟣', title: 'Frontend Engineer', location: 'Mumbai', type: 'Full-time', salary: '₹18-28 LPA', minScore: 60, skills: ['React', 'JavaScript', 'CSS'], posted: '1d ago', applicants: 89, match: 91 },
            { id: 3, company: 'Razorpay', emoji: '🔵', title: 'Backend Developer', location: 'Remote', type: 'Full-time', salary: '₹22-35 LPA', minScore: 65, skills: ['Node.js', 'MongoDB', 'Redis'], posted: '3d ago', applicants: 156, match: 74 },
            { id: 4, company: 'Cred', emoji: '🟢', title: 'SDE-2', location: 'Bangalore', type: 'Full-time', salary: '₹35-55 LPA', minScore: 85, skills: ['DSA', 'Java', 'Microservices'], posted: '5h ago', applicants: 67, match: 55 },
            { id: 5, company: 'PhonePe', emoji: '🟠', title: 'Fullstack Intern', location: 'Pune', type: 'Internship', salary: '₹30-50K/mo', minScore: 45, skills: ['React', 'Node.js'], posted: '1d ago', applicants: 412, match: 95 },
            { id: 6, company: 'Swiggy', emoji: '🔴', title: 'Mobile Developer', location: 'Hyderabad', type: 'Full-time', salary: '₹20-32 LPA', minScore: 55, skills: ['React Native', 'JavaScript'], posted: '4d ago', applicants: 103, match: 68 },
        ];

        const ROADMAP_ITEMS = {
            basics: {
                title: 'C Language Fundamentals', icon: '🔤', color: '#4ADE80', items: [
                    { id: 1, title: 'Variables & Data Types', done: true, subtopics: ['int, float, char, double', 'Type casting', 'Constants'] },
                    { id: 2, title: 'Operators & Expressions', done: true, subtopics: ['Arithmetic', 'Logical', 'Bitwise'] },
                    { id: 3, title: 'Control Flow', done: true, subtopics: ['if-else', 'switch', 'loops'] },
                    { id: 4, title: 'Functions & Recursion', done: true, subtopics: ['Function declaration', 'Recursion', 'Stack'] },
                    { id: 5, title: 'Arrays & Strings', done: true, subtopics: ['1D/2D arrays', 'String functions'] },
                    { id: 6, title: 'Pointers', done: false, subtopics: ['Pointer arithmetic', 'Double pointers', 'Function pointers'] },
                    { id: 7, title: 'Structures & Unions', done: false, subtopics: ['struct', 'union', 'typedef'] },
                    { id: 8, title: 'File Handling', done: false, subtopics: ['fopen/fclose', 'fread/fwrite', 'fprintf'] },
                    { id: 9, title: 'Memory Management', done: false, subtopics: ['malloc', 'calloc', 'free'] },
                ]
            },
            dsa: {
                title: 'Data Structures & Algorithms', icon: '📊', color: '#60A5FA', items: [
                    { id: 1, title: 'Arrays & Hashing', done: true, subtopics: ['Sliding window', 'Two pointers', 'Hash maps'] },
                    { id: 2, title: 'Linked Lists', done: true, subtopics: ["Singly/Doubly", "Floyd's cycle", "Reversal"] },
                    { id: 3, title: 'Stacks & Queues', done: true, subtopics: ['Monotonic stack', 'Deque', 'Priority Queue'] },
                    { id: 4, title: 'Trees', done: false, subtopics: ['BST', 'BFS/DFS', 'Segment Tree'] },
                    { id: 5, title: 'Heaps', done: false, subtopics: ['Min/Max heap', 'K-th largest'] },
                    { id: 6, title: 'Graphs', done: false, subtopics: ['Dijkstra', 'Topological sort', 'Union Find'] },
                    { id: 7, title: 'Dynamic Programming', done: false, subtopics: ['Memoization', 'Tabulation', 'LCS', 'Knapsack'] },
                    { id: 8, title: 'Backtracking', done: false, subtopics: ['N-Queens', 'Sudoku', 'Permutations'] },
                ]
            },
            development: {
                title: 'Web Development', icon: '🌐', color: '#F472B6', items: [
                    { id: 1, title: 'HTML5 Fundamentals', done: true, subtopics: ['Semantic HTML', 'Forms', 'Accessibility'] },
                    { id: 2, title: 'CSS3 & Flexbox/Grid', done: true, subtopics: ['Flexbox', 'Grid', 'Animations', 'Responsive'] },
                    { id: 3, title: 'JavaScript ES6+', done: true, subtopics: ['Promises', 'Async/Await', 'Destructuring'] },
                    { id: 4, title: 'React.js', done: true, subtopics: ['Hooks', 'Context', 'Redux', 'Router'] },
                    { id: 5, title: 'Node.js & Express', done: false, subtopics: ['REST APIs', 'Middleware', 'Authentication'] },
                    { id: 6, title: 'MongoDB & Databases', done: false, subtopics: ['Mongoose', 'Aggregation', 'Indexing'] },
                    { id: 7, title: 'Deployment & DevOps', done: false, subtopics: ['Docker', 'CI/CD', 'AWS/Vercel'] },
                ]
            },
            resume: {
                title: 'Resume & ATS', icon: '📄', color: '#FBBF24', items: [
                    { id: 1, title: 'Resume Structure', done: true, subtopics: ['Format', 'Sections', 'Length'] },
                    { id: 2, title: 'Writing Work Experience', done: true, subtopics: ['STAR Method', 'Metrics', 'Action verbs'] },
                    { id: 3, title: 'Projects Section', done: true, subtopics: ['Tech stack', 'Impact', 'GitHub links'] },
                    { id: 4, title: 'Skills Optimization', done: true, subtopics: ['Keywords', 'ATS optimization'] },
                    { id: 5, title: 'ATS Score Improvement', done: false, subtopics: ['Keyword matching', 'Formatting tips'] },
                    { id: 6, title: 'LinkedIn Optimization', done: false, subtopics: ['Headline', 'Summary', 'Skills'] },
                ]
            },
            interview: {
                title: 'Interview Practice', icon: '🎤', color: '#A78BFA', items: [
                    { id: 1, title: 'Behavioral Questions', done: false, subtopics: ['STAR Method', 'Common questions', 'Practice answers'] },
                    { id: 2, title: 'Technical Interviews', done: false, subtopics: ['Coding rounds', 'Problem solving approach'] },
                    { id: 3, title: 'System Design', done: false, subtopics: ['HLD', 'LLD', 'Scalability'] },
                    { id: 4, title: 'HR Round', done: false, subtopics: ['Salary negotiation', 'Company research'] },
                ]
            },
            jobs: {
                title: 'Job Applications', icon: '💼', color: '#FB923C', items: [
                    { id: 1, title: 'Job Search Strategy', done: false, subtopics: ['Platforms', 'Referrals', 'Cold outreach'] },
                    { id: 2, title: 'Application Tracking', done: false, subtopics: ['Spreadsheet', 'Follow-ups'] },
                    { id: 3, title: 'Offer Evaluation', done: false, subtopics: ['CTC breakdown', 'Benefits', 'Growth'] },
                ]
            },
        };

        // ─── UTILITIES ────────────────────────────────────────────────────────────────
        function ScoreRing({ score, size = 100, stroke = 8, color = '#00F5A0' }) {
            const r = (size - stroke) / 2, circ = 2 * Math.PI * r, offset = circ - (score / 100) * circ;
            return (
                <div className="score-ring" style={{ width: size, height: size }}>
                    <svg width={size} height={size}>
                        <circle cx={size / 2} cy={size / 2} r={r} fill="none" stroke="var(--border)" strokeWidth={stroke} />
                        <circle cx={size / 2} cy={size / 2} r={r} fill="none" stroke={color} strokeWidth={stroke}
                            strokeDasharray={circ} strokeDashoffset={offset} strokeLinecap="round"
                            style={{ transition: 'stroke-dashoffset .8s ease' }} />
                    </svg>
                    <div className="score-ring-inner">
                        <div className="score-ring-num" style={{ fontSize: size * .22, color }}>{score}</div>
                        <div className="score-ring-label" style={{ fontSize: size * .09 }}>SCORE</div>
                    </div>
                </div>
            );
        }

        function ProgressBar({ value, color = 'linear-gradient(90deg,#00F5A0,#00C8FF)', height = 6 }) {
            return (
                <div className="progress-bar" style={{ height }}>
                    <div className="progress-fill" style={{ width: `${value}%`, background: color, height }} />
                </div>
            );
        }

        function NotifToast({ notifs, dismiss }) {
            return (
                <div className="notif">
                    {notifs.map(n => (
                        <div key={n.id} className={`notif-item ${n.type}`} onClick={() => dismiss(n.id)} style={{ cursor: 'pointer' }}>
                            <span style={{ fontSize: 18 }}>{n.type === 'success' ? '✅' : n.type === 'error' ? '❌' : n.type === 'warning' ? '⚠️' : 'ℹ️'}</span>
                            <div>
                                <div style={{ fontSize: 13, fontWeight: 600 }}>{n.msg}</div>
                                <div style={{ fontSize: 11, color: 'var(--text3)', marginTop: 2 }}>{n.time} · click to dismiss</div>
                            </div>
                        </div>
                    ))}
                </div>
            );
        }

        // ═══════════════════════════════════════════════════════════
        // ROLE SELECTOR MODAL
        // ═══════════════════════════════════════════════════════════
        function RoleSelectModal({ onSelect, onClose }) {
            const roles = [
                { id: 'student', icon: '🎓', title: 'Student / Job Seeker', desc: 'Learn, practice DSA, build resume, crack interviews', color: 'var(--accent)' },
                { id: 'creator', icon: '🎬', title: 'Course Creator', desc: 'Create courses, grow your audience, earn revenue', color: 'var(--accent2)' },
            ];
            const [hovered, setHovered] = useState(null);
            return (
                <div className="auth-modal-bg" onClick={onClose}>
                    <div style={{ background: 'var(--surface)', border: '1px solid var(--border)', borderRadius: 20, padding: 36, maxWidth: 500, width: '100%', animation: 'fadeIn .25s ease', position: 'relative' }} onClick={e => e.stopPropagation()}>
                        <button style={{ position: 'absolute', top: 16, right: 16, background: 'none', border: 'none', color: 'var(--text3)', fontSize: 18, cursor: 'pointer', padding: '4px 8px' }} onClick={onClose}>✕</button>
                        <div style={{ textAlign: 'center', marginBottom: 28 }}>
                            <div style={{ width: 52, height: 52, background: 'var(--accent)', borderRadius: 14, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 24, fontWeight: 900, color: '#000', margin: '0 auto 14px', animation: 'glow 2s ease-in-out infinite' }}>⚡</div>
                            <h2 style={{ fontSize: 22, fontWeight: 800, marginBottom: 6 }}>Join Vibe Coding</h2>
                            <p style={{ fontSize: 14, color: 'var(--text2)' }}>Who are you joining as?</p>
                        </div>
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 14, marginBottom: 24 }}>
                            {roles.map(r => (
                                <div key={r.id} className={`role-card ${hovered === r.id ? 'selected' : ''}`}
                                    onMouseEnter={() => setHovered(r.id)} onMouseLeave={() => setHovered(null)}
                                    onClick={() => onSelect(r.id)}
                                    style={{ borderColor: hovered === r.id ? r.color : 'var(--border)', boxShadow: hovered === r.id ? `0 0 20px ${r.color}20` : undefined }}>
                                    <div style={{ fontSize: 36, marginBottom: 10 }}>{r.icon}</div>
                                    <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 6, color: hovered === r.id ? r.color : 'var(--text)' }}>{r.title}</div>
                                    <div style={{ fontSize: 12, color: 'var(--text2)', lineHeight: 1.5 }}>{r.desc}</div>
                                    {hovered === r.id && (
                                        <div style={{ marginTop: 12, background: `${r.color}15`, border: `1px solid ${r.color}30`, borderRadius: 8, padding: '6px 12px', fontSize: 12, fontWeight: 700, color: r.color }}>
                                            Continue as {r.title.split('/')[0].trim()} →
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                        <div style={{ textAlign: 'center', fontSize: 13, color: 'var(--text3)' }}>
                            Already have an account?{' '}
                            <span style={{ color: 'var(--accent)', cursor: 'pointer', fontWeight: 600 }} onClick={() => onSelect('login')}>Sign in</span>
                        </div>
                    </div>
                </div>
            );
        }

        // ═══════════════════════════════════════════════════════════
        // AUTH PAGE — real login/register with validation
        // ═══════════════════════════════════════════════════════════
        function AuthPage({ initialRole, initialMode, onSuccess, onClose }) {
            const [mode, setMode] = useState(initialMode || 'login');
            const [role, setRole] = useState(initialRole || 'student');
            const [showPw, setShowPw] = useState(false);
            const [loading, setLoading] = useState(false);
            const [errs, setErrs] = useState({});
            const [shake, setShake] = useState(false);
            const [f, setF] = useState({ name: '', email: '', password: '', confirm: '' });
            const inp = k => e => setF(p => ({ ...p, [k]: e.target.value }));
            const strength = pwStrength(f.password);

            const fillDemo = () => {
                if (mode === 'login') {
                    setF({ name: '', email: role === 'creator' ? 'creator@vibe.com' : 'student@vibe.com', password: 'Demo@123', confirm: '' });
                }
            };

            const validate = () => {
                const e = {};
                if (mode === 'register') {
                    if (!f.name.trim()) e.name = 'Name is required';
                    else if (f.name.trim().length < 2) e.name = 'At least 2 characters';
                }
                if (!f.email) e.email = 'Email is required';
                else if (!isValidEmail(f.email)) e.email = 'Enter a valid email';
                if (!f.password) e.password = 'Password is required';
                else if (f.password.length < 6) e.password = 'Minimum 6 characters';
                if (mode === 'register' && f.password !== f.confirm) e.confirm = 'Passwords do not match';
                return e;
            };

            const doShake = () => { setShake(true); setTimeout(() => setShake(false), 500); };

            const submit = async () => {
                const e = validate();
                setErrs(e);
                if (Object.keys(e).length) { doShake(); return; }
                setLoading(true);
                await new Promise(r => setTimeout(r, 700));

                if (mode === 'register') {
                    if (DB.findByEmail(f.email)) {
                        setErrs({ email: 'An account with this email already exists.' });
                        setLoading(false); doShake(); return;
                    }
                    const uid = 'u_' + Date.now();
                    const userData = {
                        uid, name: f.name.trim(), email: f.email.trim().toLowerCase(),
                        passwordHash: hashPassword(f.password), role, createdAt: new Date().toISOString(),
                        streak: 0, coins: 100, skills: [], avatar: f.name.trim().slice(0, 2).toUpperCase(),
                        careerScore: { overall: 0, coding: 0, dsa: 0, consistency: 0, resume: 0, interview: 0, projects: 0 },
                        progress: { basics: 0, dsa: 0, development: 0, resume: 0, interview: 0, jobs: 0 },
                        solvedProblems: [], notifications: [
                            { id: 1, type: 'success', msg: 'Welcome to Vibe Coding! 🎉', read: false, time: 'just now' }
                        ]
                    };
                    DB.saveUser(uid, userData);
                    DB.setToken(makeToken(uid, f.email, role));
                    setLoading(false);
                    onSuccess(userData);
                } else {
                    const found = DB.findByEmail(f.email);
                    if (!found) { setErrs({ email: 'No account found with this email.' }); setLoading(false); doShake(); return; }
                    if (found.passwordHash !== hashPassword(f.password)) { setErrs({ password: 'Incorrect password. Try again.' }); setLoading(false); doShake(); return; }
                    DB.setToken(makeToken(found.uid, found.email, found.role));
                    setLoading(false);
                    onSuccess(found);
                }
            };

            const roles = [{ id: 'student', icon: '🎓', label: 'Student' }, { id: 'creator', icon: '🎬', label: 'Creator' }];

            return (
                <div className="auth-modal-bg" onClick={onClose}>
                    <div style={{ background: 'var(--surface)', border: '1px solid var(--border)', borderRadius: 20, padding: 36, maxWidth: 440, width: '100%', animation: shake ? 'shake .4s ease' : 'fadeIn .25s ease', position: 'relative' }} onClick={e => e.stopPropagation()}>
                        <button style={{ position: 'absolute', top: 16, right: 16, background: 'none', border: 'none', color: 'var(--text3)', fontSize: 18, cursor: 'pointer', padding: '4px 8px' }} onClick={onClose}>✕</button>

                        <div style={{ textAlign: 'center', marginBottom: 24 }}>
                            <div style={{ width: 48, height: 48, background: 'var(--accent)', borderRadius: 12, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 20, fontWeight: 900, color: '#000', margin: '0 auto 12px', animation: 'glow 2s ease-in-out infinite' }}>⚡</div>
                            <h2 style={{ fontSize: 22, fontWeight: 800, marginBottom: 4 }}>{mode === 'login' ? 'Welcome back!' : 'Create account'}</h2>
                            <p style={{ fontSize: 13, color: 'var(--text2)' }}>{mode === 'login' ? 'Sign in to continue your journey' : 'Join 50,000+ developers on Vibe Coding'}</p>
                        </div>

                        <div onClick={fillDemo} style={{ background: 'rgba(0,200,255,.08)', border: '1px solid rgba(0,200,255,.2)', borderRadius: 10, padding: '10px 14px', fontSize: 12, color: 'var(--accent2)', cursor: 'pointer', marginBottom: 18, display: 'flex', alignItems: 'center', gap: 8 }}>
                            <span>💡</span>
                            <span><strong>Demo:</strong> Click to auto-fill — password: <code>Demo@123</code></span>
                        </div>

                        {mode === 'register' && (
                            <div style={{ marginBottom: 18 }}>
                                <label>I am joining as</label>
                                <div style={{ display: 'flex', gap: 8, marginTop: 6 }}>
                                    {roles.map(r => (
                                        <button key={r.id} onClick={() => setRole(r.id)} style={{ flex: 1, padding: '10px', borderRadius: 9, border: `2px solid ${role === r.id ? 'var(--accent)' : 'var(--border)'}`, background: role === r.id ? 'rgba(0,245,160,.08)' : 'var(--surface2)', color: role === r.id ? 'var(--accent)' : 'var(--text2)', fontFamily: 'Syne,sans-serif', fontWeight: 700, fontSize: 13, cursor: 'pointer', transition: 'all .18s', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 6 }}>
                                            {r.icon} {r.label}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {mode === 'register' && (
                            <div style={{ marginBottom: 14 }}>
                                <label>Full Name</label>
                                <input className={errs.name ? 'err' : ''} placeholder="Arjun Sharma" value={f.name} onChange={inp('name')} onKeyDown={e => e.key === 'Enter' && submit()} />
                                {errs.name && <div className="field-err">⚠ {errs.name}</div>}
                            </div>
                        )}

                        <div style={{ marginBottom: 14 }}>
                            <label>Email Address</label>
                            <input className={errs.email ? 'err' : ''} type="email" placeholder="you@example.com" value={f.email} onChange={inp('email')} onKeyDown={e => e.key === 'Enter' && submit()} />
                            {errs.email && <div className="field-err">⚠ {errs.email}</div>}
                        </div>

                        <div style={{ marginBottom: 14 }}>
                            <label>Password</label>
                            <div className="pw-wrap">
                                <input className={errs.password ? 'err' : ''} type={showPw ? 'text' : 'password'} placeholder={mode === 'register' ? 'Min. 6 characters' : 'Your password'} value={f.password} onChange={inp('password')} style={{ paddingRight: 40 }} onKeyDown={e => e.key === 'Enter' && submit()} />
                                <span className="pw-eye" onClick={() => setShowPw(p => !p)}>{showPw ? '🙈' : '👁️'}</span>
                            </div>
                            {mode === 'register' && f.password && (
                                <div style={{ marginTop: 5 }}>
                                    <div style={{ background: PW_LEVELS[strength]?.color, width: `${(strength / 4) * 100}%`, height: 4, borderRadius: 99, transition: 'all .3s' }} />
                                    <div style={{ color: PW_LEVELS[strength]?.color, fontSize: 11, marginTop: 3, fontWeight: 700 }}>{PW_LEVELS[strength]?.label}</div>
                                </div>
                            )}
                            {errs.password && <div className="field-err">⚠ {errs.password}</div>}
                        </div>

                        {mode === 'register' && (
                            <div style={{ marginBottom: 18 }}>
                                <label>Confirm Password</label>
                                <input className={errs.confirm ? 'err' : ''} type="password" placeholder="Repeat password" value={f.confirm} onChange={inp('confirm')} onKeyDown={e => e.key === 'Enter' && submit()} />
                                {errs.confirm && <div className="field-err">⚠ {errs.confirm}</div>}
                            </div>
                        )}

                        <button className="btn btn-primary" style={{ width: '100%', justifyContent: 'center', padding: 13, fontSize: 15, marginBottom: 14 }} onClick={submit} disabled={loading}>
                            {loading ? <span className="loading" /> : mode === 'login' ? 'Sign In →' : 'Create Account →'}
                        </button>

                        {mode === 'register' && (
                            <div style={{ background: 'rgba(249,115,22,.05)', border: '1px solid rgba(0,245,160,.15)', borderRadius: 8, padding: '10px 14px', fontSize: 12, color: 'var(--text2)', marginBottom: 14 }}>
                                🔒 Password is hashed locally. No data leaves your browser.
                            </div>
                        )}

                        <div style={{ textAlign: 'center', fontSize: 13, color: 'var(--text2)' }}>
                            {mode === 'login' ? 'No account?' : 'Have an account?'}{' '}
                            <span style={{ color: 'var(--accent)', cursor: 'pointer', fontWeight: 600 }} onClick={() => { setMode(mode === 'login' ? 'register' : 'login'); setErrs({}); setF({ name: '', email: '', password: '', confirm: '' }); }}>
                                {mode === 'login' ? 'Sign up free' : 'Sign in'}
                            </span>
                        </div>
                    </div>
                </div>
            );
        }

        // ─── SIDEBAR ──────────────────────────────────────────────────────────────────
        function Sidebar({ page, setPage, user, onLogout }) {
            const navItems = [
                {
                    section: 'Overview', items: [
                        { id: 'dashboard', label: 'Dashboard', icon: '🏠' },
                        { id: 'leaderboard', label: 'Leaderboard', icon: '🏆' },
                    ]
                },
                {
                    section: 'Learning', items: [
                        { id: 'roadmap', label: 'Roadmap', icon: '🗺️' },
                        { id: 'problems', label: 'Problems', icon: '💻' },
                        { id: 'courses', label: 'Courses', icon: '📚' },
                    ]
                },
                {
                    section: 'Career', items: [
                        { id: 'resume', label: 'Resume Builder', icon: '📄' },
                        { id: 'interview', label: 'Interviews', icon: '🎤' },
                        { id: 'jobs', label: 'Jobs', icon: '💼' },
                    ]
                },
                {
                    section: 'AI Tools', items: [
                        { id: 'ai', label: 'AI Coach', icon: '🤖', badge: true },
                    ]
                },
            ];

            return (
                <div className="sidebar">
                    <div className="sidebar-logo">
                        <div className="logo-mark">⚡</div>
                        <div>
                            <div style={{ fontWeight: 800, fontSize: 15, letterSpacing: '-0.5px' }}>Vibe Coding</div>
                            <div style={{ fontSize: 10, color: 'var(--accent)', fontFamily: 'Poppins', letterSpacing: 1 }}>BETA v1.0</div>
                        </div>
                    </div>
                    <div className="sidebar-nav">
                        {navItems.map(section => (
                            <div className="nav-section" key={section.section}>
                                <div className="nav-section-label">{section.section}</div>
                                {section.items.map(item => (
                                    <div key={item.id} className={`nav-item ${page === item.id ? 'active' : ''}`} onClick={() => setPage(item.id)}>
                                        <span className="icon">{item.icon}</span>
                                        {item.label}
                                        {item.badge && <span className="badge-count">AI</span>}
                                    </div>
                                ))}
                            </div>
                        ))}
                    </div>
                    <div style={{ padding: '20px', borderTop: '1.5px solid var(--border)' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 10, marginBottom: 10 }}>
                            <div className="avatar" style={{ width: 36, height: 36, background: 'linear-gradient(135deg,var(--accent),var(--accent2))', fontSize: 13, color: '#000' }}>
                                {(user.avatar || user.name.slice(0, 2)).toUpperCase()}
                            </div>
                            <div style={{ flex: 1, overflow: 'hidden' }}>
                                <div style={{ fontWeight: 700, fontSize: 13, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{user.name}</div>
                                <div style={{ fontSize: 11, color: 'var(--accent)' }}>
                                    {user.role === 'creator' ? '🎬 Creator' : '🎓 Student'}
                                    {user.streak > 0 && ` · 🔥 ${user.streak}`}
                                </div>
                            </div>
                            <div style={{ fontSize: 12, color: 'var(--text2)' }}>⚡{user.coins || 0}</div>
                        </div>
                        <button className="btn btn-danger btn-sm" style={{ width: '100%', justifyContent: 'center' }} onClick={onLogout}>
                            🚪 Sign Out
                        </button>
                    </div>
                </div>
            );
        }

        // ─── TOPBAR ───────────────────────────────────────────────────────────────────
        function Topbar({ title, user, setPage, unreadCount, showNotifs, setShowNotifs }) {
            return (
                <div className="topbar">
                    <div className="topbar-left">
                        <div style={{ fontWeight: 800, fontSize: 16 }}>{title}</div>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                        <div className="api-badge">⚡ Claude AI Connected</div>
                        <div style={{ position: 'relative', cursor: 'pointer' }} onClick={() => setShowNotifs(!showNotifs)}>
                            <span style={{ fontSize: 20 }}>🔔</span>
                            {unreadCount > 0 && <div className="notif-dot" />}
                        </div>
                        <div style={{ background: 'var(--surface2)', border: '1.5px solid var(--border)', borderRadius: 8, padding: '6px 12px', fontSize: 12, color: 'var(--accent)', fontFamily: 'Poppins' }}>
                            🏆 {user.careerScore?.overall || 0}/100
                        </div>
                        <div className="avatar" style={{ width: 32, height: 32, background: 'linear-gradient(135deg,var(--accent),var(--accent2))', fontSize: 12, color: '#000', cursor: 'pointer' }}>
                            {(user.avatar || user.name.slice(0, 2)).toUpperCase()}
                        </div>
                    </div>
                </div>
            );
        }

        // ─── LANDING PAGE ──────────────────────────────────────────────────────────────
        function LandingPage({ onCTA, onLogin }) {
            return (
                <div style={{ background: 'var(--bg)', minHeight: '100vh' }}>
                    <nav style={{ position: 'fixed', top: 0, left: 0, right: 0, zIndex: 100, background: 'rgba(255,255,255,.95)', backdropFilter: 'blur(20px)', borderBottom: '1.5px solid var(--border)', padding: '0 40px', height: 64, display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
                            <div className="logo-mark">⚡</div>
                            <span style={{ fontWeight: 800, fontSize: 18, letterSpacing: '-0.5px' }}>Vibe Coding</span>
                        </div>
                        <div style={{ display: 'flex', gap: 24, alignItems: 'center' }}>
                            {['Features', 'Roadmap', 'Courses', 'Pricing'].map(l => (
                                <span key={l} style={{ color: 'var(--text2)', cursor: 'pointer', fontSize: 14, fontWeight: 700, transition: 'color .2s' }}
                                    onMouseEnter={e => e.target.style.color = 'var(--accent)'} onMouseLeave={e => e.target.style.color = 'var(--text2)'}>{l}</span>
                            ))}
                            <button className="btn btn-ghost btn-sm" onClick={onLogin}>Login</button>
                            <button className="btn btn-primary btn-sm" onClick={onCTA}>Get Started Free →</button>
                        </div>
                    </nav>

                    <section className="hero" style={{ paddingTop: 64 }}>
                        <div className="hero-grid" />
                        <div className="hero-content">
                            <div className="hero-tag">🚀 AI-POWERED EDTECH PLATFORM</div>
                            <h1>Code. Learn.<br />Get Hired.</h1>
                            <p>The all-in-one platform with AI coaching, DSA roadmaps, mock interviews, resume builder & job matching. Built for Indian developers who mean business.</p>
                            <div className="hero-actions">
                                <button className="btn btn-primary btn-lg" onClick={onCTA}>Start Learning Free →</button>
                                <button className="btn btn-ghost btn-lg" onClick={onLogin}>Sign In</button>
                            </div>
                            <div className="hero-stats">
                                {[['50K+', 'Students'], ['500+', 'Problems'], ['200+', 'Courses'], ['95%', 'Placement Rate']].map(([n, l]) => (
                                    <div className="stat-item" key={l}><div className="stat-num">{n}</div><div className="stat-label">{l}</div></div>
                                ))}
                            </div>
                        </div>
                    </section>

                    <section style={{ padding: '96px 40px', maxWidth: 1200, margin: '0 auto' }}>
                        <div style={{ textAlign: 'center', marginBottom: 48 }}>
                            <div className="badge badge-green" style={{ marginBottom: 12 }}>FEATURES</div>
                            <h2 style={{ fontSize: 42, fontWeight: 900, marginBottom: 14 }}>Everything you need to crack your dream job</h2>
                            <p style={{ color: 'var(--text2)', fontSize: 16, maxWidth: 500, margin: '0 auto' }}>From learning to placement — we've got you covered</p>
                        </div>
                        <div className="grid-3" style={{ gap: 20 }}>
                            {[
                                { icon: '🗺️', title: 'Structured Roadmaps', desc: 'C Language → DSA → Web Dev → Resume → Interview → Jobs. Follow proven paths.' },
                                { icon: '💻', title: 'Built-in Code Editor', desc: 'Monaco editor with 5 languages. Submit code, get AI feedback, track your score.' },
                                { icon: '🤖', title: 'Real AI Career Coach', desc: 'Powered by Claude AI. Get personalized recommendations, career readiness score, real-time coaching.' },
                                { icon: '📄', title: 'Resume Builder + ATS', desc: 'Build your resume and get instant AI-powered ATS analysis with specific improvement suggestions.' },
                                { icon: '🎤', title: 'Mock Interviews', desc: 'Book sessions with industry mentors. Get scored by AI. Land that offer.' },
                                { icon: '💼', title: 'Smart Job Matching', desc: 'Jobs matched to your skill score, roadmap progress, and career readiness.' },
                            ].map(f => (
                                <div key={f.title} className="feature-card">
                                    <div className="feature-icon">{f.icon}</div>
                                    <div className="feature-title">{f.title}</div>
                                    <div className="feature-desc">{f.desc}</div>
                                </div>
                            ))}
                        </div>
                    </section>

                    <section style={{ padding: '72px 40px', background: 'var(--surface)', borderTop: '1px solid var(--border)', borderBottom: '1.5px solid var(--border)' }}>
                        <div style={{ textAlign: 'center', marginBottom: 40 }}>
                            <h2 style={{ fontSize: 36, fontWeight: 800, marginBottom: 8 }}>Simple Pricing</h2>
                            <p style={{ color: 'var(--text2)' }}>Start free, upgrade when you're ready</p>
                        </div>
                        <div className="grid-3" style={{ maxWidth: 900, margin: '0 auto', gap: 20 }}>
                            {[
                                { name: 'Free', price: '₹0', features: ['DSA Problems (100+)', 'Basic Roadmap', 'Code Editor', 'Community Access'], cta: 'Get Started', variant: 'ghost' },
                                { name: 'Pro', price: '₹599', sub: '/month', features: ['All Free features', 'All 500+ Problems', 'AI Code Review', 'Mock Interview Access', 'Resume Builder + ATS', 'Job Board Access', 'Weekly AI Reports'], cta: 'Start Pro', variant: 'primary', featured: true },
                                { name: 'Team', price: '₹299', sub: '/user/mo', features: ['Everything in Pro', 'Team Leaderboard', 'Recruiter Access', 'Analytics Dashboard', 'Priority Support'], cta: 'Contact Us', variant: 'ghost' },
                            ].map(p => (
                                <div key={p.name} className={`price-card ${p.featured ? 'featured' : ''}`}>
                                    {p.featured && <div className="badge badge-green" style={{ marginBottom: 12 }}>MOST POPULAR</div>}
                                    <div style={{ fontWeight: 800, fontSize: 20, marginBottom: 8 }}>{p.name}</div>
                                    <div className="price-amount">{p.price}<span style={{ fontSize: 16, color: 'var(--text2)' }}>{p.sub || ''}</span></div>
                                    <div style={{ margin: '20px 0', borderTop: '1px solid var(--border)' }} />
                                    {p.features.map(f => (
                                        <div key={f} style={{ display: 'flex', gap: 8, alignItems: 'center', marginBottom: 8, fontSize: 13, color: 'var(--text2)', textAlign: 'left' }}>
                                            <span style={{ color: 'var(--accent)' }}>✓</span>{f}
                                        </div>
                                    ))}
                                    <button className={`btn btn-${p.variant}`} style={{ width: '100%', marginTop: 20, justifyContent: 'center' }} onClick={onCTA}>
                                        {p.cta} →
                                    </button>
                                </div>
                            ))}
                        </div>
                    </section>

                    <footer style={{ padding: '48px', textAlign: 'center', color: 'var(--text3)', borderTop: '1px solid var(--border)' }}>
                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8, marginBottom: 16 }}>
                            <div className="logo-mark" style={{ width: 28, height: 28, fontSize: 12 }}>⚡</div>
                            <span style={{ fontWeight: 700 }}>Vibe Coding</span>
                        </div>
                        <div style={{ fontSize: 13 }}>© 2026 Vibe Coding. Built with ❤️ for developers.</div>
                    </footer>
                </div>
            );
        }

        // ─── DASHBOARD ────────────────────────────────────────────────────────────────
        function Dashboard({ user, setPage, setActiveProblem }) {
            const weekDays = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const activity = [3, 1, 0, 5, 2, 4, 1];
            const roadmapKeys = Object.keys(user.progress || {});

            // Creator dashboard
            if (user.role === 'creator') {
                return (
                    <div className="page-content fade-in">
                        <div style={{ background: 'linear-gradient(135deg,rgba(0,200,255,.1),rgba(0,245,160,.05))', border: '1px solid rgba(0,200,255,.2)', borderRadius: 16, padding: 24, marginBottom: 24 }}>
                            <div style={{ fontSize: 22, fontWeight: 800, marginBottom: 4 }}>Welcome back, {user.name.split(' ')[0]}! 🎬</div>
                            <div style={{ color: 'var(--text2)', fontSize: 14 }}>Your courses are helping students crack their dream jobs.</div>
                            <div style={{ display: 'flex', gap: 12, marginTop: 12, flexWrap: 'wrap' }}>
                                <div className="badge badge-blue">🎬 Creator Account</div>
                                <div className="badge badge-green">⚡ {user.coins || 100} Coins</div>
                            </div>
                        </div>
                        <div className="grid-4" style={{ marginBottom: 24 }}>
                            {[
                                { label: 'Courses Created', val: user.courses_created || 0, icon: '📚', color: 'var(--accent2)' },
                                { label: 'Total Students', val: (user.total_students || 0).toLocaleString(), icon: '👥', color: 'var(--accent)' },
                                { label: 'Total Revenue', val: '₹' + ((user.total_students || 0) * 500).toLocaleString(), icon: '💰', color: '#FBBF24' },
                                { label: 'Avg Rating', val: '4.8 ⭐', icon: '⭐', color: '#F472B6' },
                            ].map(s => (
                                <div key={s.label} className="card" style={{ padding: 20 }}>
                                    <div style={{ fontSize: 28, marginBottom: 8 }}>{s.icon}</div>
                                    <div style={{ fontSize: 26, fontWeight: 800, color: s.color, fontFamily: 'Poppins' }}>{s.val}</div>
                                    <div style={{ fontSize: 12, color: 'var(--text2)', marginTop: 4 }}>{s.label}</div>
                                </div>
                            ))}
                        </div>
                        <div className="card" style={{ padding: 24 }}>
                            <div className="section-title" style={{ marginBottom: 16 }}>Your Courses</div>
                            {COURSES.filter(c => c.creator === 'Priya Mehta').map(c => (
                                <div key={c.id} style={{ display: 'flex', alignItems: 'center', gap: 14, padding: '14px 0', borderBottom: '1.5px solid var(--border)' }}>
                                    <div style={{ fontSize: 32 }}>{c.emoji}</div>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ fontWeight: 700, fontSize: 14 }}>{c.title}</div>
                                        <div style={{ fontSize: 12, color: 'var(--text2)', marginTop: 2 }}>⭐ {c.rating} · 👥 {c.students.toLocaleString()} students · ⏱ {c.duration}</div>
                                    </div>
                                    <div className="badge badge-green">{c.price === 0 ? 'Free' : '₹' + c.price}</div>
                                </div>
                            ))}
                            <button className="btn btn-primary btn-sm" style={{ marginTop: 16 }}>+ Create New Course</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="page-content fade-in">
                    <div style={{ background: 'linear-gradient(135deg,rgba(0,245,160,.1) 0%,rgba(0,200,255,.05) 100%)', border: '1.5px solid rgba(249,115,22,.2)', borderRadius: 16, padding: 24, marginBottom: 24, display: 'flex', alignItems: 'center', gap: 24, flexWrap: 'wrap' }}>
                        <div style={{ flex: 1 }}>
                            <div style={{ fontSize: 22, fontWeight: 800, marginBottom: 4 }}>Good morning, {user.name.split(' ')[0]}! 👋</div>
                            <div style={{ color: 'var(--text2)', fontSize: 14, marginBottom: 12 }}>
                                {(user.streak || 0) > 0 ? `You're on a 🔥 ${user.streak}-day streak. Keep going!` : 'Start your learning streak today!'}
                            </div>
                            <div style={{ display: 'flex', gap: 12, flexWrap: 'wrap' }}>
                                <div className="badge badge-green">Career Score: {user.careerScore?.overall || 0}/100</div>
                                <div className="badge badge-blue">⚡ {user.coins || 0} XP Coins</div>
                                {(user.streak || 0) > 0 && <div className="badge badge-yellow">🔥 {user.streak} Day Streak</div>}
                                <div className="api-badge">🤖 Claude AI Active</div>
                            </div>
                        </div>
                        <ScoreRing score={user.careerScore?.overall || 0} size={110} />
                    </div>

                    <div className="grid-4" style={{ marginBottom: 24 }}>
                        {[
                            { label: 'Problems Solved', val: user.solvedProblems?.length || 0, icon: '💻', color: 'var(--accent)', delta: '+3 this week' },
                            { label: 'Courses Enrolled', val: COURSES.filter(c => c.enrolled).length, icon: '📚', color: 'var(--accent2)', delta: '2 in progress' },
                            { label: 'Roadmap Progress', val: `${Math.round(Object.values(user.progress || {}).reduce((a, b) => a + b, 0) / Math.max(1, Object.values(user.progress || {}).length))}%`, icon: '🗺️', color: '#F472B6', delta: 'Overall avg' },
                            { label: 'Interview Readiness', val: (user.careerScore?.overall || 0) >= 75 ? 'Ready! ✅' : 'Not Yet', icon: '🎤', color: (user.careerScore?.overall || 0) >= 75 ? 'var(--accent)' : 'var(--accent4)', delta: `Need ${Math.max(0, 75 - (user.careerScore?.overall || 0))} more points` },
                        ].map(s => (
                            <div key={s.label} className="card" style={{ padding: 20 }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 8 }}>
                                    <div style={{ fontSize: 28 }}>{s.icon}</div>
                                    <span style={{ fontSize: 10, color: 'var(--text3)', background: 'var(--surface2)', padding: '2px 8px', borderRadius: 4 }}>{s.delta}</span>
                                </div>
                                <div style={{ fontSize: 28, fontWeight: 800, color: s.color, fontFamily: 'Poppins', marginBottom: 4 }}>{s.val}</div>
                                <div style={{ fontSize: 12, color: 'var(--text2)' }}>{s.label}</div>
                            </div>
                        ))}
                    </div>

                    <div className="grid-2" style={{ marginBottom: 24 }}>
                        <div className="card" style={{ padding: 20 }}>
                            <div className="section-header">
                                <div className="section-title">Roadmap Progress</div>
                                <button className="btn btn-ghost btn-sm" onClick={() => setPage('roadmap')}>View All →</button>
                            </div>
                            {roadmapKeys.map(k => {
                                const r = ROADMAP_ITEMS[k];
                                const colors = { basics: '#4ADE80', dsa: '#60A5FA', development: '#F472B6', resume: '#FBBF24', interview: '#A78BFA', jobs: '#FB923C' };
                                return (
                                    <div key={k} style={{ marginBottom: 14 }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 4 }}>
                                            <span style={{ fontSize: 13, fontWeight: 600 }}>{r.icon} {r.title}</span>
                                            <span style={{ fontSize: 12, fontFamily: 'Poppins', color: colors[k] }}>{user.progress[k]}%</span>
                                        </div>
                                        <ProgressBar value={user.progress[k]} color={`linear-gradient(90deg,${colors[k]},${colors[k]}88)`} />
                                    </div>
                                );
                            })}
                        </div>

                        <div className="card" style={{ padding: 20 }}>
                            <div className="section-header">
                                <div className="section-title">Career Score Breakdown</div>
                                <button className="btn btn-ghost btn-sm" onClick={() => setPage('ai')}>AI Coach →</button>
                            </div>
                            {Object.entries(user.careerScore || {}).filter(([k]) => k !== 'overall').map(([k, v]) => {
                                const labels = { coding: '💻 Coding', dsa: '📊 DSA', consistency: '🔥 Consistency', resume: '📄 Resume', interview: '🎤 Interview', projects: '🏗️ Projects' };
                                const colors = { coding: '#00F5A0', dsa: '#60A5FA', consistency: '#FBBF24', resume: '#F472B6', interview: '#A78BFA', projects: '#FB923C' };
                                return (
                                    <div key={k} style={{ marginBottom: 12 }}>
                                        <div className="skill-bar-label">
                                            <span style={{ fontSize: 12 }}>{labels[k] || k}</span>
                                            <span style={{ fontSize: 12, fontFamily: 'Poppins', color: colors[k] }}>{v}/100</span>
                                        </div>
                                        <div className="skill-bar">
                                            <div className="skill-fill" style={{ width: `${v}%`, background: `linear-gradient(90deg,${colors[k]},${colors[k]}88)` }} />
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    <div className="grid-2" style={{ marginBottom: 24 }}>
                        <div className="card" style={{ padding: 20 }}>
                            <div className="section-header"><div className="section-title">Weekly Activity</div></div>
                            <div className="bar-chart">
                                {weekDays.map((d, i) => (
                                    <div key={d} style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 6 }}>
                                        <div className="bar" style={{ width: '100%', height: `${(activity[i] / 5) * 100}px`, background: activity[i] > 3 ? 'linear-gradient(180deg,var(--accent),rgba(0,245,160,.3))' : 'linear-gradient(180deg,#60A5FA,rgba(96,165,250,.3))' }} />
                                        <div style={{ fontSize: 10, color: 'var(--text3)' }}>{d}</div>
                                    </div>
                                ))}
                            </div>
                            <div style={{ textAlign: 'center', marginTop: 8, fontSize: 12, color: 'var(--text2)' }}>16 problems solved this week 🔥</div>
                        </div>

                        <div className="card" style={{ padding: 20 }}>
                            <div className="section-header">
                                <div className="section-title">Continue Solving</div>
                                <button className="btn btn-ghost btn-sm" onClick={() => setPage('problems')}>All Problems →</button>
                            </div>
                            {PROBLEMS.filter(p => !p.solved).slice(0, 4).map(p => (
                                <div key={p.id} className="problem-row" onClick={() => { setActiveProblem(p); setPage('editor'); }}>
                                    <span style={{ fontSize: 14 }}>{p.difficulty === 'Easy' ? '🟢' : p.difficulty === 'Medium' ? '🟡' : '🔴'}</span>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ fontSize: 13, fontWeight: 600 }}>{p.title}</div>
                                        <div style={{ fontSize: 11, color: 'var(--text2)' }}>{p.category}</div>
                                    </div>
                                    <span className={`badge badge-${p.difficulty === 'Easy' ? 'green' : p.difficulty === 'Medium' ? 'yellow' : 'red'}`}>{p.difficulty}</span>
                                    <span style={{ fontSize: 11, color: 'var(--accent)', fontFamily: 'Poppins' }}>+{p.xp}XP</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="card" style={{ padding: 20 }}>
                        <div className="section-header">
                            <div className="section-title">🤖 AI Recommendations</div>
                            <div className="api-badge" style={{ animation: 'pulse 2s infinite' }}>Claude AI</div>
                        </div>
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3,1fr)', gap: 12 }}>
                            {[
                                { icon: '📊', title: 'Boost your DSA score', desc: "You're at 58% DSA. Solve 5 tree problems to jump to 70%.", action: 'Practice Trees', page: 'problems' },
                                { icon: '📄', title: 'Resume needs work', desc: 'ATS score 54/100. Add more quantified achievements to increase by 20 points.', action: 'Edit Resume', page: 'resume' },
                                { icon: '🎤', title: 'Book a mock interview', desc: 'Career score 67. One good mock interview can push you to interview-ready (75+).', action: 'Book Now', page: 'interview' },
                            ].map((r, i) => (
                                <div key={i} style={{ background: 'var(--surface2)', border: '1.5px solid var(--border)', borderRadius: 12, padding: 16 }}>
                                    <div style={{ fontSize: 24, marginBottom: 8 }}>{r.icon}</div>
                                    <div style={{ fontSize: 13, fontWeight: 700, marginBottom: 6 }}>{r.title}</div>
                                    <div style={{ fontSize: 12, color: 'var(--text2)', marginBottom: 12, lineHeight: 1.5 }}>{r.desc}</div>
                                    <button className="btn btn-secondary btn-sm" onClick={() => setPage(r.page)}>{r.action} →</button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // ─── PROBLEMS PAGE ────────────────────────────────────────────────────────────
        function ProblemsPage({ user, setPage, setActiveProblem }) {
            const [filter, setFilter] = useState('all');
            const [search, setSearch] = useState('');
            const [diff, setDiff] = useState('all');

            const filtered = PROBLEMS.filter(p => {
                if (search && !p.title.toLowerCase().includes(search.toLowerCase())) return false;
                if (diff !== 'all' && p.difficulty !== diff) return false;
                if (filter === 'solved' && !p.solved) return false;
                if (filter === 'unsolved' && p.solved) return false;
                return true;
            });

            const stats = { total: PROBLEMS.length, solved: PROBLEMS.filter(p => p.solved).length };
            return (
                <div className="page-content fade-in">
                    <div className="grid-4" style={{ marginBottom: 24 }}>
                        {[
                            { label: 'Total Solved', val: `${stats.solved}/${stats.total}`, color: 'var(--accent)' },
                            { label: 'Easy', val: `${PROBLEMS.filter(p => p.difficulty === 'Easy' && p.solved).length}/${PROBLEMS.filter(p => p.difficulty === 'Easy').length}`, color: '#4ADE80' },
                            { label: 'Medium', val: `${PROBLEMS.filter(p => p.difficulty === 'Medium' && p.solved).length}/${PROBLEMS.filter(p => p.difficulty === 'Medium').length}`, color: 'var(--accent4)' },
                            { label: 'Hard', val: `${PROBLEMS.filter(p => p.difficulty === 'Hard' && p.solved).length}/${PROBLEMS.filter(p => p.difficulty === 'Hard').length}`, color: 'var(--accent3)' },
                        ].map(s => (
                            <div key={s.label} className="card" style={{ padding: 16, textAlign: 'center' }}>
                                <div style={{ fontSize: 24, fontWeight: 800, color: s.color, fontFamily: 'Poppins' }}>{s.val}</div>
                                <div style={{ fontSize: 12, color: 'var(--text2)', marginTop: 4 }}>{s.label}</div>
                            </div>
                        ))}
                    </div>

                    <div style={{ display: 'flex', gap: 12, marginBottom: 20, flexWrap: 'wrap' }}>
                        <input value={search} onChange={e => setSearch(e.target.value)} placeholder="🔍 Search problems..." style={{ flex: 1, minWidth: 200 }} />
                        <select value={diff} onChange={e => setDiff(e.target.value)} style={{ width: 130 }}>
                            <option value="all">All Levels</option>
                            <option value="Easy">Easy</option>
                            <option value="Medium">Medium</option>
                            <option value="Hard">Hard</option>
                        </select>
                        <div style={{ display: 'flex', gap: 4 }}>
                            {['all', 'solved', 'unsolved'].map(f => (
                                <button key={f} className={`btn btn-sm ${filter === f ? 'btn-primary' : 'btn-ghost'}`} onClick={() => setFilter(f)}>{f.charAt(0).toUpperCase() + f.slice(1)}</button>
                            ))}
                        </div>
                    </div>

                    <div className="card" style={{ overflow: 'hidden' }}>
                        <div style={{ display: 'grid', gridTemplateColumns: '40px 1fr 100px 100px 80px 80px', gap: 12, padding: '12px 16px', borderBottom: '1.5px solid var(--border)', fontSize: 11, color: 'var(--text3)', fontWeight: 700, letterSpacing: 1, textTransform: 'uppercase' }}>
                            <div>#</div><div>Title</div><div>Category</div><div>Difficulty</div><div>Acceptance</div><div>XP</div>
                        </div>
                        {filtered.map(p => (
                            <div key={p.id} style={{ display: 'grid', gridTemplateColumns: '40px 1fr 100px 100px 80px 80px', gap: 12, padding: '14px 16px', borderBottom: '1.5px solid var(--border)', alignItems: 'center', cursor: 'pointer', transition: 'background .2s', background: p.solved ? 'rgba(0,245,160,.02)' : '' }}
                                onClick={() => { setActiveProblem(p); setPage('editor'); }}
                                onMouseEnter={e => e.currentTarget.style.background = 'var(--surface2)'}
                                onMouseLeave={e => e.currentTarget.style.background = p.solved ? 'rgba(0,245,160,.02)' : ''}>
                                <div style={{ fontSize: 11, color: 'var(--text3)', fontFamily: 'Poppins' }}>#{p.id.toString().padStart(3, '0')}</div>
                                <div>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                                        <span style={{ color: p.solved ? 'var(--accent)' : 'var(--text)' }}>{p.solved ? '✅ ' : ''}{p.title}</span>
                                    </div>
                                    <div style={{ display: 'flex', gap: 4, marginTop: 4 }}>{p.tags.slice(0, 2).map(t => <span key={t} className="tag">{t}</span>)}</div>
                                </div>
                                <div style={{ fontSize: 12, color: 'var(--text2)' }}>{p.category}</div>
                                <span className={`badge badge-${p.difficulty === 'Easy' ? 'green' : p.difficulty === 'Medium' ? 'yellow' : 'red'}`}>{p.difficulty}</span>
                                <div style={{ fontSize: 12, color: 'var(--text2)', fontFamily: 'Poppins' }}>{p.acceptance}%</div>
                                <div style={{ fontSize: 12, color: 'var(--accent)', fontFamily: 'Poppins' }}>+{p.xp}XP</div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // ─── CODE EDITOR (with real AI review) ───────────────────────────────────────
        function EditorPage({ problem, user, addNotif, updateUser }) {
            const [code, setCode] = useState(problem?.starter || '// Write your solution here\n');
            const [lang, setLang] = useState('javascript');
            const [output, setOutput] = useState(null);
            const [running, setRunning] = useState(false);
            const [submitting, setSubmitting] = useState(false);
            const [activeTab, setActiveTab] = useState('tests');
            const [aiFeedback, setAiFeedback] = useState(null);
            const [submitted, setSubmitted] = useState(false);

            if (!problem) return (
                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '50vh', flexDirection: 'column', gap: 16 }}>
                    <div style={{ fontSize: 48 }}>💻</div>
                    <div style={{ fontWeight: 700, fontSize: 18 }}>No problem selected</div>
                    <div style={{ color: 'var(--text2)' }}>Go to Problems page and select one</div>
                </div>
            );

            const runCode = () => {
                setRunning(true); setOutput(null);
                setTimeout(() => {
                    setOutput({
                        type: 'run', results: [
                            { input: problem.examples[0]?.in, expected: problem.examples[0]?.out, got: problem.examples[0]?.out, passed: true, time: '12ms' },
                            problem.examples[1] ? { input: problem.examples[1].in, expected: problem.examples[1].out, got: problem.examples[1].out, passed: true, time: '8ms' } : null,
                        ].filter(Boolean)
                    });
                    setRunning(false); setActiveTab('output');
                }, 1400);
            };

            const getAIReview = async (codeToReview, accepted) => {
                setAiFeedback({ loading: true });
                setActiveTab('ai');
                try {
                    const systemPrompt = `You are an expert coding interview coach reviewing code submissions for a competitive programming platform. Be concise, specific, and actionable. Focus on time/space complexity, correctness, edge cases, and code quality.`;
                    const prompt = `Review this ${lang} solution for: "${problem.title}" (${problem.difficulty})

    Problem: ${problem.description}

    Student's Code:
    \`\`\`${lang}
    ${codeToReview}
    \`\`\`

    Was the submission accepted: ${accepted ? 'YES' : 'NO'}

    Provide your response in this exact JSON format (no markdown, just raw JSON):
    {
    "score": <number 0-100>,
    "timeComplexity": "<e.g. O(n)>",
    "spaceComplexity": "<e.g. O(1)>",
    "feedback": "<2-3 sentence constructive feedback about the approach, correctness, and style>",
    "suggestion": "<1-2 sentence specific improvement tip or optimal approach hint>",
    "strengths": ["<strength1>", "<strength2>"],
    "issues": ["<issue1 or empty if none>"]
    }`;

                    const result = await callClaude([{ role: 'user', content: prompt }], systemPrompt, 600);
                    const jsonMatch = result.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        const parsed = JSON.parse(jsonMatch[0]);
                        setAiFeedback({ ...parsed, loading: false });
                    } else {
                        setAiFeedback({ score: accepted ? 78 : 35, feedback: result, loading: false, timeComplexity: 'N/A', spaceComplexity: 'N/A', suggestion: '', strengths: [], issues: [] });
                    }
                } catch (e) {
                    setAiFeedback({ score: accepted ? 75 : 30, feedback: `AI review unavailable: ${e.message}`, loading: false, timeComplexity: 'N/A', spaceComplexity: 'N/A', suggestion: 'Try again later.', strengths: [], issues: [] });
                }
            };

            const submitCode = async () => {
                if (submitted) return;
                setSubmitting(true);
                const accepted = code.length > 30;
                setTimeout(() => {
                    setOutput({ type: 'submit', accepted, testsPassed: accepted ? problem.examples.length : 1, total: problem.examples.length, runtime: '18ms', memory: '42MB' });
                    setSubmitting(false);
                    setActiveTab('output');
                    if (accepted) {
                        setSubmitted(true);
                        addNotif({ type: 'success', msg: `✅ Accepted! +${problem.xp} XP earned!`, time: 'now' });
                    }
                    getAIReview(code, accepted);
                }, 2000);
            };

            return (
                <div className="editor-layout fade-in">
                    <div className="editor-panel" style={{ borderRight: '1px solid var(--border)' }}>
                        <div style={{ display: 'flex', gap: 8, marginBottom: 16 }}>
                            <span className={`badge badge-${problem.difficulty === 'Easy' ? 'green' : problem.difficulty === 'Medium' ? 'yellow' : 'red'}`}>{problem.difficulty}</span>
                            {problem.tags.map(t => <span key={t} className="tag">{t}</span>)}
                        </div>
                        <h2 style={{ fontSize: 18, fontWeight: 800, marginBottom: 12 }}>{problem.title}</h2>
                        <div style={{ fontSize: 13, color: 'var(--text2)', lineHeight: 1.8, marginBottom: 20, whiteSpace: 'pre-line' }}>{problem.description}</div>
                        {problem.examples.map((ex, i) => (
                            <div key={i} style={{ background: 'var(--surface2)', border: '1.5px solid var(--border)', borderRadius: 8, padding: 14, marginBottom: 10 }}>
                                <div style={{ fontSize: 11, fontWeight: 700, color: 'var(--text3)', marginBottom: 6, textTransform: 'uppercase', letterSpacing: 1 }}>Example {i + 1}</div>
                                <div style={{ fontFamily: 'JetBrains Mono', fontSize: 12, color: 'var(--text)' }}>
                                    <div style={{ marginBottom: 4 }}><span style={{ color: 'var(--text3)' }}>Input: </span>{ex.in}</div>
                                    <div><span style={{ color: 'var(--text3)' }}>Output: </span>{ex.out}</div>
                                </div>
                            </div>
                        ))}
                        <div className="divider" />
                        <div style={{ fontSize: 13, color: 'var(--text2)' }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8 }}><span>Acceptance Rate</span><span style={{ color: 'var(--accent)', fontFamily: 'Poppins' }}>{problem.acceptance}%</span></div>
                            <div style={{ display: 'flex', justifyContent: 'space-between' }}><span>XP Reward</span><span style={{ color: 'var(--accent4)', fontFamily: 'Poppins' }}>+{problem.xp} XP</span></div>
                        </div>
                    </div>

                    <div className="editor-panel" style={{ display: 'flex', flexDirection: 'column', padding: 0 }}>
                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '10px 16px', borderBottom: '1.5px solid var(--border)', background: 'var(--surface)' }}>
                            <select value={lang} onChange={e => setLang(e.target.value)} style={{ width: 130, padding: '6px 10px', fontSize: 12 }}>
                                {['javascript', 'python', 'c', 'cpp', 'java'].map(l => <option key={l} value={l}>{l}</option>)}
                            </select>
                            <div style={{ display: 'flex', gap: 8 }}>
                                <button className="btn btn-ghost btn-sm" onClick={() => setCode(problem.starter)}>Reset</button>
                                <button className="btn btn-blue btn-sm" onClick={runCode} disabled={running}>{running ? <><span className="loading" /> Running...</> : '▶ Run'}</button>
                                <button className={`btn btn-sm ${submitted ? 'btn-ghost' : 'btn-primary'}`} onClick={submitCode} disabled={submitting || submitted}>{submitting ? <><span className="loading" /> Submitting...</> : submitted ? '✅ Submitted' : 'Submit'}</button>
                            </div>
                        </div>
                        <div style={{ flex: 1, display: 'flex', overflow: 'hidden', background: '#0F172A' }}>
                            <div style={{ padding: '16px 6px 16px 12px', color: 'var(--text3)', fontFamily: 'JetBrains Mono', fontSize: 13, lineHeight: 1.6, textAlign: 'right', userSelect: 'none', whiteSpace: 'pre', borderRight: '1px solid var(--border)', minWidth: 40 }}>
                                {code.split('\n').map((_, i) => i + 1).join('\n')}
                            </div>
                            <textarea className="code-area" style={{ flex: 1, border: 'none', borderRadius: 0, resize: 'none', padding: '16px' }}
                                value={code} onChange={e => setCode(e.target.value)} spellCheck={false} />
                        </div>
                    </div>

                    <div className="editor-panel">
                        <div className="tabs" style={{ marginBottom: 16 }}>
                            {['tests', 'output', 'ai'].map(t => (
                                <div key={t} className={`tab ${activeTab === t ? 'active' : ''}`} onClick={() => setActiveTab(t)}>
                                    {t === 'tests' ? 'Test Cases' : t === 'output' ? 'Output' : '🤖 AI Review'}
                                </div>
                            ))}
                        </div>

                        {activeTab === 'tests' && problem.examples.map((ex, i) => (
                            <div key={i} style={{ background: 'var(--surface2)', border: '1.5px solid var(--border)', borderRadius: 8, padding: 14, marginBottom: 10 }}>
                                <div style={{ fontSize: 11, fontWeight: 700, color: 'var(--text3)', marginBottom: 8 }}>TESTCASE {i + 1}</div>
                                <div style={{ fontFamily: 'JetBrains Mono', fontSize: 12 }}>
                                    <div style={{ color: 'var(--text3)', marginBottom: 4 }}>Input</div>
                                    <div style={{ background: 'var(--bg)', padding: 8, borderRadius: 6, marginBottom: 8, color: 'var(--text)' }}>{ex.in}</div>
                                    <div style={{ color: 'var(--text3)', marginBottom: 4 }}>Expected Output</div>
                                    <div style={{ background: 'var(--bg)', padding: 8, borderRadius: 6, color: 'var(--accent)' }}>{ex.out}</div>
                                </div>
                            </div>
                        ))}

                        {activeTab === 'output' && !output && (
                            <div style={{ textAlign: 'center', padding: 40, color: 'var(--text3)' }}>
                                <div style={{ fontSize: 40, marginBottom: 12 }}>▶</div>
                                <div>Run or submit your code to see results</div>
                            </div>
                        )}

                        {activeTab === 'output' && output && (
                            <div>
                                {output.type === 'submit' && (
                                    <div style={{ background: output.accepted ? 'rgba(0,245,160,.1)' : 'rgba(255,107,107,.1)', border: `1px solid ${output.accepted ? 'rgba(0,245,160,.3)' : 'rgba(255,107,107,.3)'}`, borderRadius: 12, padding: 16, marginBottom: 16, textAlign: 'center' }}>
                                        <div style={{ fontSize: 24, marginBottom: 6 }}>{output.accepted ? '🎉' : '💀'}</div>
                                        <div style={{ fontSize: 18, fontWeight: 800, color: output.accepted ? 'var(--accent)' : 'var(--accent3)' }}>{output.accepted ? 'Accepted!' : 'Wrong Answer'}</div>
                                        <div style={{ fontSize: 12, color: 'var(--text2)', marginTop: 4 }}>{output.testsPassed}/{output.total} test cases passed</div>
                                        {output.accepted && <div style={{ fontSize: 12, color: 'var(--accent4)', marginTop: 8 }}>Runtime: {output.runtime} · Memory: {output.memory}</div>}
                                    </div>
                                )}
                                {output.results?.map((r, i) => (
                                    <div key={i} style={{ background: r.passed ? 'rgba(0,245,160,.05)' : 'rgba(255,107,107,.05)', border: `1px solid ${r.passed ? 'rgba(0,245,160,.2)' : 'rgba(255,107,107,.2)'}`, borderRadius: 8, padding: 14, marginBottom: 8 }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8 }}>
                                            <span style={{ fontWeight: 700, fontSize: 13, color: r.passed ? 'var(--accent)' : 'var(--accent3)' }}>{r.passed ? '✅ Passed' : '❌ Failed'}</span>
                                            <span style={{ fontSize: 11, color: 'var(--text3)', fontFamily: 'Poppins' }}>{r.time}</span>
                                        </div>
                                        <div style={{ fontFamily: 'JetBrains Mono', fontSize: 11, color: 'var(--text2)' }}>
                                            <div>Input: {r.input}</div>
                                            <div style={{ color: r.passed ? 'var(--accent)' : 'var(--accent3)' }}>Got: {r.got}</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'ai' && !aiFeedback && (
                            <div style={{ textAlign: 'center', padding: 40, color: 'var(--text3)' }}>
                                <div style={{ fontSize: 40, marginBottom: 12 }}>🤖</div>
                                <div>Submit your code to get real AI feedback</div>
                                <div style={{ fontSize: 11, marginTop: 8, color: 'var(--accent)' }}>Powered by Claude AI</div>
                            </div>
                        )}

                        {activeTab === 'ai' && aiFeedback?.loading && (
                            <div style={{ textAlign: 'center', padding: 40 }}>
                                <div style={{ fontSize: 40, marginBottom: 12 }}>🤖</div>
                                <div style={{ fontWeight: 700, marginBottom: 8 }}>Claude is reviewing your code...</div>
                                <div style={{ display: 'flex', justifyContent: 'center', gap: 4 }}>
                                    <span className="typing-dot" /><span className="typing-dot" /><span className="typing-dot" />
                                </div>
                                <div style={{ fontSize: 12, color: 'var(--text3)', marginTop: 12 }}>Analyzing time complexity, edge cases, and code quality</div>
                            </div>
                        )}

                        {activeTab === 'ai' && aiFeedback && !aiFeedback.loading && (
                            <div>
                                <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12 }}>
                                    <div className="api-badge">⚡ Claude AI Review</div>
                                </div>
                                <div style={{ textAlign: 'center', marginBottom: 16 }}>
                                    <ScoreRing score={aiFeedback.score} size={90} color={aiFeedback.score > 60 ? 'var(--accent)' : 'var(--accent3)'} />
                                    <div style={{ fontSize: 13, fontWeight: 700, marginTop: 8 }}>Code Quality Score</div>
                                </div>
                                {aiFeedback.timeComplexity && aiFeedback.timeComplexity !== 'N/A' && (
                                    <div style={{ display: 'flex', gap: 8, marginBottom: 12 }}>
                                        <div style={{ flex: 1, background: 'rgba(0,245,160,.06)', border: '1.5px solid rgba(249,115,22,.2)', borderRadius: 8, padding: '8px 12px', textAlign: 'center' }}>
                                            <div style={{ fontSize: 10, color: 'var(--text3)', marginBottom: 2 }}>TIME</div>
                                            <div style={{ fontFamily: 'Poppins', fontSize: 12, color: 'var(--accent)', fontWeight: 700 }}>{aiFeedback.timeComplexity}</div>
                                        </div>
                                        <div style={{ flex: 1, background: 'rgba(0,200,255,.06)', border: '1px solid rgba(0,200,255,.2)', borderRadius: 8, padding: '8px 12px', textAlign: 'center' }}>
                                            <div style={{ fontSize: 10, color: 'var(--text3)', marginBottom: 2 }}>SPACE</div>
                                            <div style={{ fontFamily: 'Poppins', fontSize: 12, color: 'var(--accent2)', fontWeight: 700 }}>{aiFeedback.spaceComplexity}</div>
                                        </div>
                                    </div>
                                )}
                                <div style={{ background: 'var(--surface2)', border: '1.5px solid var(--border)', borderRadius: 8, padding: 14, marginBottom: 12 }}>
                                    <div style={{ fontSize: 11, fontWeight: 700, color: 'var(--text3)', marginBottom: 6 }}>📝 FEEDBACK</div>
                                    <div style={{ fontSize: 12, lineHeight: 1.6, color: 'var(--text2)' }}>{aiFeedback.feedback}</div>
                                </div>
                                {aiFeedback.strengths?.length > 0 && (
                                    <div style={{ background: 'rgba(249,115,22,.05)', border: '1.5px solid rgba(249,115,22,.2)', borderRadius: 8, padding: 12, marginBottom: 10 }}>
                                        <div style={{ fontSize: 11, fontWeight: 700, color: 'var(--accent)', marginBottom: 6 }}>✅ STRENGTHS</div>
                                        {aiFeedback.strengths.map((s, i) => <div key={i} style={{ fontSize: 12, color: 'var(--text2)', marginBottom: 3 }}>• {s}</div>)}
                                    </div>
                                )}
                                {aiFeedback.issues?.filter(x => x).length > 0 && (
                                    <div style={{ background: 'rgba(255,107,107,.05)', border: '1px solid rgba(255,107,107,.2)', borderRadius: 8, padding: 12, marginBottom: 10 }}>
                                        <div style={{ fontSize: 11, fontWeight: 700, color: 'var(--accent3)', marginBottom: 6 }}>⚠️ ISSUES</div>
                                        {aiFeedback.issues.filter(x => x).map((s, i) => <div key={i} style={{ fontSize: 12, color: 'var(--text2)', marginBottom: 3 }}>• {s}</div>)}
                                    </div>
                                )}
                                {aiFeedback.suggestion && (
                                    <div style={{ background: 'rgba(0,200,255,.05)', border: '1px solid rgba(0,200,255,.2)', borderRadius: 8, padding: 14 }}>
                                        <div style={{ fontSize: 11, fontWeight: 700, color: 'var(--accent2)', marginBottom: 6 }}>💡 SUGGESTION</div>
                                        <div style={{ fontSize: 12, color: 'var(--text2)', lineHeight: 1.6 }}>{aiFeedback.suggestion}</div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // ─── ROADMAP PAGE ─────────────────────────────────────────────────────────────
        function RoadmapPage({ user, setPage, updateUser }) {
            const [active, setActive] = useState(null);
            const colors = { basics: '#4ADE80', dsa: '#60A5FA', development: '#F472B6', resume: '#FBBF24', interview: '#A78BFA', jobs: '#FB923C' };

            const toggleItem = (cat, itemId) => {
                updateUser(u => {
                    const r = ROADMAP_ITEMS[cat];
                    r.items = r.items.map(i => i.id === itemId ? { ...i, done: !i.done } : i);
                    const pct = Math.round(r.items.filter(i => i.done).length / r.items.length * 100);
                    return { ...u, progress: { ...u.progress, [cat]: pct } };
                });
            };

            if (active) {
                const r = ROADMAP_ITEMS[active], c = colors[active];
                const donePct = Math.round(r.items.filter(i => i.done).length / r.items.length * 100);
                return (
                    <div className="page-content fade-in">
                        <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 24 }}>
                            <button className="btn btn-ghost btn-sm" onClick={() => setActive(null)}>← Back</button>
                            <div style={{ fontSize: 28 }}>{r.icon}</div>
                            <div>
                                <div style={{ fontSize: 22, fontWeight: 800 }}>{r.title}</div>
                                <div style={{ fontSize: 13, color: 'var(--text2)' }}>{r.items.filter(i => i.done).length}/{r.items.length} topics completed</div>
                            </div>
                            <div style={{ marginLeft: 'auto' }}><ScoreRing score={donePct} size={70} color={c} /></div>
                        </div>
                        <ProgressBar value={donePct} color={`linear-gradient(90deg,${c},${c}88)`} height={8} />
                        <div style={{ marginTop: 24 }}>
                            {r.items.map(item => (
                                <div key={item.id} className="card" style={{ padding: 16, marginBottom: 10, borderLeft: `3px solid ${item.done ? c : 'var(--border)'}` }}>
                                    <div style={{ display: 'flex', alignItems: 'flex-start', gap: 12 }}>
                                        <div className={`checkbox ${item.done ? 'checked' : ''}`} onClick={() => toggleItem(active, item.id)} style={{ marginTop: 2 }}>
                                            {item.done && <span style={{ color: '#000', fontSize: 12 }}>✓</span>}
                                        </div>
                                        <div style={{ flex: 1 }}>
                                            <div style={{ fontWeight: 700, fontSize: 14, marginBottom: 8, textDecoration: item.done ? 'line-through' : 'none', color: item.done ? 'var(--text3)' : 'var(--text)' }}>{item.title}</div>
                                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: 6 }}>
                                                {item.subtopics.map(s => (
                                                    <span key={s} style={{ background: 'var(--surface2)', border: '1.5px solid var(--border)', borderRadius: 6, padding: '2px 10px', fontSize: 11, color: 'var(--text2)' }}>{s}</span>
                                                ))}
                                            </div>
                                        </div>
                                        <span style={{ fontSize: 11, color: item.done ? c : 'var(--text3)', fontWeight: 700 }}>{item.done ? '✅ Done' : 'Pending'}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            }

            return (
                <div className="page-content fade-in">
                    <div className="section-header">
                        <div>
                            <div className="section-title">Learning Roadmap</div>
                            <div style={{ fontSize: 13, color: 'var(--text2)', marginTop: 4 }}>Follow the path from beginner to placement-ready</div>
                        </div>
                    </div>
                    <div className="card" style={{ padding: 20, marginBottom: 24, background: 'linear-gradient(135deg,rgba(0,245,160,.05),rgba(0,200,255,.03))' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 12 }}>
                            <div style={{ fontWeight: 700 }}>Overall Progress</div>
                            <div style={{ fontFamily: 'Poppins', color: 'var(--accent)' }}>{Math.round(Object.values(user.progress || {}).reduce((a, b) => a + b, 0) / Math.max(1, Object.values(user.progress || {}).length))}%</div>
                        </div>
                        <ProgressBar value={Math.round(Object.values(user.progress || {}).reduce((a, b) => a + b, 0) / Math.max(1, Object.values(user.progress || {}).length))} height={10} />
                    </div>
                    <div className="grid-3">
                        {Object.entries(ROADMAP_ITEMS).map(([key, r]) => {
                            const c = colors[key], done = r.items.filter(i => i.done).length;
                            return (
                                <div key={key} className="card roadmap-card" onClick={() => setActive(key)} style={{ borderTop: `3px solid ${c}` }}>
                                    <div className="roadmap-card-icon">{r.icon}</div>
                                    <div className="roadmap-card-title">{r.title}</div>
                                    <div className="roadmap-card-desc">{r.items.length} topics · {done} completed</div>
                                    <ProgressBar value={user.progress?.[key] || 0} color={`linear-gradient(90deg,${c},${c}88)`} />
                                    <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: 10, fontSize: 12 }}>
                                        <span style={{ color: 'var(--text3)' }}>{done}/{r.items.length} done</span>
                                        <span style={{ color: c, fontFamily: 'Poppins', fontWeight: 700 }}>{user.progress?.[key] || 0}%</span>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }

        // ─── COURSES PAGE ─────────────────────────────────────────────────────────────
        function CoursesPage({ user, addNotif }) {
            const [tab, setTab] = useState('all');
            const [watching, setWatching] = useState(null);
            const [enrolledIds, setEnrolledIds] = useState([1, 2, 6]);

            const displayed = COURSES.filter(c => tab === 'enrolled' ? enrolledIds.includes(c.id) : true);

            if (watching) {
                const c = COURSES.find(x => x.id === watching);
                return (
                    <div className="page-content fade-in">
                        <button className="btn btn-ghost btn-sm" onClick={() => setWatching(null)} style={{ marginBottom: 20 }}>← Back to Courses</button>
                        <div className="grid-2" style={{ gap: 24, alignItems: 'start' }}>
                            <div>
                                <div style={{ background: 'var(--surface2)', border: '1.5px solid var(--border)', borderRadius: 12, aspectRatio: '16/9', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 72, marginBottom: 16 }}>
                                    {c.emoji}
                                </div>
                                <div style={{ background: 'var(--surface)', border: '1px solid var(--border)', borderRadius: 12, padding: 20 }}>
                                    <div style={{ fontSize: 11, fontWeight: 700, color: 'var(--text3)', marginBottom: 8 }}>COURSE OVERVIEW</div>
                                    <div style={{ fontSize: 16, fontWeight: 800, marginBottom: 8 }}>{c.title}</div>
                                    <div style={{ fontSize: 13, color: 'var(--text2)', marginBottom: 16 }}>by {c.creator} · ⭐ {c.rating} · 👥 {c.students.toLocaleString()} students</div>
                                    <ProgressBar value={enrolledIds.includes(c.id) ? c.progress : 0} />
                                    <div style={{ fontSize: 12, color: 'var(--text2)', marginTop: 6 }}>{enrolledIds.includes(c.id) ? c.progress : 0}% complete · {c.duration} total</div>
                                </div>
                            </div>
                            <div className="card" style={{ overflow: 'hidden' }}>
                                <div style={{ padding: '16px', borderBottom: '1.5px solid var(--border)', fontWeight: 700 }}>Course Content · {c.lessons} Lessons</div>
                                {[...Array(6)].map((_, i) => (
                                    <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 12, padding: '12px 16px', borderBottom: '1px solid rgba(30,45,74,.5)', cursor: 'pointer', transition: 'background .2s' }} onMouseEnter={e => e.currentTarget.style.background = 'var(--surface2)'} onMouseLeave={e => e.currentTarget.style.background = ''}>
                                        <div style={{ width: 28, height: 28, borderRadius: '50%', background: i < 3 ? 'var(--accent)' : 'var(--border)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 12, color: i < 3 ? '#000' : 'var(--text3)', fontWeight: 700 }}>{i < 3 ? '✓' : i + 1}</div>
                                        <div style={{ flex: 1 }}>
                                            <div style={{ fontSize: 13, fontWeight: 600 }}>Section {i + 1}: {['Introduction', 'Core Concepts', 'Practice Problems', 'Advanced Topics', 'Projects', 'Final Assessment'][i]}</div>
                                            <div style={{ fontSize: 11, color: 'var(--text3)' }}>{Math.floor(Math.random() * 8) + 3} videos · {Math.floor(Math.random() * 30) + 20}min</div>
                                        </div>
                                        {i < 3 && <span className="badge badge-green">✓</span>}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="page-content fade-in">
                    <div className="section-header">
                        <div className="section-title">Courses</div>
                        <div style={{ display: 'flex', gap: 8 }}>
                            {['all', 'enrolled'].map(t => <button key={t} className={`btn btn-sm ${tab === t ? 'btn-primary' : 'btn-ghost'}`} onClick={() => setTab(t)}>{t === 'all' ? 'All Courses' : 'My Courses'}</button>)}
                        </div>
                    </div>
                    <div className="grid-3">
                        {displayed.map(c => (
                            <div key={c.id} className="card course-card" style={{ padding: 20, cursor: 'pointer' }} onClick={() => setWatching(c.id)}>
                                <div className="course-thumb" style={{ background: 'linear-gradient(135deg,var(--surface2),var(--bg))' }}>{c.emoji}</div>
                                <div style={{ display: 'flex', gap: 8, marginBottom: 8 }}>
                                    <span className="badge badge-gray">{c.category}</span>
                                    {c.price === 0 ? <span className="badge badge-green">FREE</span> : <span className="badge badge-blue">₹{c.price}</span>}
                                </div>
                                <div style={{ fontWeight: 800, fontSize: 15, marginBottom: 6, lineHeight: 1.3 }}>{c.title}</div>
                                <div style={{ fontSize: 12, color: 'var(--text2)', marginBottom: 12 }}>by {c.creator}</div>
                                <div style={{ display: 'flex', gap: 12, fontSize: 12, color: 'var(--text2)', marginBottom: 12 }}>
                                    <span>⭐ {c.rating}</span><span>👥 {c.students.toLocaleString()}</span><span>⏱ {c.duration}</span><span>📹 {c.lessons}</span>
                                </div>
                                {enrolledIds.includes(c.id) ? (
                                    <>
                                        <ProgressBar value={c.progress} />
                                        <div style={{ fontSize: 11, color: 'var(--text2)', marginTop: 6 }}>{c.progress}% complete</div>
                                        <button className="btn btn-primary btn-sm" style={{ marginTop: 10, width: '100%', justifyContent: 'center' }}>Continue →</button>
                                    </>
                                ) : (
                                    <button className="btn btn-secondary btn-sm" style={{ width: '100%', justifyContent: 'center' }} onClick={e => { e.stopPropagation(); setEnrolledIds([...enrolledIds, c.id]); addNotif({ type: 'success', msg: `Enrolled in "${c.title}"!`, time: 'now' }); }}>
                                        {c.price === 0 ? 'Enroll Free' : 'Enroll Now'}
                                    </button>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // ─── RESUME BUILDER (with real AI ATS) ───────────────────────────────────────
        function ResumePage({ user, addNotif }) {
            const [resumeData, setResumeData] = useState({
                name: user.name, title: 'Full Stack Developer | DSA Enthusiast',
                email: user.email || '', phone: '+91 98765 43210', location: 'Bangalore, India',
                linkedin: 'linkedin.com/in/arjun', github: 'github.com/arjun',
                summary: 'Passionate full-stack developer with 2 years of experience building scalable web applications. Strong DSA fundamentals with 200+ LeetCode problems solved.',
                experience: [{ company: 'TechStartup Pvt Ltd', role: 'SDE Intern', duration: 'June 2025 - Dec 2025', points: ['Built REST APIs with Node.js & Express serving 10K+ daily users', 'Reduced DB query time by 40% using MongoDB aggregation pipelines', 'Implemented JWT auth system with role-based access control'] }],
                projects: [
                    { name: 'E-commerce Platform', tech: 'React, Node.js, MongoDB', desc: 'Full-stack e-commerce with 50+ products, cart, payments via Razorpay' },
                    { name: 'DSA Visualizer', tech: 'JavaScript, D3.js', desc: 'Interactive algorithm visualization tool with 20+ algorithms' },
                ],
                education: { college: 'VIT University', degree: 'B.Tech Computer Science', year: '2022-2026', cgpa: '8.6' },
                skills: ['C/C++', 'JavaScript', 'Python', 'React.js', 'Node.js', 'MongoDB', 'Git', 'DSA'],
            });
            const [atsScore, setAtsScore] = useState(null);
            const [analyzing, setAnalyzing] = useState(false);
            const [activeSection, setActiveSection] = useState('basic');

            const analyzeATS = async () => {
                setAnalyzing(true); setAtsScore(null);
                try {
                    const resumeText = `
    Name: ${resumeData.name}
    Title: ${resumeData.title}
    Summary: ${resumeData.summary}
    Experience: ${resumeData.experience.map(e => `${e.role} at ${e.company}: ${e.points.join(', ')}`).join('\n')}
    Projects: ${resumeData.projects.map(p => `${p.name} (${p.tech}): ${p.desc}`).join('\n')}
    Education: ${resumeData.education.degree} from ${resumeData.education.college}, CGPA: ${resumeData.education.cgpa}
    Skills: ${resumeData.skills.join(', ')}
        `.trim();

                    const systemPrompt = `You are an expert ATS (Applicant Tracking System) and resume analyst. Analyze resumes for Indian software engineering job market. Be specific and actionable.`;
                    const prompt = `Analyze this resume for ATS optimization and overall quality for software engineering roles in India.

    RESUME:
    ${resumeText}

    Return ONLY this exact JSON (no markdown, no extra text):
    {
    "score": <overall ATS score 0-100>,
    "breakdown": {
        "keywords": <0-100>,
        "formatting": <0-100>,
        "sections": <0-100>,
        "quantification": <0-100>,
        "length": <0-100>
    },
    "strengths": ["<strength1>", "<strength2>", "<strength3>"],
    "suggestions": ["<specific actionable suggestion1>", "<suggestion2>", "<suggestion3>", "<suggestion4>", "<suggestion5>"],
    "missingKeywords": ["<keyword1>", "<keyword2>", "<keyword3>"],
    "summary": "<2 sentence overall assessment>"
    }`;

                    const result = await callClaude([{ role: 'user', content: prompt }], systemPrompt, 800);
                    const jsonMatch = result.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        const parsed = JSON.parse(jsonMatch[0]);
                        setAtsScore(parsed);
                        addNotif({ type: 'success', msg: `✅ AI ATS analysis complete! Score: ${parsed.score}/100`, time: 'now' });
                    } else {
                        throw new Error('Invalid response format');
                    }
                } catch (e) {
                    addNotif({ type: 'error', msg: `❌ AI analysis failed: ${e.message}`, time: 'now' });
                    setAtsScore({ score: 72, breakdown: { keywords: 78, formatting: 88, sections: 82, quantification: 55, length: 90 }, strengths: ['Good use of metrics in experience', 'Clear project descriptions'], suggestions: ['Add Docker, AWS, CI/CD keywords', 'Quantify more achievements', 'Add a technical skills summary at top'], missingKeywords: ['Docker', 'AWS', 'CI/CD'], summary: 'Solid resume with good technical foundation. Needs more ATS keywords.' });
                }
                setAnalyzing(false);
            };

            return (
                <div className="page-content fade-in">
                    <div className="section-header">
                        <div className="section-title">Resume Builder + AI ATS Checker</div>
                        <div style={{ display: 'flex', gap: 8 }}>
                            <button className="btn btn-ghost btn-sm" onClick={analyzeATS} disabled={analyzing}>
                                {analyzing ? <><span className="loading" /> Analyzing with AI...</> : '🤖 Check ATS Score (AI)'}
                            </button>
                            <button className="btn btn-primary btn-sm" onClick={() => addNotif({ type: 'success', msg: 'Resume downloaded!', time: 'now' })}>⬇ Download PDF</button>
                        </div>
                    </div>

                    {analyzing && (
                        <div style={{ background: 'rgba(249,115,22,.05)', border: '1.5px solid rgba(249,115,22,.2)', borderRadius: 12, padding: 16, marginBottom: 20, display: 'flex', gap: 12, alignItems: 'center' }}>
                            <span className="loading" />
                            <div>
                                <div style={{ fontWeight: 700, fontSize: 13, color: 'var(--accent)' }}>Claude AI is analyzing your resume...</div>
                                <div style={{ fontSize: 12, color: 'var(--text2)' }}>Checking ATS keywords, formatting, quantification, and overall quality</div>
                            </div>
                        </div>
                    )}

                    <div className="grid-2" style={{ gap: 20, alignItems: 'start' }}>
                        <div>
                            <div className="tabs" style={{ marginBottom: 16 }}>
                                {['basic', 'experience', 'projects', 'skills'].map(s => (
                                    <div key={s} className={`tab ${activeSection === s ? 'active' : ''}`} onClick={() => setActiveSection(s)} style={{ fontSize: 12 }}>
                                        {s.charAt(0).toUpperCase() + s.slice(1)}
                                    </div>
                                ))}
                            </div>

                            {activeSection === 'basic' && (
                                <div className="card" style={{ padding: 20 }}>
                                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12 }}>
                                        {[['Full Name', 'name'], ['Job Title', 'title'], ['Email', 'email'], ['Phone', 'phone'], ['Location', 'location'], ['LinkedIn', 'linkedin'], ['GitHub', 'github']].map(([l, k]) => (
                                            <div key={k}>
                                                <label>{l}</label>
                                                <input value={resumeData[k] || ''} onChange={e => setResumeData({ ...resumeData, [k]: e.target.value })} />
                                            </div>
                                        ))}
                                        <div style={{ gridColumn: '1/-1' }}>
                                            <label>Professional Summary</label>
                                            <textarea rows={3} value={resumeData.summary} onChange={e => setResumeData({ ...resumeData, summary: e.target.value })} style={{ resize: 'vertical' }} />
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeSection === 'experience' && (
                                <div className="card" style={{ padding: 20 }}>
                                    {resumeData.experience.map((exp, i) => (
                                        <div key={i} style={{ marginBottom: 20, paddingBottom: 20, borderBottom: '1.5px solid var(--border)' }}>
                                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 10, marginBottom: 10 }}>
                                                <div><label>Company</label><input value={exp.company} onChange={e => { const ex = [...resumeData.experience]; ex[i] = { ...exp, company: e.target.value }; setResumeData({ ...resumeData, experience: ex }); }} /></div>
                                                <div><label>Role</label><input value={exp.role} onChange={e => { const ex = [...resumeData.experience]; ex[i] = { ...exp, role: e.target.value }; setResumeData({ ...resumeData, experience: ex }); }} /></div>
                                                <div style={{ gridColumn: '1/-1' }}><label>Duration</label><input value={exp.duration} onChange={e => { const ex = [...resumeData.experience]; ex[i] = { ...exp, duration: e.target.value }; setResumeData({ ...resumeData, experience: ex }); }} /></div>
                                            </div>
                                            {exp.points.map((pt, j) => (
                                                <div key={j} style={{ marginBottom: 8 }}><label>Bullet {j + 1}</label><input value={pt} onChange={e => { const ex = [...resumeData.experience]; ex[i].points[j] = e.target.value; setResumeData({ ...resumeData, experience: ex }); }} /></div>
                                            ))}
                                            <button className="btn btn-ghost btn-sm" onClick={() => { const ex = [...resumeData.experience]; ex[i].points.push(''); setResumeData({ ...resumeData, experience: ex }); }}>+ Add bullet</button>
                                        </div>
                                    ))}
                                    <button className="btn btn-secondary btn-sm" onClick={() => setResumeData({ ...resumeData, experience: [...resumeData.experience, { company: '', role: '', duration: '', points: [''] }] })}>+ Add Experience</button>
                                </div>
                            )}

                            {activeSection === 'projects' && (
                                <div className="card" style={{ padding: 20 }}>
                                    {resumeData.projects.map((p, i) => (
                                        <div key={i} style={{ marginBottom: 16, paddingBottom: 16, borderBottom: '1.5px solid var(--border)' }}>
                                            <div style={{ marginBottom: 8 }}><label>Project Name</label><input value={p.name} onChange={e => { const ps = [...resumeData.projects]; ps[i] = { ...p, name: e.target.value }; setResumeData({ ...resumeData, projects: ps }); }} /></div>
                                            <div style={{ marginBottom: 8 }}><label>Tech Stack</label><input value={p.tech} onChange={e => { const ps = [...resumeData.projects]; ps[i] = { ...p, tech: e.target.value }; setResumeData({ ...resumeData, projects: ps }); }} /></div>
                                            <div><label>Description</label><textarea rows={2} value={p.desc} onChange={e => { const ps = [...resumeData.projects]; ps[i] = { ...p, desc: e.target.value }; setResumeData({ ...resumeData, projects: ps }); }} style={{ resize: 'vertical' }} /></div>
                                        </div>
                                    ))}
                                    <button className="btn btn-secondary btn-sm" onClick={() => setResumeData({ ...resumeData, projects: [...resumeData.projects, { name: '', tech: '', desc: '' }] })}>+ Add Project</button>
                                </div>
                            )}

                            {activeSection === 'skills' && (
                                <div className="card" style={{ padding: 20 }}>
                                    <label>Skills (comma separated)</label>
                                    <input value={resumeData.skills.join(', ')} onChange={e => setResumeData({ ...resumeData, skills: e.target.value.split(',').map(s => s.trim()) })} />
                                    <div style={{ marginTop: 12, display: 'flex', flexWrap: 'wrap', gap: 6 }}>
                                        {resumeData.skills.map(s => <span key={s} className="badge badge-blue">{s}</span>)}
                                    </div>
                                </div>
                            )}

                            {atsScore && (
                                <div className="card" style={{ padding: 20, marginTop: 16, borderColor: 'rgba(0,245,160,.2)' }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 16 }}>
                                        <div className="api-badge">⚡ Claude AI Analysis</div>
                                    </div>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: 16, marginBottom: 16 }}>
                                        <ScoreRing score={atsScore.score} size={80} />
                                        <div>
                                            <div style={{ fontWeight: 800, fontSize: 16 }}>ATS Score</div>
                                            <div style={{ fontSize: 13, color: 'var(--text2)' }}>{atsScore.summary}</div>
                                        </div>
                                    </div>
                                    {Object.entries(atsScore.breakdown).map(([k, v]) => (
                                        <div key={k} style={{ marginBottom: 10 }}>
                                            <div className="skill-bar-label"><span style={{ fontSize: 12, textTransform: 'capitalize' }}>{k}</span><span style={{ fontSize: 12, fontFamily: 'Poppins', color: 'var(--accent)' }}>{v}%</span></div>
                                            <div className="skill-bar"><div className="skill-fill" style={{ width: `${v}%`, background: 'linear-gradient(90deg,var(--accent),var(--accent2))' }} /></div>
                                        </div>
                                    ))}
                                    {atsScore.strengths?.length > 0 && (
                                        <div style={{ marginTop: 16, marginBottom: 12 }}>
                                            <div style={{ fontSize: 12, fontWeight: 700, color: 'var(--accent)', marginBottom: 8 }}>✅ STRENGTHS</div>
                                            {atsScore.strengths.map((s, i) => <div key={i} style={{ fontSize: 12, color: 'var(--text2)', marginBottom: 4 }}>• {s}</div>)}
                                        </div>
                                    )}
                                    {atsScore.missingKeywords?.length > 0 && (
                                        <div style={{ marginBottom: 12 }}>
                                            <div style={{ fontSize: 12, fontWeight: 700, color: 'var(--accent4)', marginBottom: 8 }}>🔑 MISSING KEYWORDS</div>
                                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: 6 }}>
                                                {atsScore.missingKeywords.map(k => <span key={k} className="badge badge-yellow">{k}</span>)}
                                            </div>
                                        </div>
                                    )}
                                    <div style={{ marginTop: 8 }}>
                                        <div style={{ fontSize: 12, fontWeight: 700, color: 'var(--text3)', marginBottom: 8 }}>📝 AI SUGGESTIONS</div>
                                        {atsScore.suggestions.map((s, i) => (
                                            <div key={i} style={{ display: 'flex', gap: 8, alignItems: 'flex-start', marginBottom: 6, fontSize: 12, color: 'var(--text2)' }}>
                                                <span style={{ color: 'var(--accent4)', flexShrink: 0 }}>{i + 1}.</span>{s}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>

                        <div>
                            <div style={{ fontSize: 12, fontWeight: 700, color: 'var(--text3)', marginBottom: 8, textTransform: 'uppercase', letterSpacing: 1 }}>Live Preview</div>
                            <div className="resume-preview" style={{ fontSize: 12 }}>
                                <div className="resume-name">{resumeData.name}</div>
                                <div className="resume-title">{resumeData.title}</div>
                                <div style={{ color: '#555', marginBottom: 16, fontSize: 11 }}>{resumeData.email} · {resumeData.phone} · {resumeData.location}</div>
                                <div className="resume-section"><h3>Summary</h3><p>{resumeData.summary}</p></div>
                                <div className="resume-section">
                                    <h3>Experience</h3>
                                    {resumeData.experience.map((e, i) => (
                                        <div key={i} style={{ marginBottom: 10 }}>
                                            <div style={{ fontWeight: 700 }}>{e.role} — {e.company}</div>
                                            <div style={{ color: '#666', fontSize: 11, marginBottom: 4 }}>{e.duration}</div>
                                            {e.points.map((p, j) => <div key={j} style={{ paddingLeft: 12, marginBottom: 2 }}>• {p}</div>)}
                                        </div>
                                    ))}
                                </div>
                                <div className="resume-section">
                                    <h3>Projects</h3>
                                    {resumeData.projects.map((p, i) => (
                                        <div key={i} style={{ marginBottom: 8 }}>
                                            <div style={{ fontWeight: 700 }}>{p.name} <span style={{ fontWeight: 400, color: '#666' }}>| {p.tech}</span></div>
                                            <div>{p.desc}</div>
                                        </div>
                                    ))}
                                </div>
                                <div className="resume-section">
                                    <h3>Education</h3>
                                    <div style={{ fontWeight: 700 }}>{resumeData.education.college}</div>
                                    <div>{resumeData.education.degree} · CGPA: {resumeData.education.cgpa} · {resumeData.education.year}</div>
                                </div>
                                <div className="resume-section"><h3>Skills</h3><div>{resumeData.skills.join(' · ')}</div></div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // ─── PHONE NOTIF SIMULATOR ────────────────────────────────────────────────────
        function PhoneNotifSimulator({ phone, mentor, student, date, time, onClose }) {
            const [stage, setStage] = useState('sending');
            useEffect(() => {
                const t1 = setTimeout(() => setStage('delivered'), 1800);
                const t2 = setTimeout(() => setStage('done'), 3200);
                return () => { clearTimeout(t1); clearTimeout(t2); };
            }, []);
            const msg = `[Vibe Coding] 📅 New Interview Booked!\n\nStudent: ${student}\nSession: ${date} at ${time}\nType: Mock Interview\n\nLog in to confirm or reschedule.\nvibecoding.com/interviews`;
            return (
                <div style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,.85)', backdropFilter: 'blur(8px)', zIndex: 900, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 20 }}>
                    <div style={{ maxWidth: 440, width: '100%', animation: 'fadeIn .3s ease' }}>
                        <div style={{ background: '#1a1a2e', border: '2px solid #2a2a4e', borderRadius: 40, padding: '20px 16px 30px', boxShadow: '0 0 60px rgba(0,200,255,.15)', position: 'relative' }}>
                            <div style={{ width: 100, height: 24, background: '#0d0d1a', borderRadius: 12, margin: '0 auto 16px', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 6 }}>
                                <div style={{ width: 8, height: 8, borderRadius: '50%', background: '#333' }} />
                                <div style={{ flex: 1, height: 4, background: '#222', borderRadius: 2 }} />
                            </div>
                            <div style={{ display: 'flex', justifyContent: 'space-between', padding: '0 8px', marginBottom: 12, fontSize: 11, color: '#888' }}>
                                <span>9:41 AM</span><span>📶 📶 🔋</span>
                            </div>
                            <div style={{ background: 'linear-gradient(135deg,#1e3a5f,#0f2040)', border: '1px solid rgba(0,200,255,.3)', borderRadius: 16, padding: 16, marginBottom: 16, boxShadow: '0 4px 20px rgba(0,200,255,.1)' }}>
                                <div style={{ display: 'flex', gap: 10, alignItems: 'flex-start', marginBottom: 10 }}>
                                    <div style={{ width: 36, height: 36, background: 'linear-gradient(135deg,#00F5A0,#00C8FF)', borderRadius: 10, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 18, flexShrink: 0 }}>💬</div>
                                    <div><div style={{ fontWeight: 700, fontSize: 13, color: '#fff', marginBottom: 2 }}>Messages</div><div style={{ fontSize: 11, color: '#aaa' }}>Vibe Coding · now</div></div>
                                </div>
                                <div style={{ fontFamily: 'monospace', fontSize: 12, color: '#ddd', lineHeight: 1.7, whiteSpace: 'pre-line', background: 'rgba(0,0,0,.3)', borderRadius: 10, padding: 12 }}>{msg}</div>
                            </div>
                            <div style={{ textAlign: 'center', padding: '8px 0' }}>
                                {stage === 'sending' && <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8, color: '#aaa', fontSize: 13 }}><span className="loading" /><span>Sending SMS to {phone}...</span></div>}
                                {stage === 'delivered' && <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: 8, color: 'var(--accent)', fontSize: 13, animation: 'fadeIn .3s ease' }}><span style={{ fontSize: 16 }}>✅</span><span style={{ fontWeight: 700 }}>SMS Delivered to {phone}</span></div>}
                                {stage === 'done' && <div style={{ animation: 'fadeIn .3s ease' }}><div style={{ color: 'var(--accent)', fontWeight: 700, fontSize: 14, marginBottom: 4 }}>✅ Notification Sent!</div><div style={{ color: '#888', fontSize: 12 }}>{mentor} has been notified about the new booking</div></div>}
                            </div>
                        </div>
                        {stage === 'done' && <button className="btn btn-primary" style={{ width: '100%', justifyContent: 'center', marginTop: 16 }} onClick={onClose}>Done →</button>}
                    </div>
                </div>
            );
        }

        // ─── PAYMENT MODAL ────────────────────────────────────────────────────────────
        function PaymentModal({ interview, onSuccess, onClose }) {
            const [step, setStep] = useState('details');
            const [topics, setTopics] = useState('');
            const [card, setCard] = useState({ num: '', expiry: '', cvv: '', name: '' });
            const [upiId, setUpiId] = useState('');
            const [method, setMethod] = useState('card');
            const [processing, setProcessing] = useState(false);
            const [cardError, setCardError] = useState('');

            const fmtCard = v => v.replace(/\D/g, '').slice(0, 16).replace(/(.{4})/g, '$1 ').trim();
            const fmtExpiry = v => v.replace(/\D/g, '').slice(0, 4).replace(/(.{2})/, '$1/').replace(/\/$/, '');

            const validateCard = () => {
                if (method === 'card') {
                    if (card.num.replace(/\s/g, '').length < 16) return 'Enter valid 16-digit card number';
                    if (card.expiry.length < 5) return 'Enter valid expiry (MM/YY)';
                    if (card.cvv.length < 3) return 'Enter valid CVV';
                    if (!card.name.trim()) return 'Enter cardholder name';
                }
                if (method === 'upi' && !upiId.includes('@')) return 'Enter valid UPI ID (e.g. name@upi)';
                return '';
            };

            const pay = () => {
                const err = validateCard();
                if (err) { setCardError(err); return; }
                setCardError('');
                setProcessing(true);
                setStep('processing');
                setTimeout(() => { setStep('success'); setProcessing(false); }, 2500);
            };

            const BANKS = ['SBI', 'HDFC', 'ICICI', 'Axis', 'Kotak', 'Yes Bank'];

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" style={{ maxWidth: 480, padding: 0, overflow: 'hidden' }} onClick={e => e.stopPropagation()}>
                        <div style={{ background: 'linear-gradient(135deg,#0a1628,#0d1f3c)', padding: '20px 24px', borderBottom: '1.5px solid var(--border)' }}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                <div><div style={{ fontWeight: 800, fontSize: 17, marginBottom: 2 }}>Complete Booking</div><div style={{ fontSize: 12, color: 'var(--text2)' }}>with {interview.mentor}</div></div>
                                <button onClick={onClose} style={{ background: 'none', border: 'none', color: 'var(--text3)', cursor: 'pointer', fontSize: 20 }}>✕</button>
                            </div>
                        </div>

                        {step === 'processing' && (
                            <div style={{ padding: 60, textAlign: 'center' }}>
                                <div style={{ width: 64, height: 64, border: '4px solid var(--border)', borderTopColor: 'var(--accent)', borderRadius: '50%', animation: 'spin .8s linear infinite', margin: '0 auto 20px' }} />
                                <div style={{ fontWeight: 700, fontSize: 16, marginBottom: 8 }}>Processing Payment...</div>
                                <div style={{ fontSize: 13, color: 'var(--text2)' }}>Please do not close this window</div>
                            </div>
                        )}

                        {step === 'success' && (
                            <div style={{ padding: 48, textAlign: 'center' }}>
                                <div style={{ width: 72, height: 72, background: 'rgba(249,115,22,.12)', border: '2px solid var(--accent)', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 32, margin: '0 auto 20px' }}>✅</div>
                                <div style={{ fontWeight: 800, fontSize: 22, color: 'var(--accent)', marginBottom: 8 }}>Booking Confirmed!</div>
                                <div style={{ fontSize: 14, color: 'var(--text2)', marginBottom: 20, lineHeight: 1.6 }}>
                                    Your interview with <strong style={{ color: 'var(--text)' }}>{interview.mentor}</strong> is confirmed for<br />
                                    <strong style={{ color: 'var(--accent2)' }}>{interview.date} at {interview.time}</strong>
                                </div>
                                <div style={{ background: 'var(--surface2)', borderRadius: 12, padding: 16, marginBottom: 24, textAlign: 'left' }}>
                                    {[['Session', 'Mock Interview · 60 min'], ['Amount Paid', `₹${interview.price}`], ['Transaction ID', `TXN${Date.now().toString().slice(-8)}`], ['Meet Link', 'Will be sent via email']].map(([l, v]) => (
                                        <div key={l} style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8, fontSize: 13 }}><span style={{ color: 'var(--text3)' }}>{l}</span><span style={{ fontWeight: 600 }}>{v}</span></div>
                                    ))}
                                </div>
                                <button className="btn btn-primary" style={{ width: '100%', justifyContent: 'center' }} onClick={onSuccess}>View My Sessions →</button>
                            </div>
                        )}

                        {(step === 'details' || step === 'payment') && (
                            <div style={{ padding: 24 }}>
                                <div style={{ display: 'flex', gap: 0, marginBottom: 24 }}>
                                    {['Session Details', 'Payment'].map((s, i) => (
                                        <div key={s} style={{ flex: 1, display: 'flex', alignItems: 'center', gap: 0 }}>
                                            <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                                                <div style={{ width: 24, height: 24, borderRadius: '50%', background: (step === 'details' && i === 0) || (step === 'payment' && i <= 1) ? 'var(--accent)' : 'var(--border)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 11, fontWeight: 700, color: (step === 'details' && i === 0) || (step === 'payment' && i <= 1) ? '#000' : 'var(--text3)', flexShrink: 0 }}>{i + 1}</div>
                                                <span style={{ fontSize: 12, fontWeight: 600, color: (step === 'details' && i === 0) || (step === 'payment' && i <= 1) ? 'var(--accent)' : 'var(--text3)' }}>{s}</span>
                                            </div>
                                            {i === 0 && <div style={{ flex: 1, height: 1, background: step === 'payment' ? 'var(--accent)' : 'var(--border)', margin: '0 8px' }} />}
                                        </div>
                                    ))}
                                </div>

                                {step === 'details' && (
                                    <>
                                        <div style={{ background: 'linear-gradient(135deg,rgba(0,245,160,.08),rgba(0,200,255,.04))', border: '1.5px solid rgba(249,115,22,.2)', borderRadius: 14, padding: 18, marginBottom: 20 }}>
                                            <div style={{ display: 'flex', gap: 14, marginBottom: 14 }}>
                                                <div style={{ fontSize: 40 }}>{interview.emoji}</div>
                                                <div>
                                                    <div style={{ fontWeight: 800, fontSize: 16 }}>{interview.mentor}</div>
                                                    <div style={{ fontSize: 13, color: 'var(--text2)', marginBottom: 6 }}>{interview.role}</div>
                                                    <span className="badge badge-blue">{interview.type}</span>
                                                </div>
                                            </div>
                                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 10 }}>
                                                {[['📅 Date', interview.date], ['🕐 Time', interview.time], ['⏱ Duration', '60 minutes'], ['⭐ Rating', `${interview.rating}/5.0`]].map(([l, v]) => (
                                                    <div key={l} style={{ background: 'rgba(0,0,0,.2)', borderRadius: 8, padding: '8px 12px' }}>
                                                        <div style={{ fontSize: 11, color: 'var(--text3)', marginBottom: 2 }}>{l}</div>
                                                        <div style={{ fontWeight: 700, fontSize: 13 }}>{v}</div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div style={{ marginBottom: 16 }}>
                                            <label>Topics you want to cover (optional)</label>
                                            <textarea rows={3} value={topics} onChange={e => setTopics(e.target.value)} placeholder="E.g., System Design, Binary Trees, Dynamic Programming..." style={{ resize: 'vertical' }} />
                                        </div>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', background: 'var(--surface2)', borderRadius: 10, padding: '14px 18px', marginBottom: 20, border: '1px solid var(--border)' }}>
                                            <div><div style={{ fontSize: 13, color: 'var(--text3)', marginBottom: 2 }}>Total Amount</div><div style={{ fontWeight: 800, fontSize: 26, color: 'var(--accent)', fontFamily: 'Poppins' }}>₹{interview.price}</div></div>
                                            <div style={{ textAlign: 'right', fontSize: 12, color: 'var(--text3)' }}><div>🔒 Secure Payment</div><div>Full refund if cancelled 24h prior</div></div>
                                        </div>
                                        <button className="btn btn-primary btn-lg" style={{ width: '100%', justifyContent: 'center' }} onClick={() => setStep('payment')}>Proceed to Payment →</button>
                                    </>
                                )}

                                {step === 'payment' && (
                                    <>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', background: 'var(--surface2)', borderRadius: 10, padding: '12px 16px', marginBottom: 20, border: '1px solid var(--border)' }}>
                                            <span style={{ fontSize: 13, color: 'var(--text2)' }}>Paying for: {interview.type} with {interview.mentor.split(' ')[0]}</span>
                                            <span style={{ fontWeight: 800, color: 'var(--accent)', fontFamily: 'Poppins' }}>₹{interview.price}</span>
                                        </div>
                                        <div style={{ display: 'flex', gap: 8, marginBottom: 20 }}>
                                            {[['card', '💳 Card'], ['upi', '📱 UPI'], ['netbanking', '🏦 Net Banking']].map(([m, l]) => (
                                                <button key={m} className={`btn btn-sm ${method === m ? 'btn-primary' : 'btn-ghost'}`} style={{ flex: 1, justifyContent: 'center', fontSize: 12 }} onClick={() => setMethod(m)}>{l}</button>
                                            ))}
                                        </div>
                                        {method === 'card' && (
                                            <div>
                                                <div style={{ marginBottom: 14 }}><label>Card Number</label><input value={card.num} onChange={e => setCard({ ...card, num: fmtCard(e.target.value) })} placeholder="1234 5678 9012 3456" maxLength={19} style={{ fontFamily: 'Poppins', letterSpacing: 2 }} /></div>
                                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, marginBottom: 14 }}>
                                                    <div><label>Expiry Date</label><input value={card.expiry} onChange={e => setCard({ ...card, expiry: fmtExpiry(e.target.value) })} placeholder="MM/YY" maxLength={5} style={{ fontFamily: 'Poppins' }} /></div>
                                                    <div><label>CVV</label><input value={card.cvv} onChange={e => setCard({ ...card, cvv: e.target.value.replace(/\D/g, '').slice(0, 3) })} placeholder="•••" maxLength={3} type="password" style={{ fontFamily: 'Poppins' }} /></div>
                                                </div>
                                                <div style={{ marginBottom: 4 }}><label>Cardholder Name</label><input value={card.name} onChange={e => setCard({ ...card, name: e.target.value })} placeholder="As on card" /></div>
                                                <div style={{ background: 'rgba(0,200,255,.06)', border: '1px solid rgba(0,200,255,.2)', borderRadius: 8, padding: '8px 12px', marginBottom: 14, fontSize: 11, color: 'var(--accent2)' }}>🧪 Demo Mode: Use any 16-digit number, any future date, any 3-digit CVV</div>
                                            </div>
                                        )}
                                        {method === 'upi' && (
                                            <div style={{ marginBottom: 14 }}>
                                                <label>UPI ID</label>
                                                <input value={upiId} onChange={e => setUpiId(e.target.value)} placeholder="yourname@paytm / @phonepe / @gpay" />
                                                <div style={{ background: 'rgba(0,200,255,.06)', border: '1px solid rgba(0,200,255,.2)', borderRadius: 8, padding: '8px 12px', marginTop: 10, fontSize: 11, color: 'var(--accent2)' }}>🧪 Demo: Enter any ID with @ (e.g. demo@upi)</div>
                                                <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap', marginTop: 12 }}>
                                                    {['@paytm', '@phonepe', '@gpay', '@ybl', '@okaxis'].map(u => (
                                                        <button key={u} className="btn btn-ghost btn-sm" style={{ fontSize: 11 }} onClick={() => setUpiId(`demo${u}`)}>{u}</button>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                        {method === 'netbanking' && (
                                            <div style={{ marginBottom: 14 }}>
                                                <label>Select Bank</label>
                                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 8, marginTop: 8 }}>
                                                    {BANKS.map(b => (
                                                        <button key={b} className="btn btn-ghost btn-sm" style={{ justifyContent: 'center', padding: '10px 4px', fontSize: 12 }} onClick={() => { setCard({ ...card, name: b }); pay(); }}>🏦 {b}</button>
                                                    ))}
                                                </div>
                                                <div style={{ background: 'rgba(0,200,255,.06)', border: '1px solid rgba(0,200,255,.2)', borderRadius: 8, padding: '8px 12px', marginTop: 12, fontSize: 11, color: 'var(--accent2)' }}>🧪 Demo: Click any bank to complete payment instantly</div>
                                            </div>
                                        )}
                                        {cardError && <div style={{ color: 'var(--accent3)', fontSize: 12, marginBottom: 10, background: 'rgba(255,107,107,.1)', padding: '8px 12px', borderRadius: 8 }}>⚠️ {cardError}</div>}
                                        <div style={{ display: 'flex', gap: 10 }}>
                                            <button className="btn btn-ghost btn-sm" onClick={() => setStep('details')}>← Back</button>
                                            {method !== 'netbanking' && <button className="btn btn-primary" style={{ flex: 1, justifyContent: 'center' }} onClick={pay}>🔒 Pay ₹{interview.price} Securely</button>}
                                        </div>
                                        <div style={{ display: 'flex', gap: 8, justifyContent: 'center', marginTop: 14, flexWrap: 'wrap' }}>
                                            {['🔒 256-bit SSL', '✓ PCI DSS', '✓ RBI Compliant'].map(l => (
                                                <span key={l} style={{ fontSize: 10, color: 'var(--text3)', background: 'var(--surface2)', padding: '3px 8px', borderRadius: 4 }}>{l}</span>
                                            ))}
                                        </div>
                                    </>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // ─── HR SCHEDULE MODAL ────────────────────────────────────────────────────────
        function HRScheduleModal({ onClose, onPublish, addNotif }) {
            const [form, setForm] = useState({ name: '', role: '', company: '', phone: '', email: '', type: 'Technical', price: '499', date: '', time: '', slots: '3', bio: '', expertise: '' });
            const [step, setStep] = useState('form');
            const [submitting, setSubmitting] = useState(false);

            const submit = () => {
                if (!form.name || !form.phone || !form.date || !form.time) { addNotif({ type: 'error', msg: '⚠️ Please fill Name, Phone, Date and Time', time: 'now' }); return; }
                setSubmitting(true);
                setTimeout(() => { setSubmitting(false); setStep('preview'); }, 800);
            };

            const publish = () => {
                const newSlot = { id: Date.now(), mentor: form.name, role: form.role + ' @ ' + form.company, emoji: '👔', date: form.date, time: form.time, type: form.type, price: parseInt(form.price) || 499, rating: 'New', slots: parseInt(form.slots) || 3, expertise: form.expertise.split(',').map(e => e.trim()).filter(Boolean), available: true, hrPhone: form.phone, isHRSlot: true };
                onPublish(newSlot);
                setStep('done');
                addNotif({ type: 'success', msg: '🎉 Slot published! Now live in Book Interview tab.', time: 'now' });
            };

            if (step === 'done') return (
                <div className="modal-overlay">
                    <div className="modal" style={{ textAlign: 'center' }}>
                        <div style={{ fontSize: 60, marginBottom: 16 }}>🎉</div>
                        <div style={{ fontWeight: 800, fontSize: 22, color: 'var(--accent)', marginBottom: 8 }}>Slot is LIVE!</div>
                        <div style={{ fontSize: 14, color: 'var(--text2)', marginBottom: 16, lineHeight: 1.6 }}><strong style={{ color: 'var(--text)' }}>{form.name}</strong>'s slot is now in the Book Interview tab.<br />SMS notifications will go to <strong style={{ color: 'var(--accent)', fontFamily: 'Poppins' }}>{form.phone}</strong></div>
                        <button className="btn btn-primary" style={{ width: '100%', justifyContent: 'center' }} onClick={onClose}>✓ Go Book This Slot →</button>
                    </div>
                </div>
            );

            if (step === 'preview') return (
                <div className="modal-overlay">
                    <div className="modal">
                        <div style={{ fontWeight: 800, fontSize: 17, marginBottom: 4 }}>Preview Your Slot</div>
                        <div style={{ fontSize: 13, color: 'var(--text2)', marginBottom: 20 }}>This is how students will see you</div>
                        <div className="card" style={{ padding: 20, marginBottom: 20, borderColor: 'rgba(0,245,160,.2)' }}>
                            <div style={{ display: 'flex', gap: 14, marginBottom: 14 }}>
                                <div style={{ fontSize: 40 }}>👔</div>
                                <div>
                                    <div style={{ fontWeight: 800, fontSize: 15 }}>{form.name || 'Your Name'}</div>
                                    <div style={{ fontSize: 12, color: 'var(--text2)', marginBottom: 4 }}>{form.role} @ {form.company}</div>
                                    <div style={{ display: 'flex', gap: 6 }}><span className="badge badge-blue">{form.type}</span><span style={{ fontSize: 12, color: 'var(--accent4)' }}>⭐ New</span></div>
                                </div>
                            </div>
                            <div style={{ display: 'flex', gap: 6, flexWrap: 'wrap', marginBottom: 12 }}>{form.expertise.split(',').filter(Boolean).map(e => <span key={e} className="tag">{e.trim()}</span>)}</div>
                            <div style={{ display: 'flex', justifyContent: 'space-between', background: 'var(--surface2)', borderRadius: 8, padding: '10px 14px', marginBottom: 12 }}>
                                <div><div style={{ fontSize: 12, color: 'var(--text3)' }}>Next Slot</div><div style={{ fontWeight: 700, fontSize: 14 }}>{form.date} · {form.time}</div></div>
                                <div style={{ textAlign: 'right' }}><div style={{ fontSize: 12, color: 'var(--text3)' }}>Price</div><div style={{ fontWeight: 700, fontSize: 18, color: 'var(--accent)', fontFamily: 'Poppins' }}>₹{form.price}</div></div>
                            </div>
                        </div>
                        <div style={{ display: 'flex', gap: 10 }}><button className="btn btn-ghost" onClick={() => setStep('form')}>← Edit</button><button className="btn btn-primary" style={{ flex: 1, justifyContent: 'center' }} onClick={publish}>🚀 Publish Slot</button></div>
                    </div>
                </div>
            );

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" style={{ maxWidth: 520 }} onClick={e => e.stopPropagation()}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20 }}>
                            <div><div style={{ fontWeight: 800, fontSize: 18 }}>Schedule as Interviewer</div><div style={{ fontSize: 13, color: 'var(--text2)', marginTop: 2 }}>Create your slot & get SMS when students book</div></div>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', color: 'var(--text3)', cursor: 'pointer', fontSize: 20 }}>✕</button>
                        </div>
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, marginBottom: 12 }}>
                            <div style={{ gridColumn: '1/-1' }}><label>Full Name *</label><input value={form.name} onChange={e => setForm({ ...form, name: e.target.value })} placeholder="Vikram Shah" /></div>
                            <div><label>Your Role *</label><input value={form.role} onChange={e => setForm({ ...form, role: e.target.value })} placeholder="Sr. SDE" /></div>
                            <div><label>Company *</label><input value={form.company} onChange={e => setForm({ ...form, company: e.target.value })} placeholder="Google" /></div>
                            <div><label>Phone Number * (for SMS alerts)</label><input value={form.phone} onChange={e => setForm({ ...form, phone: e.target.value })} placeholder="+91 98765 43210" type="tel" /></div>
                            <div><label>Email</label><input value={form.email} onChange={e => setForm({ ...form, email: e.target.value })} placeholder="you@company.com" type="email" /></div>
                        </div>
                        <div style={{ background: 'rgba(0,245,160,.06)', border: '1.5px solid rgba(249,115,22,.2)', borderRadius: 10, padding: 12, marginBottom: 14, fontSize: 12, color: 'var(--accent)' }}>📱 <strong>SMS Alerts:</strong> When a student books your slot, you'll receive an SMS on the phone number above.</div>
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, marginBottom: 12 }}>
                            <div><label>Interview Type</label><select value={form.type} onChange={e => setForm({ ...form, type: e.target.value })}>{['Technical', 'Behavioral', 'System Design', 'Mock Full Interview', 'DSA', 'HR Round'].map(t => <option key={t}>{t}</option>)}</select></div>
                            <div><label>Price (₹)</label><input value={form.price} onChange={e => setForm({ ...form, price: e.target.value.replace(/\D/g, '') })} placeholder="499" type="text" /></div>
                            <div><label>Date *</label><input value={form.date} onChange={e => setForm({ ...form, date: e.target.value })} placeholder="Feb 28, 2026" type="text" /></div>
                            <div><label>Time *</label><input value={form.time} onChange={e => setForm({ ...form, time: e.target.value })} placeholder="3:00 PM" /></div>
                            <div style={{ gridColumn: '1/-1' }}><label>Available Slots</label><select value={form.slots} onChange={e => setForm({ ...form, slots: e.target.value })}>{['1', '2', '3', '4', '5'].map(n => <option key={n}>{n}</option>)}</select></div>
                            <div style={{ gridColumn: '1/-1' }}><label>Your Expertise (comma separated)</label><input value={form.expertise} onChange={e => setForm({ ...form, expertise: e.target.value })} placeholder="DSA, System Design, React, Node.js" /></div>
                            <div style={{ gridColumn: '1/-1' }}><label>Short Bio</label><textarea rows={2} value={form.bio} onChange={e => setForm({ ...form, bio: e.target.value })} placeholder="Brief intro about your experience..." style={{ resize: 'vertical' }} /></div>
                        </div>
                        <button className="btn btn-primary btn-lg" style={{ width: '100%', justifyContent: 'center' }} onClick={submit} disabled={submitting}>
                            {submitting ? <><span className="loading" /> Processing...</> : 'Preview Slot →'}
                        </button>
                    </div>
                </div>
            );
        }

        // ─── MOCK INTERVIEW TAB ───────────────────────────────────────────────────────
        const MOCK_PROBLEMS = [
            {
                id: 1, title: 'Two Sum', diff: 'Easy',
                desc: 'Given an array of numbers and a target, return indices of the two numbers that add up to the target.',
                starter: 'function twoSum(nums, target) {\n  // Your solution here\n  \n}\n\n// Tests:\nconsole.log(JSON.stringify(twoSum([2,7,11,15], 9)));  // [0,1]\nconsole.log(JSON.stringify(twoSum([3,2,4], 6)));       // [1,2]',
                tests: [{ expr: 'JSON.stringify(twoSum([2,7,11,15],9))', want: '"[0,1]"' }, { expr: 'JSON.stringify(twoSum([3,2,4],6))', want: '"[1,2]"' }]
            },
            {
                id: 2, title: 'Sum of Digits', diff: 'Easy',
                desc: 'Given a positive integer n, return the sum of all its digits.',
                starter: 'function sumOfDigits(n) {\n  // Your solution here\n  \n}\n\nconsole.log(sumOfDigits(123));   // 6\nconsole.log(sumOfDigits(9999));  // 36',
                tests: [{ expr: 'sumOfDigits(123)', want: '6' }, { expr: 'sumOfDigits(9999)', want: '36' }]
            },
            {
                id: 3, title: 'Fibonacci', diff: 'Medium',
                desc: 'Return the nth Fibonacci number. F(0)=0, F(1)=1, F(n)=F(n-1)+F(n-2).',
                starter: 'function fibonacci(n) {\n  // Your solution here\n  \n}\n\nconsole.log(fibonacci(5));   // 5\nconsole.log(fibonacci(10));  // 55',
                tests: [{ expr: 'fibonacci(5)', want: '5' }, { expr: 'fibonacci(10)', want: '55' }]
            },
        ];
        const MOCK_IQ = [
            'Tell me about yourself and your programming experience.',
            'Describe a challenging technical problem you solved. What was your approach?',
            'CODING: A coding challenge is now loaded in the editor. Explain your thinking as you go, then click Run when ready.',
        ];

        function MockInterviewTab({ user, addNotif }) {
            const [callActive, setCallActive] = useState(false);
            const [camStream, setCamStream] = useState(null);
            const [micOn, setMicOn] = useState(true);
            const [camOn, setCamOn] = useState(true);
            const [callSec, setCallSec] = useState(0);
            const callRef = useRef(null);
            const vidRef = useRef(null);
            const canvasRef = useRef(null);
            const animRef = useRef(null);

            const [started, setStarted] = useState(false);
            const [qIdx, setQIdx] = useState(0);
            const [msgs, setMsgs] = useState([
                { from: 'bot', text: 'Hi! I am Alex, your AI interviewer. Click Start Call on the left to open the video session, then press Start Interview. Good luck!' }
            ]);
            const [ans, setAns] = useState('');
            const [done, setDone] = useState(false);
            const [scores, setScores] = useState(null);
            const [showProb, setShowProb] = useState(false);
            const [prob, setProb] = useState(MOCK_PROBLEMS[0]);

            const [code, setCode] = useState(MOCK_PROBLEMS[0].starter);
            const [outLines, setOutLines] = useState([{ t: '// Run your code to see output here', c: 'ogray' }]);
            const [outOpen, setOutOpen] = useState(true);
            const [running, setRunning] = useState(false);
            const [outBadge, setOutBadge] = useState('');

            const [voiceOn, setVoiceOn] = useState(false);
            const [interim, setInterim] = useState('');
            const recRef = useRef(null);
            const chatBot = useRef(null);

            const lineNums = code.split('\n').map((_, i) => i + 1).join('\n');

            useEffect(() => { chatBot.current && chatBot.current.scrollIntoView({ behavior: 'smooth' }); }, [msgs]);

            // ── call ──────────────────────────────────────────────────────
            const startCall = async () => {
                try {
                    const s = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: true });
                    setCamStream(s);
                    if (vidRef.current) { vidRef.current.srcObject = s; vidRef.current.play().catch(() => { }); }
                } catch (_) {
                    addNotif({ type: 'info', msg: 'Camera unavailable - using avatar mode', time: 'now' });
                }
                setCallActive(true); setCallSec(0);
                callRef.current = setInterval(() => setCallSec(c => c + 1), 1000);
                setTimeout(() => { if (canvasRef.current) animateAI(canvasRef.current); }, 80);
                addNotif({ type: 'success', msg: 'Call started! Alex has joined.', time: 'now' });
            };

            const endCall = () => {
                camStream && camStream.getTracks().forEach(t => t.stop());
                setCamStream(null); clearInterval(callRef.current);
                cancelAnimationFrame(animRef.current);
                setCallActive(false); setCallSec(0);
            };

            const toggleMic = () => {
                if (!camStream) return;
                const v = !micOn; setMicOn(v);
                camStream.getAudioTracks().forEach(t => t.enabled = v);
            };
            const toggleCam = () => {
                if (!camStream) return;
                const v = !camOn; setCamOn(v);
                camStream.getVideoTracks().forEach(t => t.enabled = v);
                if (vidRef.current) vidRef.current.style.opacity = v ? '1' : '0.15';
            };

            const fmtT = s => String(Math.floor(s / 60)).padStart(2, '0') + ':' + String(s % 60).padStart(2, '0');

            const animateAI = (cv) => {
                const ctx = cv.getContext('2d');
                let f = 0;
                const loop = () => {
                    const w = cv.offsetWidth || 220, h = cv.offsetHeight || 175;
                    cv.width = w; cv.height = h;
                    ctx.fillStyle = '#0A1428'; ctx.fillRect(0, 0, w, h);
                    const cx = w / 2, cy = h * 0.42, r = Math.min(w, h) * 0.2, p = 1 + 0.04 * Math.sin(f * 0.05);
                    const g = ctx.createRadialGradient(cx, cy, 0, cx, cy, r * p * 1.6);
                    g.addColorStop(0, 'rgba(0,245,160,.3)'); g.addColorStop(.5, 'rgba(0,200,255,.15)'); g.addColorStop(1, 'transparent');
                    ctx.fillStyle = g; ctx.beginPath(); ctx.arc(cx, cy, r * p * 1.6, 0, Math.PI * 2); ctx.fill();
                    ctx.fillStyle = '#0D1D38'; ctx.strokeStyle = 'rgba(0,245,160,' + (0.5 + 0.3 * Math.sin(f * .03)) + ')'; ctx.lineWidth = 2;
                    ctx.beginPath(); ctx.arc(cx, cy, r * p, 0, Math.PI * 2); ctx.fill(); ctx.stroke();
                    ctx.font = (r * .9) + 'px serif'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText('\uD83E\uDD16', cx, cy);
                    const wy = cy + r * p + 12; ctx.lineWidth = 1.5;
                    for (let i = 0; i < 3; i++) {
                        ctx.strokeStyle = 'rgba(0,245,160,' + (0.45 - i * .1) + ')'; ctx.beginPath();
                        const ww = 28 + i * 11;
                        for (let x = cx - ww; x <= cx + ww; x++) { const y = wy + i * 8 + (3 + i * 2) * Math.sin(x * .2 + f * .15 + i * 1.2); x === Math.ceil(cx - ww) ? ctx.moveTo(x, y) : ctx.lineTo(x, y); }
                        ctx.stroke();
                    }
                    ctx.fillStyle = 'rgba(139,163,188,.7)'; ctx.font = 'bold 10px sans-serif'; ctx.textBaseline = 'bottom';
                    ctx.fillText('Alex - AI Interviewer', w / 2, h - 7);
                    f++; animRef.current = requestAnimationFrame(loop);
                };
                loop();
            };

            // ── interview ─────────────────────────────────────────────────
            const addMsg = (from, text) => setMsgs(m => [...m, { from, text }]);

            const startInterview = () => {
                setStarted(true); setQIdx(0); setDone(false); setScores(null);
                setTimeout(() => askQ(0), 300);
            };

            const askQ = (idx) => {
                const q = MOCK_IQ[idx];
                setMsgs(m => [...m, { from: 'typing', text: '' }]);
                setTimeout(() => {
                    setMsgs(m => m.filter(x => x.from !== 'typing'));
                    addMsg('bot', 'Q' + (idx + 1) + ': ' + q);
                    if (idx === 2) {
                        setProb(MOCK_PROBLEMS[0]);
                        setCode(MOCK_PROBLEMS[0].starter);
                        setShowProb(true);
                        setOutLines([{ t: '// Problem loaded - write your solution and click Run', c: 'ogray' }]);
                        addNotif({ type: 'info', msg: 'Coding problem loaded in editor!', time: 'now' });
                    }
                }, 1100);
            };

            const submitAns = () => {
                const t = ans.trim(); if (!t) return;
                addMsg('user', t); setAns(''); stopVoice();
                const next = qIdx + 1; setQIdx(next);
                if (next >= MOCK_IQ.length) {
                    setTimeout(() => {
                        addMsg('bot', 'Great work! All questions answered. Calculating your score...');
                        setTimeout(() => {
                            const s = { Communication: Math.floor(68 + Math.random() * 28), Technical: Math.floor(65 + Math.random() * 30), CodingStyle: Math.floor(60 + Math.random() * 35) };
                            s.Overall = Math.floor((s.Communication + s.Technical + s.CodingStyle) / 3);
                            setScores(s); setDone(true); setStarted(false);
                        }, 1500);
                    }, 600);
                } else {
                    setTimeout(() => askQ(next), 700);
                }
            };

            const resetSession = () => {
                setStarted(false); setQIdx(0); setDone(false); setScores(null);
                setAns(''); setShowProb(false); setCode(MOCK_PROBLEMS[0].starter);
                setOutLines([{ t: '// Output will appear here', c: 'ogray' }]); setOutBadge('');
                setMsgs([{ from: 'bot', text: 'Session reset! Click Start Interview to begin again.' }]);
            };

            // ── code runner ───────────────────────────────────────────────
            const runCode = () => {
                if (!code.trim()) { addNotif({ type: 'error', msg: 'Write some code first!', time: 'now' }); return; }
                setRunning(true); setOutLines([{ t: 'Running...', c: 'ogray' }]); setOutBadge('');
                setTimeout(() => {
                    const logs = [];
                    try {
                        const fc = {
                            log: (...a) => logs.push({ t: a.map(x => { try { return JSON.stringify(x); } catch (_) { return String(x); } }).join(' '), c: '' }),
                            error: (...a) => logs.push({ t: a.map(x => String(x)).join(' '), c: 'ored' }),
                            warn: (...a) => logs.push({ t: a.map(x => String(x)).join(' '), c: 'oyellow' }),
                        };
                        new Function('console', code)(fc);
                        const out = logs.length ? logs : [{ t: 'Code ran OK (no console output)', c: 'ogreen' }];
                        setOutLines(out); setOutBadge('ok');
                    } catch (e) {
                        setOutLines([{ t: 'Error: ' + e.message, c: 'ored' }]); setOutBadge('err');
                    }
                    runTests(); setRunning(false);
                }, 350);
            };

            const runTests = () => {
                const tests = prob.tests; if (!tests || !tests.length) return;
                let passed = 0;
                const extra = [{ t: '--- Test Cases ---', c: 'ogray' }];
                tests.forEach(tc => {
                    try {
                        const fn = new Function('console', code + '\nreturn ' + tc.expr + ';');
                        const res = String(fn({ log: () => { }, error: () => { }, warn: () => { } }));
                        const ok = res === tc.want; if (ok) passed++;
                        extra.push({ t: (ok ? 'PASS' : 'FAIL') + ': ' + tc.expr + ' = ' + res + ' (want ' + tc.want + ')', c: ok ? 'ogreen' : 'ored' });
                    } catch (e) { extra.push({ t: 'ERROR: ' + tc.expr + ' => ' + e.message, c: 'ored' }); }
                });
                extra.push({ t: passed + '/' + tests.length + ' tests passed', c: passed === tests.length ? 'ogreen' : 'oyellow' });
                setOutLines(l => [...l, ...extra]);
                if (passed === tests.length) {
                    addNotif({ type: 'success', msg: 'All tests passed!', time: 'now' });
                    addMsg('bot', 'All test cases passed! Great solution. Can you explain its time complexity?');
                }
            };

            const handleKey = (e) => {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const s = e.target.selectionStart;
                    const v = code.slice(0, s) + '  ' + code.slice(e.target.selectionEnd);
                    setCode(v);
                    setTimeout(() => { e.target.selectionStart = e.target.selectionEnd = s + 2; }, 0);
                }
            };

            // ── voice ──────────────────────────────────────────────────────
            const startVoice = () => {
                const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SR) { addNotif({ type: 'error', msg: 'Voice not supported - use Chrome', time: 'now' }); return; }
                if (!recRef.current) {
                    const r = new SR(); r.continuous = true; r.interimResults = true; r.lang = 'en-IN';
                    r.onresult = (ev) => {
                        let fin = '', int = '';
                        for (let i = ev.resultIndex; i < ev.results.length; i++) {
                            const t = ev.results[i][0].transcript;
                            ev.results[i].isFinal ? fin += t : int += t;
                        }
                        if (fin) setAns(a => (a + ' ' + fin).trim());
                        setInterim(int);
                    };
                    r.onerror = () => stopVoice();
                    r.onend = () => { if (voiceOn) { try { r.start(); } catch (_) { stopVoice(); } } };
                    recRef.current = r;
                }
                try { recRef.current.start(); } catch (_) { }
                setVoiceOn(true);
            };
            const stopVoice = () => {
                if (recRef.current) { try { recRef.current.stop(); } catch (_) { } }
                setVoiceOn(false); setInterim('');
            };
            const toggleVoice = () => {
                if (!started) { addNotif({ type: 'info', msg: 'Start the interview first!', time: 'now' }); return; }
                voiceOn ? stopVoice() : startVoice();
            };

            // ── render ─────────────────────────────────────────────────────
            const dc = d => d === 'Easy' ? 'badge-green' : d === 'Medium' ? 'badge-yellow' : 'badge-red';

            return (
                <div>
                    <div style={{ background: 'linear-gradient(135deg,rgba(0,200,255,.08),rgba(0,245,160,.04))', border: '1px solid rgba(0,200,255,.2)', borderRadius: 12, padding: 14, marginBottom: 16, display: 'flex', gap: 12, alignItems: 'center', flexWrap: 'wrap' }}>
                        <span style={{ fontSize: 22 }}>🎙️</span>
                        <div style={{ flex: 1 }}>
                            <div style={{ fontWeight: 800, fontSize: 14, marginBottom: 2 }}>AI Mock Interview — Video Call + Live Code Editor</div>
                            <div style={{ fontSize: 12, color: 'var(--text2)' }}>1. Start call &nbsp;|&nbsp; 2. Answer verbal questions &nbsp;|&nbsp; 3. Solve coding challenge live &nbsp;|&nbsp; 4. Get scored</div>
                        </div>
                        {done && <button className="btn btn-ghost btn-sm" onClick={resetSession}>🔄 Reset</button>}
                    </div>

                    <div className="mock-wrap">
                        {/* LEFT */}
                        <div className="mock-left">
                            {/* video strip */}
                            <div className="vstrip">
                                {!callActive && (
                                    <div className="call-overlay">
                                        <div style={{ fontSize: 32 }}>📹</div>
                                        <div style={{ fontSize: 13, fontWeight: 700, color: 'var(--text2)' }}>Connect to start your session</div>
                                        <button className="call-btn" onClick={startCall}>📞</button>
                                        <div style={{ fontSize: 11, color: 'var(--text3)' }}>Click to enable camera &amp; join</div>
                                    </div>
                                )}
                                {callActive && (
                                    <>
                                        <div className="vrec"><div className="rdot" /><span style={{ color: '#fff', fontSize: 10, fontWeight: 700 }}>LIVE</span></div>
                                        <div className="vtmr">{fmtT(callSec)}</div>
                                        <div className="vctrls">
                                            <button className="vpill vpill-b" onClick={toggleMic}>{micOn ? '🎙️ Mute' : '🔇 Unmute'}</button>
                                            <button className="vpill vpill-b" onClick={toggleCam}>{camOn ? '📷 Cam' : '🚫 Cam'}</button>
                                            <button className="vpill vpill-r" onClick={endCall}>📵 End</button>
                                        </div>
                                    </>
                                )}
                                {/* you */}
                                <div className="vtile">
                                    {camStream
                                        ? <video ref={vidRef} autoPlay muted playsInline />
                                        : <div className="vtile-ph"><span style={{ fontSize: 34 }}>👤</span><span style={{ fontSize: 11, color: 'var(--text3)' }}>You</span></div>
                                    }
                                    <div className="vtile-lbl">You — {user && user.name ? user.name : 'Student'}</div>
                                </div>
                                {/* AI */}
                                <div className="vtile">
                                    {callActive
                                        ? <canvas ref={canvasRef} />
                                        : <div className="vtile-ph"><span style={{ fontSize: 34 }}>🤖</span><span style={{ fontSize: 11, color: 'var(--text3)' }}>Alex (AI)</span></div>
                                    }
                                    <div className="vtile-lbl">Alex — AI Interviewer</div>
                                </div>
                                {/* problem tile */}
                                <div className="vtile" style={{ maxWidth: 170, background: '#0F172A', flexShrink: 0 }}>
                                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100%', gap: 4, padding: 8 }}>
                                        <div style={{ fontSize: 9, fontWeight: 700, color: 'var(--text3)', textTransform: 'uppercase', letterSpacing: 1 }}>Problem</div>
                                        <div style={{ fontSize: 11, fontWeight: 700, color: 'var(--accent)', textAlign: 'center', lineHeight: 1.3 }}>{prob.title}</div>
                                        <span className={'badge ' + dc(prob.diff)} style={{ fontSize: 9 }}>{prob.diff}</span>
                                        <div style={{ height: 1, background: 'var(--border)', width: '80%', margin: '3px 0' }} />
                                        {prob.tests.map((tc, i) => (
                                            <div key={i} style={{ fontSize: 9, color: 'var(--text3)', textAlign: 'center' }}>{tc.expr.substring(0, tc.expr.indexOf('(')) + '(...) = ' + tc.want}</div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* status */}
                            <div className="sbar">
                                <span style={{ color: callActive ? 'var(--accent)' : 'var(--text3)' }}>{'● ' + (callActive ? 'Call Active' : 'Not connected')}</span>
                                <span>|</span>
                                <span>{callActive ? 'Alex is connected' : 'Start call to connect'}</span>
                            </div>

                            {/* editor */}
                            <div className="edsec">
                                <div className="edtop">
                                    <div className="etab"><span className="ldot" /> solution.js</div>
                                    <button className="runbtn" disabled={running} onClick={runCode}>
                                        {running ? <span className="loading" /> : <span>&#9654;</span>} Run Code
                                    </button>
                                </div>
                                <div className="edbody">
                                    <pre className="lnums">{lineNums}</pre>
                                    <textarea className="codeta" value={code} onChange={e => setCode(e.target.value)} onKeyDown={handleKey} spellCheck={false} />
                                </div>
                                <div className="outpanel">
                                    <div className="outhdr" onClick={() => setOutOpen(o => !o)}>
                                        <span style={{ fontSize: 11 }}>{outOpen ? '▼' : '▶'}</span>
                                        <span style={{ fontSize: 10, fontWeight: 700, color: 'var(--text3)', textTransform: 'uppercase', letterSpacing: 1 }}>Output</span>
                                        {outBadge === 'ok' && <span className="badge badge-green" style={{ fontSize: 9, marginLeft: 6 }}>OK</span>}
                                        {outBadge === 'err' && <span className="badge badge-red" style={{ fontSize: 9, marginLeft: 6 }}>Error</span>}
                                        <button className="btn btn-ghost btn-sm" style={{ marginLeft: 'auto', padding: '1px 7px', fontSize: 10 }} onClick={e => { e.stopPropagation(); setOutLines([{ t: '// Cleared', c: 'ogray' }]); setOutBadge(''); }}>Clear</button>
                                    </div>
                                    {outOpen && (
                                        <div className="outbody">
                                            {outLines.map((l, i) => <div key={i} className={'oline ' + (l.c || '')}>{l.t}</div>)}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* RIGHT */}
                        <div className="mock-right">
                            <div className="mrh">
                                <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
                                    <div className="airing">🤖</div>
                                    <div>
                                        <div style={{ fontSize: 13, fontWeight: 700 }}>Alex — AI Interviewer</div>
                                        <div style={{ fontSize: 10, color: 'var(--text3)' }}>{done ? 'Session complete' : started ? 'In progress' : 'Ready'}</div>
                                    </div>
                                </div>
                                <div style={{ textAlign: 'right' }}>
                                    <div style={{ fontSize: 10, color: 'var(--text3)' }}>Question</div>
                                    <div style={{ fontSize: 17, fontWeight: 800, fontFamily: 'Poppins', color: 'var(--accent)' }}>{Math.min(qIdx, MOCK_IQ.length)}/{MOCK_IQ.length}</div>
                                </div>
                            </div>

                            {showProb && (
                                <div className="mprob">
                                    <div style={{ display: 'flex', alignItems: 'center', gap: 7, marginBottom: 6 }}>
                                        <span style={{ fontSize: 10, fontWeight: 700, color: '#a78bfa', background: 'rgba(167,139,250,.12)', border: '1px solid rgba(167,139,250,.25)', padding: '2px 8px', borderRadius: 20 }}>Coding Challenge</span>
                                        <span className={'badge ' + dc(prob.diff)} style={{ fontSize: 9 }}>{prob.diff}</span>
                                    </div>
                                    <div style={{ fontSize: 12, fontWeight: 700, marginBottom: 3 }}>{prob.title}</div>
                                    <div style={{ fontSize: 11, color: 'var(--text2)', lineHeight: 1.5, marginBottom: 6 }}>{prob.desc}</div>
                                    <div style={{ fontSize: 10, fontWeight: 700, color: 'var(--text3)', marginBottom: 3 }}>Test Cases:</div>
                                    {prob.tests.map((tc, i) => (
                                        <div key={i} style={{ fontFamily: 'JetBrains Mono', fontSize: 10, color: 'var(--text2)', lineHeight: 1.7 }}>
                                            {tc.expr} = <span style={{ color: 'var(--accent)' }}>{tc.want}</span>
                                        </div>
                                    ))}
                                </div>
                            )}

                            <div className="mchat">
                                {msgs.map((m, i) => {
                                    if (m.from === 'typing') return <div key={i} className="ai-message bot" style={{ marginBottom: 8 }}><span className="typing-dot" /><span className="typing-dot" /><span className="typing-dot" /></div>;
                                    return <div key={i} className={'ai-message ' + (m.from === 'user' ? 'user' : 'bot')} style={{ marginBottom: 8 }}>{m.text}</div>;
                                })}
                                {done && scores && (
                                    <div style={{ background: 'var(--surface2)', border: '1.5px solid rgba(249,115,22,.2)', borderRadius: 12, padding: 14, marginTop: 8 }}>
                                        <div style={{ textAlign: 'center', fontWeight: 800, fontSize: 14, marginBottom: 8 }}>
                                            {scores.Overall >= 80 ? '🏆' : scores.Overall >= 65 ? '👍' : '💪'} Interview Complete
                                        </div>
                                        <div style={{ textAlign: 'center', fontSize: 34, fontWeight: 800, fontFamily: 'Poppins', color: 'var(--accent)', marginBottom: 12 }}>{scores.Overall}%</div>
                                        {Object.entries(scores).filter(([k]) => k !== 'Overall').map(([k, v]) => (
                                            <div key={k} style={{ marginBottom: 8 }}>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 11, marginBottom: 3 }}>
                                                    <span style={{ color: 'var(--text2)' }}>{k}</span>
                                                    <span style={{ fontWeight: 700, color: 'var(--accent)', fontFamily: 'Poppins' }}>{v}%</span>
                                                </div>
                                                <div className="progress-bar"><div className="progress-fill" style={{ width: v + '%' }} /></div>
                                            </div>
                                        ))}
                                        <div style={{ marginTop: 10, fontSize: 11, color: 'var(--text2)', lineHeight: 1.6, background: 'rgba(0,0,0,.2)', borderRadius: 8, padding: 10 }}>
                                            {scores.Overall >= 80 ? 'Excellent! Strong communication and solid technical approach. You are ready for senior roles.'
                                                : scores.Overall >= 65 ? 'Good effort! Add more structure and concrete examples to your answers.'
                                                    : 'Keep practicing! Use the STAR method and break problems into smaller steps.'}
                                        </div>
                                        <button className="btn btn-primary btn-sm" style={{ width: '100%', justifyContent: 'center', marginTop: 10 }} onClick={resetSession}>🔄 New Session</button>
                                    </div>
                                )}
                                <div ref={chatBot} />
                            </div>

                            <div className="minput">
                                {!started && !done && (
                                    <button className="btn btn-primary" style={{ width: '100%', justifyContent: 'center', marginBottom: 8 }} onClick={startInterview}>
                                        &#9654; Start Interview
                                    </button>
                                )}
                                {started && (
                                    <div>
                                        <div style={{ display: 'flex', gap: 6, alignItems: 'flex-end' }}>
                                            <textarea value={ans} onChange={e => setAns(e.target.value)} placeholder="Type your answer here..." rows={2}
                                                style={{ flex: 1, resize: 'none', fontSize: 12 }}
                                                onKeyDown={e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); submitAns(); } }}
                                            />
                                            <div style={{ display: 'flex', flexDirection: 'column', gap: 5 }}>
                                                <button className={'vbtn' + (voiceOn ? ' von' : '')} onClick={toggleVoice}>{voiceOn ? '🔴' : '🎤'}</button>
                                                <button className="btn btn-primary btn-sm" style={{ padding: '6px 10px' }} onClick={submitAns}>Send</button>
                                            </div>
                                        </div>
                                        {voiceOn && interim && <div className="tbar">🎤 {interim}</div>}
                                        <div style={{ fontSize: 10, color: 'var(--text3)', marginTop: 4 }}>Enter to send &nbsp;|&nbsp; Shift+Enter for newline &nbsp;|&nbsp; 🎤 for voice</div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // ─── INTERVIEW PAGE (with real AI scoring) ────────────────────────────────────
        function InterviewPage({ user, addNotif }) {
            const [tab, setTab] = useState('book');
            const [payModal, setPayModal] = useState(null);
            const [hrModal, setHrModal] = useState(false);
            const [booked, setBooked] = useState([]);
            const [customSlots, setCustomSlots] = useState([]);
            const [phoneNotif, setPhoneNotif] = useState(null);
            const [aiAnswer, setAiAnswer] = useState('');
            const [qIdx, setQIdx] = useState(0);
            const [score, setScore] = useState(null);
            const [scoring, setScoring] = useState(false);

            const bqQs = [
                'Tell me about yourself and your journey as a developer.',
                'Describe a challenging project you worked on. How did you overcome obstacles?',
                'Where do you see yourself in 5 years?',
                'Why do you want to join this company?',
                'Tell me about a time you had to learn something quickly.',
                'How do you handle conflicts in a team?',
            ];

            const getAIScore = async () => {
                if (!aiAnswer.trim() || aiAnswer.length < 20) {
                    addNotif({ type: 'error', msg: 'Please write a more detailed answer (at least 20 characters)', time: 'now' });
                    return;
                }
                setScoring(true); setScore(null);
                try {
                    const systemPrompt = `You are an experienced technical recruiter and interview coach. Score interview answers objectively using the STAR method framework. Be specific, encouraging but honest.`;
                    const prompt = `Score this behavioral interview answer for the question: "${bqQs[qIdx]}"

    CANDIDATE'S ANSWER:
    ${aiAnswer}

    Return ONLY this exact JSON (no markdown):
    {
    "overall": <0-100>,
    "communication": <0-100>,
    "content": <0-100>,
    "confidence": <0-100>,
    "starUsage": <0-100>,
    "feedback": "<2-3 specific sentences about what they did well and what to improve>",
    "whatWorked": "<1 specific thing done well>",
    "improvement": "<1 specific actionable improvement>",
    "sampleOpener": "<a better opening sentence for this answer>"
    }`;

                    const result = await callClaude([{ role: 'user', content: prompt }], systemPrompt, 600);
                    const jsonMatch = result.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        setScore(JSON.parse(jsonMatch[0]));
                    } else {
                        throw new Error('Parse error');
                    }
                } catch (e) {
                    setScore({ overall: Math.floor(Math.random() * 25) + 60, communication: Math.floor(Math.random() * 20) + 65, content: Math.floor(Math.random() * 25) + 55, confidence: Math.floor(Math.random() * 20) + 60, starUsage: Math.floor(Math.random() * 30) + 50, feedback: 'Good attempt! Try to be more specific with metrics and outcomes. Structure your answer using the STAR method clearly.', whatWorked: 'You addressed the question directly.', improvement: 'Add specific numbers or metrics to quantify your impact.', sampleOpener: 'In my previous role, I faced a situation where...' });
                }
                setScoring(false);
            };

            const handleBookingSuccess = (interview) => {
                setBooked(b => [...b, { ...interview, bookedAt: new Date().toLocaleString() }]);
                setPayModal(null);
                const mentorPhone = interview.hrPhone || '+91 98765 43210';
                setPhoneNotif({ phone: mentorPhone, mentor: interview.mentor, student: user.name, date: interview.date, time: interview.time });
                addNotif({ type: 'success', msg: `🎉 Interview booked with ${interview.mentor}! SMS sent to mentor.`, time: 'now' });
            };

            return (
                <div className="page-content fade-in">
                    <div className="section-header">
                        <div className="section-title">Interview Center</div>
                        <button className="btn btn-secondary btn-sm" onClick={() => setHrModal(true)}>👔 Schedule as HR/Mentor</button>
                    </div>

                    <div className="tabs" style={{ maxWidth: 700, marginBottom: 20 }}>
                        {[['book', '📅 Book Interview'], ['practice', '🤖 AI Practice'], ['mock', '🎙️ Mock Interview'], ['results', 'My Sessions']].map(([t, l]) => (
                            <div key={t} className={`tab ${tab === t ? 'active' : ''}`} onClick={() => setTab(t)} style={{ fontSize: 13, position: 'relative' }}>
                                {l}
                                {t === 'results' && booked.length > 0 && <span style={{ position: 'absolute', top: 4, right: 4, width: 6, height: 6, background: 'var(--accent)', borderRadius: '50%' }} />}
                                {t === 'mock' && <span style={{ position: 'absolute', top: 2, right: 2, background: 'var(--accent)', color: '#000', borderRadius: 4, fontSize: 8, fontWeight: 900, padding: '1px 4px' }}>NEW</span>}
                            </div>
                        ))}
                    </div>

                    {tab === 'book' && (
                        <div>
                            <div style={{ background: 'linear-gradient(135deg,rgba(0,200,255,.08),rgba(0,245,160,.04))', border: '1px solid rgba(0,200,255,.2)', borderRadius: 12, padding: 14, marginBottom: 20, display: 'flex', gap: 12, alignItems: 'center' }}>
                                <span style={{ fontSize: 20 }}>💡</span>
                                <div style={{ fontSize: 13, color: 'var(--text2)' }}><strong style={{ color: 'var(--text)' }}>How it works:</strong> Book a slot → pay securely → mentor gets SMS notification → join the session on the scheduled date.</div>
                            </div>
                            <div className="grid-2" style={{ gap: 16 }}>
                                {[...INTERVIEWS, ...customSlots].map(iv => {
                                    const isBooked = booked.some(b => b.id === iv.id);
                                    return (
                                        <div key={iv.id} className="card" style={{ padding: 20, borderColor: isBooked ? 'rgba(0,245,160,.3)' : 'var(--border)' }}>
                                            {isBooked && <div style={{ background: 'var(--accent-light)', border: '1.5px solid rgba(249,115,22,.2)', borderRadius: 8, padding: '6px 12px', marginBottom: 12, fontSize: 12, fontWeight: 700, color: 'var(--accent)', textAlign: 'center' }}>✅ Already Booked</div>}
                                            {iv.isHRSlot && !isBooked && <div style={{ background: 'rgba(0,200,255,.1)', border: '1px solid rgba(0,200,255,.2)', borderRadius: 8, padding: '5px 12px', marginBottom: 12, fontSize: 11, fontWeight: 700, color: 'var(--accent2)', textAlign: 'center' }}>✨ NEW — Added by HR/Mentor</div>}
                                            <div style={{ display: 'flex', gap: 14, marginBottom: 14 }}>
                                                <div style={{ fontSize: 40 }}>{iv.emoji}</div>
                                                <div>
                                                    <div style={{ fontWeight: 800, fontSize: 15 }}>{iv.mentor}</div>
                                                    <div style={{ fontSize: 12, color: 'var(--text2)', marginBottom: 4 }}>{iv.role}</div>
                                                    <div style={{ display: 'flex', gap: 6, alignItems: 'center' }}><span className="badge badge-blue">{iv.type}</span><span style={{ fontSize: 12, color: 'var(--accent4)' }}>⭐ {iv.rating}</span></div>
                                                </div>
                                            </div>
                                            <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap', marginBottom: 12 }}>{iv.expertise.map(e => <span key={e} className="tag">{e}</span>)}</div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', background: 'var(--surface2)', borderRadius: 8, padding: '10px 14px', marginBottom: 12 }}>
                                                <div><div style={{ fontSize: 12, color: 'var(--text3)' }}>Next Slot</div><div style={{ fontWeight: 700, fontSize: 14 }}>{iv.date} · {iv.time}</div></div>
                                                <div style={{ textAlign: 'right' }}><div style={{ fontSize: 12, color: 'var(--text3)' }}>Price</div><div style={{ fontWeight: 700, fontSize: 22, color: 'var(--accent)', fontFamily: 'Poppins' }}>₹{iv.price}</div></div>
                                            </div>
                                            <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>
                                                <button className={`btn btn-sm ${isBooked ? 'btn-ghost' : 'btn-primary'}`} style={{ flex: 1, justifyContent: 'center', opacity: isBooked ? .7 : 1 }} disabled={isBooked} onClick={() => !isBooked && setPayModal(iv)}>
                                                    {isBooked ? '✅ Booked' : '💳 Book Now'}
                                                </button>
                                                <div style={{ fontSize: 12, color: 'var(--text3)', display: 'flex', alignItems: 'center', gap: 4 }}>🎫 {iv.slots} left</div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}

                    {tab === 'practice' && (
                        <div style={{ maxWidth: 700 }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 16 }}>
                                <div className="api-badge">⚡ Scored by Claude AI</div>
                                <span style={{ fontSize: 12, color: 'var(--text3)' }}>Real AI feedback on every answer</span>
                            </div>
                            <div className="card" style={{ padding: 24, marginBottom: 16 }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}>
                                    <div>
                                        <div style={{ fontWeight: 700, fontSize: 15 }}>Behavioral Question {qIdx + 1}/{bqQs.length}</div>
                                        <div style={{ fontSize: 12, color: 'var(--text2)' }}>Answer using STAR method for best score</div>
                                    </div>
                                    <div className="badge badge-blue">STAR Method</div>
                                </div>
                                <div style={{ background: 'var(--surface2)', border: '1.5px solid var(--border)', borderRadius: 10, padding: 18, marginBottom: 16, fontSize: 15, fontWeight: 600, lineHeight: 1.5 }}>
                                    💬 {bqQs[qIdx]}
                                </div>
                                <textarea rows={7} value={aiAnswer} onChange={e => setAiAnswer(e.target.value)} placeholder="Type your answer here...&#10;&#10;Situation: Describe the context...&#10;Task: What was your responsibility...&#10;Action: What did you do specifically...&#10;Result: What was the outcome..." style={{ resize: 'vertical', marginBottom: 12, fontFamily: 'inherit', fontSize: 13, lineHeight: 1.6 }} />
                                <div style={{ display: 'flex', gap: 8 }}>
                                    <button className="btn btn-ghost btn-sm" onClick={() => { setQIdx((qIdx - 1 + bqQs.length) % bqQs.length); setAiAnswer(''); setScore(null); }}>← Prev</button>
                                    <button className="btn btn-primary btn-sm" onClick={getAIScore} disabled={scoring || !aiAnswer.trim()}>
                                        {scoring ? <><span className="loading" /> Claude is scoring...</> : '🤖 Get AI Score'}
                                    </button>
                                    <button className="btn btn-ghost btn-sm" onClick={() => { setQIdx((qIdx + 1) % bqQs.length); setAiAnswer(''); setScore(null); }}>Next →</button>
                                </div>
                            </div>

                            {scoring && (
                                <div className="card" style={{ padding: 24, textAlign: 'center', borderColor: 'rgba(0,245,160,.2)' }}>
                                    <div style={{ fontSize: 32, marginBottom: 12 }}>🤖</div>
                                    <div style={{ fontWeight: 700, marginBottom: 8 }}>Claude is analyzing your answer...</div>
                                    <div style={{ display: 'flex', justifyContent: 'center', gap: 4, marginBottom: 8 }}><span className="typing-dot" /><span className="typing-dot" /><span className="typing-dot" /></div>
                                    <div style={{ fontSize: 12, color: 'var(--text3)' }}>Checking STAR structure, communication clarity, content depth, and confidence signals</div>
                                </div>
                            )}

                            {score && !scoring && (
                                <div className="card" style={{ padding: 24, borderColor: 'rgba(0,245,160,.2)' }}>
                                    <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 16 }}>
                                        <div className="api-badge">⚡ Claude AI Evaluation</div>
                                    </div>
                                    <div style={{ display: 'flex', gap: 20, alignItems: 'center', marginBottom: 16 }}>
                                        <ScoreRing score={score.overall} size={90} />
                                        <div>
                                            <div style={{ fontWeight: 800, fontSize: 18 }}>AI Interview Score</div>
                                            <div style={{ fontSize: 13, color: 'var(--text2)' }}>Based on STAR framework analysis</div>
                                        </div>
                                    </div>
                                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 8, marginBottom: 16 }}>
                                        {[['Communication', score.communication, 'var(--accent)'], ['Content Quality', score.content, 'var(--accent2)'], ['Confidence', score.confidence, 'var(--accent4)'], ['STAR Usage', score.starUsage, '#A78BFA']].map(([l, v, c]) => (
                                            <div key={l} style={{ textAlign: 'center', background: 'var(--surface2)', borderRadius: 8, padding: 12 }}>
                                                <div style={{ fontSize: 22, fontWeight: 800, color: c, fontFamily: 'Poppins' }}>{v}</div>
                                                <div style={{ fontSize: 11, color: 'var(--text3)' }}>{l}</div>
                                            </div>
                                        ))}
                                    </div>
                                    <div style={{ background: 'var(--surface2)', borderRadius: 8, padding: 14, marginBottom: 10, fontSize: 13, lineHeight: 1.6, color: 'var(--text2)' }}>
                                        <span style={{ color: 'var(--accent)', fontWeight: 700 }}>🤖 Feedback: </span>{score.feedback}
                                    </div>
                                    {score.whatWorked && (
                                        <div style={{ background: 'rgba(0,245,160,.06)', border: '1.5px solid rgba(249,115,22,.2)', borderRadius: 8, padding: 12, marginBottom: 10 }}>
                                            <div style={{ fontSize: 11, fontWeight: 700, color: 'var(--accent)', marginBottom: 4 }}>✅ WHAT WORKED</div>
                                            <div style={{ fontSize: 12, color: 'var(--text2)' }}>{score.whatWorked}</div>
                                        </div>
                                    )}
                                    {score.improvement && (
                                        <div style={{ background: 'rgba(255,217,61,.06)', border: '1px solid rgba(255,217,61,.2)', borderRadius: 8, padding: 12, marginBottom: 10 }}>
                                            <div style={{ fontSize: 11, fontWeight: 700, color: 'var(--accent4)', marginBottom: 4 }}>💡 IMPROVEMENT</div>
                                            <div style={{ fontSize: 12, color: 'var(--text2)' }}>{score.improvement}</div>
                                        </div>
                                    )}
                                    {score.sampleOpener && (
                                        <div style={{ background: 'rgba(0,200,255,.06)', border: '1px solid rgba(0,200,255,.2)', borderRadius: 8, padding: 12 }}>
                                            <div style={{ fontSize: 11, fontWeight: 700, color: 'var(--accent2)', marginBottom: 4 }}>✏️ BETTER OPENER</div>
                                            <div style={{ fontSize: 12, color: 'var(--text2)', fontStyle: 'italic' }}>"{score.sampleOpener}"</div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    )}

                    {tab === 'mock' && (
                        <MockInterviewTab user={user} addNotif={addNotif} />
                    )}

                    {tab === 'results' && (
                        <div>
                            {booked.length === 0 ? (
                                <div style={{ textAlign: 'center', padding: 60, color: 'var(--text3)' }}>
                                    <div style={{ fontSize: 48, marginBottom: 12 }}>🎤</div>
                                    <div style={{ fontWeight: 700, fontSize: 16, marginBottom: 8 }}>No interviews booked yet</div>
                                    <div style={{ fontSize: 13, marginBottom: 20 }}>Book a session with an expert mentor</div>
                                    <button className="btn btn-primary" onClick={() => setTab('book')}>Browse Mentors →</button>
                                </div>
                            ) : (
                                <>
                                    <div style={{ fontWeight: 700, marginBottom: 16 }}>Your Booked Sessions ({booked.length})</div>
                                    {booked.map((b, i) => (
                                        <div key={i} className="card" style={{ padding: 20, marginBottom: 12, borderLeft: '3px solid var(--accent)' }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', flexWrap: 'wrap', gap: 8 }}>
                                                <div style={{ display: 'flex', gap: 12, alignItems: 'center' }}>
                                                    <div style={{ fontSize: 32 }}>{b.emoji}</div>
                                                    <div><div style={{ fontWeight: 800, fontSize: 15 }}>{b.mentor}</div><div style={{ fontSize: 12, color: 'var(--text2)' }}>{b.role}</div></div>
                                                </div>
                                                <span className="badge badge-green">✅ Confirmed</span>
                                            </div>
                                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 10, marginTop: 14 }}>
                                                {[['📅 Date', b.date], ['🕐 Time', b.time], ['💳 Paid', `₹${b.price}`]].map(([l, v]) => (
                                                    <div key={l} style={{ background: 'var(--surface2)', borderRadius: 8, padding: '8px 12px' }}><div style={{ fontSize: 11, color: 'var(--text3)', marginBottom: 2 }}>{l}</div><div style={{ fontWeight: 700, fontSize: 13 }}>{v}</div></div>
                                                ))}
                                            </div>
                                            <div style={{ background: 'rgba(0,200,255,.1)', border: '1px solid rgba(0,200,255,.2)', borderRadius: 8, padding: '6px 14px', fontSize: 12, color: 'var(--accent2)', marginTop: 14, textAlign: 'center' }}>📹 Meet link will be sent 30 min before</div>
                                        </div>
                                    ))}
                                </>
                            )}
                        </div>
                    )}

                    {payModal && <PaymentModal interview={payModal} onSuccess={() => handleBookingSuccess(payModal)} onClose={() => setPayModal(null)} />}
                    {hrModal && <HRScheduleModal onClose={() => setHrModal(false)} onPublish={(slot) => { setCustomSlots(s => [...s, slot]); setHrModal(false); setTab('book'); }} addNotif={addNotif} />}
                    {phoneNotif && <PhoneNotifSimulator phone={phoneNotif.phone} mentor={phoneNotif.mentor} student={phoneNotif.student} date={phoneNotif.date} time={phoneNotif.time} onClose={() => { setPhoneNotif(null); if (booked.length > 0) setTab('results'); }} />}
                </div>
            );
        }

        // ─── JOBS PAGE ────────────────────────────────────────────────────────────────
        function JobsPage({ user, addNotif }) {
            const [search, setSearch] = useState('');
            const [applied, setApplied] = useState([]);
            const [filter, setFilter] = useState('all');

            const filtered = JOBS.filter(j => {
                if (search && !j.title.toLowerCase().includes(search.toLowerCase()) && !j.company.toLowerCase().includes(search.toLowerCase())) return false;
                if (filter === 'eligible' && j.minScore > (user.careerScore?.overall || 0)) return false;
                if (filter === 'matched' && j.match < 70) return false;
                return true;
            });

            return (
                <div className="page-content fade-in">
                    <div className="section-header">
                        <div>
                            <div className="section-title">Job Board</div>
                            <div style={{ fontSize: 13, color: 'var(--text2)', marginTop: 4 }}>Matched to your career score: <span style={{ color: 'var(--accent)', fontWeight: 700 }}>{user.careerScore?.overall || 0}/100</span></div>
                        </div>
                    </div>

                    <div style={{ background: 'linear-gradient(135deg,rgba(0,245,160,.1),rgba(0,200,255,.05))', border: '1.5px solid rgba(249,115,22,.2)', borderRadius: 12, padding: 16, marginBottom: 20, display: 'flex', gap: 16, flexWrap: 'wrap', alignItems: 'center' }}>
                        <div style={{ fontSize: 16 }}>🤖</div>
                        <div><div style={{ fontWeight: 700, fontSize: 14 }}>AI Job Matching Active</div><div style={{ fontSize: 12, color: 'var(--text2)' }}>Jobs are ranked by match % based on your skills, roadmap progress, and career score</div></div>
                        <div style={{ marginLeft: 'auto', display: 'flex', gap: 8 }}>
                            <span className="badge badge-green">Score: {user.careerScore?.overall || 0}/100</span>
                            <span className="badge badge-blue">{JOBS.filter(j => j.minScore <= (user.careerScore?.overall || 0)).length} jobs eligible</span>
                        </div>
                    </div>

                    <div style={{ display: 'flex', gap: 12, marginBottom: 20, flexWrap: 'wrap' }}>
                        <input value={search} onChange={e => setSearch(e.target.value)} placeholder="🔍 Search jobs or companies..." style={{ flex: 1, minWidth: 200 }} />
                        <div style={{ display: 'flex', gap: 4 }}>
                            {['all', 'eligible', 'matched'].map(f => <button key={f} className={`btn btn-sm ${filter === f ? 'btn-primary' : 'btn-ghost'}`} onClick={() => setFilter(f)}>{f === 'all' ? 'All' : f === 'eligible' ? 'Eligible' : 'Top Matches'}</button>)}
                        </div>
                    </div>

                    <div style={{ display: 'grid', gap: 12 }}>
                        {[...filtered].sort((a, b) => b.match - a.match).map(job => {
                            const eligible = job.minScore <= (user.careerScore?.overall || 0);
                            const isApplied = applied.includes(job.id);
                            return (
                                <div key={job.id} className="card job-card" style={{ borderLeft: `3px solid ${job.match >= 85 ? 'var(--accent)' : job.match >= 70 ? 'var(--accent2)' : 'var(--border)'}` }}>
                                    <div style={{ display: 'flex', gap: 16, alignItems: 'flex-start' }}>
                                        <div className="company-logo" style={{ background: 'var(--surface2)', color: 'var(--text)', fontSize: 24 }}>{job.emoji}</div>
                                        <div style={{ flex: 1 }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', flexWrap: 'wrap', gap: 8 }}>
                                                <div>
                                                    <div style={{ fontWeight: 800, fontSize: 16 }}>{job.title}</div>
                                                    <div style={{ fontSize: 13, color: 'var(--text2)', marginBottom: 8 }}>{job.company} · {job.location}</div>
                                                </div>
                                                <div style={{ textAlign: 'right' }}>
                                                    <div style={{ fontSize: 20, fontWeight: 800, color: job.match >= 85 ? 'var(--accent)' : job.match >= 70 ? 'var(--accent2)' : 'var(--text3)', fontFamily: 'Poppins' }}>{job.match}%</div>
                                                    <div style={{ fontSize: 10, color: 'var(--text3)' }}>Match Score</div>
                                                </div>
                                            </div>
                                            <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap', marginBottom: 10 }}>
                                                <span className="badge badge-gray">{job.type}</span>
                                                <span className="badge badge-green">{job.salary}</span>
                                                {!eligible && <span className="badge badge-red">Need {job.minScore} score</span>}
                                                {eligible && <span className="badge badge-blue">✓ You're eligible</span>}
                                            </div>
                                            <div style={{ display: 'flex', gap: 6, flexWrap: 'wrap', marginBottom: 12 }}>{job.skills.map(s => <span key={s} className="tag">{s}</span>)}</div>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                <div style={{ fontSize: 12, color: 'var(--text3)' }}>👥 {job.applicants} applicants · 🕐 {job.posted}</div>
                                                <button className={`btn btn-sm ${isApplied ? 'btn-ghost' : eligible ? 'btn-primary' : 'btn-ghost'}`} disabled={isApplied || !eligible}
                                                    onClick={() => { setApplied([...applied, job.id]); addNotif({ type: 'success', msg: `Applied to ${job.title} at ${job.company}!`, time: 'now' }); }}>
                                                    {isApplied ? '✅ Applied' : eligible ? 'Apply Now →' : 'Improve Score'}
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }

        // ─── AI COACH PAGE (Real API with streaming) ──────────────────────────────────
        function AICoachPage({ user, setPage }) {
            const [messages, setMessages] = useState([
                { role: 'bot', text: `Hey ${user.name.split(' ')[0]}! 👋 I'm your AI Career Coach powered by Claude.\n\nYour current career score is **${user.careerScore?.overall || 0}/100**.\n\nHere's my initial analysis:\n\n📊 **DSA** (${user.careerScore?.dsa || 0}/100) — Needs improvement. Focus on Trees & Graphs next.\n📄 **Resume** (${user.careerScore?.resume || 0}/100) — ATS score is low. Add more quantified achievements.\n🎤 **Interview** (${user.careerScore?.interview || 0}/100) — Book a mock interview to boost this fast.\n\nYou're **${Math.max(0, 75 - (user.careerScore?.overall || 0))} points away** from being interview-ready (75+)!\n\nAsk me anything — I have full context on your profile and progress. 🚀`, streaming: false }
            ]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const chatRef = useRef(null);
            const [weeklyAnalyzing, setWeeklyAnalyzing] = useState(false);
            const [weeklyReport, setWeeklyReport] = useState(null);

            const SYSTEM_PROMPT = `You are an expert AI career coach for Vibe Coding, an EdTech platform for Indian software engineers. You have full context on the student's profile:

    Student: ${user.name}
    Career Score: ${user.careerScore?.overall || 0}/100
    Score Breakdown:
    - Coding: ${user.careerScore?.coding || 0}/100
    - DSA: ${user.careerScore?.dsa || 0}/100  
    - Consistency: ${user.careerScore?.consistency || 0}/100
    - Resume: ${user.careerScore?.resume || 0}/100
    - Interview: ${user.careerScore?.interview || 0}/100
    - Projects: ${user.careerScore?.projects || 0}/100

    Current Progress:
    - C Basics: ${user.progress?.basics || 0}%
    - DSA: ${user.progress?.dsa || 0}%
    - Web Dev: ${user.progress?.development || 0}%
    - Resume: ${user.progress?.resume || 0}%
    - Interview: ${user.progress?.interview || 0}%
    - Jobs: ${user.progress?.jobs || 0}%

    Solved Problems: ${user.solvedProblems?.length || 0} total
    Streak: ${user.streak || 0} days
    Skills: ${(user.skills || []).join(', ')}

    Be concise, motivating, and actionable. Give specific advice based on their actual scores. Use emojis sparingly. Format with line breaks for readability. Address them by first name sometimes. Focus on Indian tech job market (Flipkart, Swiggy, Zepto, Razorpay, Google India etc).`;

            const send = async () => {
                if (!input.trim() || loading) return;
                const userMsg = input.trim();
                setInput('');
                setMessages(m => [...m, { role: 'user', text: userMsg }]);
                setLoading(true);

                const botMsgId = Date.now();
                setMessages(m => [...m, { role: 'bot', text: '', streaming: true, id: botMsgId }]);

                try {
                    const history = messages.map(m => ({ role: m.role === 'user' ? 'user' : 'assistant', content: m.text }));
                    history.push({ role: 'user', content: userMsg });

                    let fullText = '';
                    await callClaudeStream(
                        history, SYSTEM_PROMPT, 800,
                        (chunk) => {
                            fullText = chunk;
                            setMessages(m => m.map(msg => msg.id === botMsgId ? { ...msg, text: chunk, streaming: true } : msg));
                        }
                    );
                    setMessages(m => m.map(msg => msg.id === botMsgId ? { ...msg, text: fullText, streaming: false } : msg));
                } catch (e) {
                    const errMsg = `Sorry, I had trouble connecting. Error: ${e.message}\n\nBased on your profile, I recommend focusing on your DSA score (${user.careerScore?.dsa || 0}/100) first — it's your biggest growth area!`;
                    setMessages(m => m.map(msg => msg.id === botMsgId ? { ...msg, text: errMsg, streaming: false } : msg));
                }
                setLoading(false);
            };

            const generateWeeklyReport = async () => {
                setWeeklyAnalyzing(true);
                try {
                    const weakestEntry = Object.entries(user.careerScore || {}).filter(([k]) => k !== 'overall').sort((a, b) => a[1] - b[1])[0] || ['dsa', 0];
                    const prompt = `Generate a brief weekly progress report for ${user.name.split(' ')[0]} with these stats:
    - Career Score: ${user.careerScore?.overall || 0}/100 (target: 75)
    - Problems solved: ${user.solvedProblems?.length || 0}
    - Streak: ${user.streak || 0} days
    - Weakest area: ${weakestEntry[0]}

    Return JSON only:
    {
    "headline": "<motivating one-liner>",
    "topWin": "<biggest achievement this week>",
    "focusNext": "<top priority for next week>",
    "streakMessage": "<comment on their streak>",
    "score_delta": "+2",
    "prediction": "<prediction for reaching interview-ready>"
    }`;
                    const result = await callClaude([{ role: 'user', content: prompt }], 'You are a concise analytics assistant. Return only valid JSON.', 400);
                    const jsonMatch = result.match(/\{[\s\S]*\}/);
                    if (jsonMatch) setWeeklyReport(JSON.parse(jsonMatch[0]));
                } catch (e) {
                    setWeeklyReport({ headline: "Keep going — you're making real progress!", topWin: `Maintained a ${user.streak || 0}-day streak`, focusNext: 'Solve 5 tree problems to boost DSA score', streakMessage: `${user.streak || 0} days is impressive! Don't break the chain.`, score_delta: '+2', prediction: 'At this pace, interview-ready in ~3 weeks' });
                }
                setWeeklyAnalyzing(false);
            };

            useEffect(() => { if (chatRef.current) chatRef.current.scrollTop = chatRef.current.scrollHeight; }, [messages]);

            const suggestions = ['How to improve my DSA score?', 'Analyze my resume score', 'Am I interview ready?', 'Which jobs should I apply to?', 'What should I study this week?', 'Give me a study plan'];

            return (
                <div className="page-content fade-in">
                    <div className="grid-2" style={{ gap: 20, alignItems: 'start' }}>
                        <div className="card" style={{ overflow: 'hidden', display: 'flex', flexDirection: 'column', height: 'calc(100vh - 140px)' }}>
                            <div style={{ padding: '16px 20px', borderBottom: '1.5px solid var(--border)', display: 'flex', alignItems: 'center', gap: 10 }}>
                                <div style={{ width: 36, height: 36, background: 'linear-gradient(135deg,var(--accent),var(--accent2))', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 16 }}>🤖</div>
                                <div>
                                    <div style={{ fontWeight: 700, fontSize: 14 }}>AI Career Coach</div>
                                    <div style={{ fontSize: 11, display: 'flex', alignItems: 'center', gap: 6 }}>
                                        <span style={{ width: 6, height: 6, background: loading ? 'var(--accent4)' : 'var(--accent)', borderRadius: '50%', display: 'inline-block', animation: loading ? 'pulse .8s infinite' : 'none' }} />
                                        <span style={{ color: 'var(--accent)' }}>{loading ? 'Thinking...' : 'Online — Claude AI'}</span>
                                    </div>
                                </div>
                                <div style={{ marginLeft: 'auto' }}><div className="api-badge">Claude AI</div></div>
                            </div>

                            <div ref={chatRef} style={{ flex: 1, overflowY: 'auto', padding: 16 }}>
                                {messages.map((m, i) => (
                                    <div key={i} className={`ai-message ${m.role} ${m.streaming ? 'ai-streaming' : ''}`} style={{ whiteSpace: 'pre-line' }}>
                                        {m.text.replace(/\*\*(.*?)\*\*/g, '$1')}
                                        {m.streaming && m.text === '' && (
                                            <span style={{ display: 'inline-flex', gap: 3, alignItems: 'center', padding: '4px 0' }}>
                                                <span className="typing-dot" /><span className="typing-dot" /><span className="typing-dot" />
                                            </span>
                                        )}
                                    </div>
                                ))}
                            </div>

                            <div style={{ padding: 12, borderTop: '1px solid var(--border)' }}>
                                <div style={{ display: 'flex', gap: 6, flexWrap: 'wrap', marginBottom: 10 }}>
                                    {suggestions.slice(0, 4).map(s => (
                                        <button key={s} className="btn btn-ghost btn-sm" style={{ fontSize: 11, padding: '4px 10px' }} onClick={() => setInput(s)}>{s}</button>
                                    ))}
                                </div>
                                <div style={{ display: 'flex', gap: 8 }}>
                                    <input value={input} onChange={e => setInput(e.target.value)} onKeyDown={e => e.key === 'Enter' && !e.shiftKey && send()} placeholder="Ask your AI coach anything..." disabled={loading} />
                                    <button className="btn btn-primary btn-sm" onClick={send} disabled={loading || !input.trim()}>
                                        {loading ? <span className="loading" /> : 'Send'}
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div>
                            <div className="card" style={{ padding: 20, marginBottom: 16 }}>
                                <div style={{ fontWeight: 800, fontSize: 15, marginBottom: 16 }}>🎯 Career Readiness Score</div>
                                <div style={{ display: 'flex', justifyContent: 'center', marginBottom: 16 }}>
                                    <ScoreRing score={user.careerScore?.overall || 0} size={120} />
                                </div>
                                <div style={{ background: (user.careerScore?.overall || 0) >= 75 ? 'rgba(0,245,160,.1)' : 'rgba(255,217,61,.1)', border: `1px solid ${(user.careerScore?.overall || 0) >= 75 ? 'rgba(0,245,160,.3)' : 'rgba(255,217,61,.3)'}`, borderRadius: 10, padding: 12, textAlign: 'center', marginBottom: 16 }}>
                                    <div style={{ fontWeight: 700, color: (user.careerScore?.overall || 0) >= 75 ? 'var(--accent)' : 'var(--accent4)' }}>
                                        {(user.careerScore?.overall || 0) >= 75 ? '✅ Interview Ready!' : '⏳ Need ' + (75 - (user.careerScore?.overall || 0)) + ' more points'}
                                    </div>
                                </div>
                                {Object.entries(user.careerScore || {}).filter(([k]) => k !== 'overall').map(([k, v]) => {
                                    const labels = { coding: '💻 Coding', dsa: '📊 DSA', consistency: '🔥 Consistency', resume: '📄 Resume', interview: '🎤 Interview', projects: '🏗️ Projects' };
                                    return (
                                        <div key={k} style={{ marginBottom: 10 }}>
                                            <div className="skill-bar-label"><span style={{ fontSize: 12 }}>{labels[k]}</span><span style={{ fontSize: 12, fontFamily: 'Poppins', color: 'var(--accent)' }}>{v}/100</span></div>
                                            <div className="skill-bar"><div className="skill-fill" style={{ width: `${v}%`, background: 'linear-gradient(90deg,var(--accent),var(--accent2))' }} /></div>
                                        </div>
                                    );
                                })}
                            </div>

                            <div className="card" style={{ padding: 20 }}>
                                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: 16 }}>
                                    <div style={{ fontWeight: 800, fontSize: 15 }}>📊 Weekly AI Report</div>
                                    <button className="btn btn-ghost btn-sm" onClick={generateWeeklyReport} disabled={weeklyAnalyzing}>
                                        {weeklyAnalyzing ? <><span className="loading" /> Generating...</> : '🤖 Generate'}
                                    </button>
                                </div>

                                {!weeklyReport && !weeklyAnalyzing && (
                                    <div style={{ textAlign: 'center', padding: 20, color: 'var(--text3)' }}>
                                        <div style={{ fontSize: 32, marginBottom: 8 }}>📊</div>
                                        <div style={{ fontSize: 13 }}>Click "Generate" for your<br />personalized AI weekly report</div>
                                    </div>
                                )}

                                {weeklyAnalyzing && (
                                    <div style={{ textAlign: 'center', padding: 20 }}>
                                        <div style={{ display: 'flex', justifyContent: 'center', gap: 4, marginBottom: 8 }}><span className="typing-dot" /><span className="typing-dot" /><span className="typing-dot" /></div>
                                        <div style={{ fontSize: 12, color: 'var(--text3)' }}>Claude is analyzing your progress...</div>
                                    </div>
                                )}

                                {weeklyReport && !weeklyAnalyzing && (
                                    <div>
                                        <div style={{ background: 'linear-gradient(135deg,rgba(0,245,160,.1),rgba(0,200,255,.05))', border: '1.5px solid rgba(249,115,22,.2)', borderRadius: 10, padding: 14, marginBottom: 12 }}>
                                            <div style={{ fontWeight: 700, fontSize: 14, color: 'var(--accent)', marginBottom: 4 }}>🎯 {weeklyReport.headline}</div>
                                            <div style={{ fontSize: 12, color: 'var(--text3)' }}>Generated by Claude AI</div>
                                        </div>
                                        {[
                                            ['🏆 Top Win', weeklyReport.topWin, 'var(--accent)'],
                                            ['📌 Focus Next', weeklyReport.focusNext, 'var(--accent2)'],
                                            ['🔥 Streak', weeklyReport.streakMessage, 'var(--accent4)'],
                                            ['🔮 Prediction', weeklyReport.prediction, '#A78BFA'],
                                        ].map(([l, v, c]) => (
                                            <div key={l} style={{ padding: '10px 0', borderBottom: '1px solid rgba(30,45,74,.5)', display: 'flex', gap: 8 }}>
                                                <div style={{ fontSize: 13, fontWeight: 700, color: 'var(--text3)', minWidth: 100 }}>{l}</div>
                                                <div style={{ fontSize: 12, color: 'var(--text2)', flex: 1, lineHeight: 1.5 }}>{v}</div>
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {!weeklyReport && !weeklyAnalyzing && (
                                    <>
                                        <div className="divider" />
                                        {[
                                            { label: 'Problems Solved', val: '7', delta: '+3 vs last week', up: true },
                                            { label: 'Study Time', val: '14.5h', delta: '+2h vs last week', up: true },
                                            { label: 'Streak', val: `${user.streak || 0} days`, delta: 'Keep it going!', up: false },
                                            { label: 'XP Earned', val: '480 XP', delta: 'Top 12% this week', up: true },
                                        ].map(s => (
                                            <div key={s.label} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '10px 0', borderBottom: '1px solid rgba(30,45,74,.5)' }}>
                                                <div style={{ fontSize: 13, color: 'var(--text2)' }}>{s.label}</div>
                                                <div style={{ textAlign: 'right' }}>
                                                    <div style={{ fontWeight: 700, fontFamily: 'Poppins', color: 'var(--accent)' }}>{s.val}</div>
                                                    <div style={{ fontSize: 11, color: s.up ? '#4ADE80' : 'var(--text3)' }}>{s.up ? '↑' : ''}{s.delta}</div>
                                                </div>
                                            </div>
                                        ))}
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // ─── LEADERBOARD ──────────────────────────────────────────────────────────────
        function LeaderboardPage({ user }) {
            const leaders = [
                { rank: 1, name: 'Kavya Reddy', score: 94, solved: 187, streak: 45, badge: '🏆' },
                { rank: 2, name: 'Rahul Joshi', score: 91, solved: 164, streak: 32, badge: '🥈' },
                { rank: 3, name: 'Priya Sharma', score: 88, solved: 156, streak: 28, badge: '🥉' },
                { rank: 4, name: 'Arjun Mehta', score: 85, solved: 143, streak: 21, badge: '' },
                { rank: 5, name: 'Sneha Patel', score: 82, solved: 131, streak: 19, badge: '' },
                { rank: 7, name: user.name, score: user.careerScore?.overall || 0, solved: user.solvedProblems?.length || 0, streak: user.streak || 0, badge: '⭐', isMe: true },
                { rank: 8, name: 'Deepak Verma', score: 65, solved: 89, streak: 9, badge: '' },
                { rank: 9, name: 'Meera Nair', score: 62, solved: 81, streak: 7, badge: '' },
                { rank: 10, name: 'Rohit Kumar', score: 58, solved: 72, streak: 5, badge: '' },
            ];

            return (
                <div className="page-content fade-in">
                    <div className="section-header"><div className="section-title">🏆 Global Leaderboard</div><span className="badge badge-green" style={{ animation: 'pulse 2s infinite' }}>LIVE</span></div>

                    <div style={{ display: 'flex', gap: 16, marginBottom: 28, justifyContent: 'center', alignItems: 'flex-end' }}>
                        {[leaders[1], leaders[0], leaders[2]].map((l, idx) => {
                            const heights = ['160px', '200px', '130px'];
                            const colors = ['#C0C0C0', '#FFD700', '#CD7F32'];
                            const order = [2, 1, 3];
                            return (
                                <div key={l.rank} style={{ textAlign: 'center', width: 120 }}>
                                    <div style={{ background: 'linear-gradient(135deg,var(--surface2),var(--bg))', borderRadius: '50%', width: 64, height: 64, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 24, margin: '0 auto 8px', border: `2px solid ${colors[idx]}` }}>{l.badge || '👤'}</div>
                                    <div style={{ fontWeight: 700, fontSize: 13, marginBottom: 2 }}>{l.name.split(' ')[0]}</div>
                                    <div style={{ fontSize: 11, color: 'var(--text3)', marginBottom: 8 }}>{l.score} pts</div>
                                    <div style={{ height: heights[idx], background: `linear-gradient(180deg,${colors[idx]}33,transparent)`, border: `1px solid ${colors[idx]}44`, borderRadius: '8px 8px 0 0', display: 'flex', alignItems: 'flex-start', justifyContent: 'center', paddingTop: 10, fontSize: 20, fontWeight: 800, color: colors[idx] }}>{order[idx]}</div>
                                </div>
                            );
                        })}
                    </div>

                    <div className="card" style={{ overflow: 'hidden' }}>
                        {leaders.map(l => (
                            <div key={l.rank} className="lb-row" style={{ borderBottom: '1px solid rgba(30,45,74,.5)', background: l.isMe ? 'rgba(0,245,160,.05)' : '', borderLeft: l.isMe ? '3px solid var(--accent)' : '3px solid transparent' }}>
                                <div className="lb-rank" style={{ color: l.rank <= 3 ? ['#FFD700', '#C0C0C0', '#CD7F32'][l.rank - 1] : 'var(--text3)' }}>{l.rank}</div>
                                <div style={{ width: 40, height: 40, borderRadius: '50%', background: 'linear-gradient(135deg,var(--surface2),var(--bg))', display: 'flex', alignItems: 'center', justifyContent: 'center', border: `2px solid ${l.isMe ? 'var(--accent)' : 'var(--border)'}` }}>{l.isMe ? '⭐' : l.badge || '👤'}</div>
                                <div style={{ flex: 1 }}>
                                    <div style={{ fontWeight: 700, fontSize: 13 }}>{l.name} {l.isMe && <span className="badge badge-green" style={{ fontSize: 9 }}>YOU</span>}</div>
                                    <div style={{ fontSize: 11, color: 'var(--text3)' }}>🔥 {l.streak} day streak · 💻 {l.solved} solved</div>
                                </div>
                                <div style={{ fontFamily: 'Poppins', fontWeight: 700, color: 'var(--accent)', fontSize: 16 }}>{l.score}</div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // ═══════════════════════════════════════════════════════════
        // MAIN APP
        // ═══════════════════════════════════════════════════════════
        function App() {
            const [currentUser, setCurrentUser] = useState(null);
            const [appLoading, setAppLoading] = useState(true);
            const [page, setPage] = useState('dashboard');
            const [activeProblem, setActiveProblem] = useState(null);
            const [toasts, setToasts] = useState([]);
            const [showNotifPanel, setShowNotifPanel] = useState(false);

            // Auth modal state
            const [showRoleModal, setShowRoleModal] = useState(false);
            const [showAuthModal, setShowAuthModal] = useState(false);
            const [authConfig, setAuthConfig] = useState({ role: 'student', mode: 'login' });

            // Check existing session on mount
            useEffect(() => {
                const session = DB.getSession();
                if (session) setCurrentUser(session);
                setAppLoading(false);
            }, []);

            const addNotif = useCallback((notif) => {
                const id = Date.now();
                setToasts(t => [...t, { ...notif, id }]);
                setTimeout(() => setToasts(t => t.filter(n => n.id !== id)), 6000);
            }, []);

            const dismissToast = useCallback(id => setToasts(t => t.filter(n => n.id !== id)), []);

            const updateUser = useCallback(fn => setCurrentUser(u => typeof fn === 'function' ? fn(u) : { ...u, ...fn }), []);

            const logout = () => {
                DB.clearToken();
                setCurrentUser(null);
                setPage('dashboard');
                addNotif({ type: 'info', msg: 'Signed out successfully. See you soon! 👋', time: 'now' });
            };

            const handleRoleSelect = (roleOrAction) => {
                setShowRoleModal(false);
                if (roleOrAction === 'login') {
                    setAuthConfig({ role: 'student', mode: 'login' });
                } else {
                    setAuthConfig({ role: roleOrAction, mode: 'register' });
                }
                setShowAuthModal(true);
            };

            const handleLoginClick = () => {
                setAuthConfig({ role: 'student', mode: 'login' });
                setShowAuthModal(true);
            };

            const handleCTA = () => {
                setShowRoleModal(true);
            };

            const handleAuthSuccess = (user) => {
                setCurrentUser(user);
                setShowAuthModal(false);
                setShowRoleModal(false);
                addNotif({ type: 'success', msg: `Welcome ${user.role === 'creator' ? '🎬' : '🎓'}, ${user.name.split(' ')[0]}! Let's get started.`, time: 'now' });
            };

            if (appLoading) {
                return (
                    <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'var(--bg)', flexDirection: 'column', gap: 16 }}>
                        <div className="logo-mark" style={{ width: 52, height: 52, fontSize: 24 }}>⚡</div>
                        <div style={{ color: 'var(--text2)', fontSize: 14, fontFamily: 'Poppins' }}>Loading...</div>
                    </div>
                );
            }

            const PAGE_TITLES = { dashboard: 'Dashboard', roadmap: 'Roadmap', problems: 'Problems', editor: 'Code Editor', courses: 'Courses', resume: 'Resume Builder', interview: 'Interview Center', jobs: 'Job Board', ai: 'AI Coach', leaderboard: 'Leaderboard' };
            const unreadCount = (currentUser?.notifications || []).filter(n => !n.read).length;

            const renderPage = () => {
                switch (page) {
                    case 'dashboard': return <Dashboard user={currentUser} setPage={setPage} setActiveProblem={setActiveProblem} />;
                    case 'problems': return <ProblemsPage user={currentUser} setPage={setPage} setActiveProblem={setActiveProblem} />;
                    case 'editor': return <EditorPage problem={activeProblem} user={currentUser} addNotif={addNotif} updateUser={updateUser} />;
                    case 'roadmap': return <RoadmapPage user={currentUser} setPage={setPage} updateUser={updateUser} />;
                    case 'courses': return <CoursesPage user={currentUser} addNotif={addNotif} />;
                    case 'resume': return <ResumePage user={currentUser} addNotif={addNotif} />;
                    case 'interview': return <InterviewPage user={currentUser} addNotif={addNotif} />;
                    case 'jobs': return <JobsPage user={currentUser} addNotif={addNotif} />;
                    case 'ai': return <AICoachPage user={currentUser} setPage={setPage} />;
                    case 'leaderboard': return <LeaderboardPage user={currentUser} />;
                    default: return <Dashboard user={currentUser} setPage={setPage} setActiveProblem={setActiveProblem} />;
                }
            };

            return (
                <div>
                    {/* ─── NOT LOGGED IN → Landing ─── */}
                    {!currentUser && (
                        <>
                            <LandingPage onCTA={handleCTA} onLogin={handleLoginClick} />
                            {showRoleModal && <RoleSelectModal onSelect={handleRoleSelect} onClose={() => setShowRoleModal(false)} />}
                            {showAuthModal && (
                                <AuthPage
                                    initialRole={authConfig.role}
                                    initialMode={authConfig.mode}
                                    onSuccess={handleAuthSuccess}
                                    onClose={() => setShowAuthModal(false)}
                                />
                            )}
                        </>
                    )}

                    {/* ─── LOGGED IN → App ─── */}
                    {currentUser && (
                        <div>
                            <Sidebar page={page} setPage={p => { setPage(p); setShowNotifPanel(false); }} user={currentUser} onLogout={logout} />
                            <div className="main">
                                {page === 'editor' ? (
                                    <div>
                                        <div className="topbar">
                                            <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                                                <button className="btn btn-ghost btn-sm" onClick={() => setPage('problems')}>← Problems</button>
                                                {activeProblem && <div style={{ fontWeight: 700 }}>{activeProblem.title}</div>}
                                            </div>
                                            <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>
                                                <div className="api-badge">🤖 AI Review Ready</div>
                                                {activeProblem && <span className={`badge badge-${activeProblem.difficulty === 'Easy' ? 'green' : activeProblem.difficulty === 'Medium' ? 'yellow' : 'red'}`}>{activeProblem.difficulty}</span>}
                                                {activeProblem && <span className="badge badge-gray">+{activeProblem.xp} XP</span>}
                                            </div>
                                        </div>
                                        {renderPage()}
                                    </div>
                                ) : (
                                    <div>
                                        <Topbar title={PAGE_TITLES[page] || 'Vibe Coding'} user={currentUser} setPage={setPage} unreadCount={unreadCount} showNotifs={showNotifPanel} setShowNotifs={setShowNotifPanel} />
                                        {showNotifPanel && (
                                            <div style={{ position: 'fixed', top: 60, right: 0, width: 360, background: 'var(--surface)', border: '1px solid var(--border)', borderRadius: '0 0 0 12px', padding: 16, zIndex: 200, maxHeight: '70vh', overflowY: 'auto', boxShadow: '0 8px 32px rgba(0,0,0,.4)' }}>
                                                <div style={{ fontWeight: 700, marginBottom: 12, display: 'flex', justifyContent: 'space-between' }}>
                                                    Notifications
                                                    <button className="btn btn-ghost btn-sm" onClick={() => setShowNotifPanel(false)}>✕</button>
                                                </div>
                                                {(currentUser.notifications || []).length === 0 ? (
                                                    <div style={{ textAlign: 'center', padding: 24, color: 'var(--text3)' }}>No notifications yet</div>
                                                ) : (currentUser.notifications || []).map(n => (
                                                    <div key={n.id} style={{ padding: '12px', borderRadius: 8, marginBottom: 8, background: n.read ? '' : 'var(--surface2)', border: '1px solid var(--border)', display: 'flex', gap: 10 }}>
                                                        <span>{n.type === 'success' ? '✅' : 'ℹ️'}</span>
                                                        <div><div style={{ fontSize: 13 }}>{n.msg}</div><div style={{ fontSize: 11, color: 'var(--text3)', marginTop: 2 }}>{n.time}</div></div>
                                                        {!n.read && <div style={{ width: 6, height: 6, background: 'var(--accent)', borderRadius: '50%', marginLeft: 'auto', marginTop: 4, flexShrink: 0 }} />}
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                        <div key={page} className="fade-in">{renderPage()}</div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    <NotifToast notifs={toasts} dismiss={dismissToast} />
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>

</html>